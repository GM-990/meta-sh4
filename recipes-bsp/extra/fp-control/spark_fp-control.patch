diff -Naur sh4-apps/tools/fp_control/Adb_Box.c taapat-apps/tools/fp_control/Adb_Box.c
--- sh4-apps/tools/fp_control/Adb_Box.c	2019-02-20 16:00:47.073955598 +0100
+++ taapat-apps/tools/fp_control/Adb_Box.c	1970-01-01 01:00:00.000000000 +0100
@@ -1,438 +0,0 @@
-/*
- * Adb_Box.c
- *
- * (c) 2010 duckbox project
- *
- * This program is free software; you can redistribute it and/or modify
- * it under the terms of the GNU General Public License as published by
- * the Free Software Foundation; either version 2 of the License, or
- * (at your option) any later version.
- *
- * This program is distributed in the hope that it will be useful,
- * but WITHOUT ANY WARRANTY; without even the implied warranty of
- * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the
- * GNU General Public License for more details.
- *
- * You should have received a copy of the GNU General Public License
- * along with this program; if not, write to the Free Software
- * Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA 02111-1307 USA
- *
- */
-
-/* ******************* includes ************************ */
-#include <stdio.h>
-#include <stdlib.h>
-#include <string.h>
-#include <time.h>
-#include <sys/types.h>
-#include <sys/stat.h>
-#include <fcntl.h>
-#include <unistd.h>
-#include <limits.h>
-#include <sys/ioctl.h>
-
-#include "global.h"
-#include "Adb_Box.h"
-
-static int setText(Context_t *context, char *theText);
-
-/* ******************* constants ************************ */
-
-#define cVFD_DEVICE "/dev/vfd"
-
-#define cMAXCharsADB_BOX 16
-
-typedef struct
-{
-	int display;
-	int display_custom;
-	char *timeFormat;
-
-	time_t wakeupTime;
-	int wakeupDecrement;
-} tADB_BOXPrivate;
-
-/* ******************* helper/misc functions ****************** */
-
-/* Calculate the time value which we can pass to
- * the adb_box fp. its a mjd time (mjd=modified
- * julian date). mjd is relativ to gmt so theGMTTime
- * must be in GMT/UTC.
- */
-void setAdb_BoxTime(time_t theGMTTime, char *destString)
-{
-	/* from u-boot adb_box */
-	struct	tm *now_tm;
-	now_tm = gmtime(&theGMTTime);
-	printf("Set Time (UTC): %02d:%02d:%02d %02d-%02d-%04d\n",
-		   now_tm->tm_hour, now_tm->tm_min, now_tm->tm_sec, now_tm->tm_mday, now_tm->tm_mon + 1, now_tm->tm_year + 1900);
-	double mjd = modJulianDate(now_tm);
-	int mjd_int = mjd;
-	destString[0] = (mjd_int >> 8);
-	destString[1] = (mjd_int & 0xff);
-	destString[2] = now_tm->tm_hour;
-	destString[3] = now_tm->tm_min;
-	destString[4] = now_tm->tm_sec;
-}
-
-unsigned long getAdb_BoxTime(char *adb_boxTimeString)
-{
-	unsigned int    mjd     = ((adb_boxTimeString[1] & 0xFF) * 256) + (adb_boxTimeString[2] & 0xFF);
-	unsigned long   epoch   = ((mjd - 40587) * 86400);
-	unsigned int    hour    = adb_boxTimeString[3] & 0xFF;
-	unsigned int    min     = adb_boxTimeString[4] & 0xFF;
-	unsigned int    sec     = adb_boxTimeString[5] & 0xFF;
-	epoch += (hour * 3600 + min * 60 + sec);
-	printf("MJD = %d epoch = %ld, time = %02d:%02d:%02d\n", mjd,
-		   epoch, hour, min, sec);
-	return epoch;
-}
-
-/* ******************* driver functions ****************** */
-
-static int init(Context_t *context)
-{
-	tADB_BOXPrivate *private = malloc(sizeof(tADB_BOXPrivate));
-	int vFd;
-	printf("%s\n", __func__);
-	vFd = open(cVFD_DEVICE, O_RDWR);
-	if (vFd < 0)
-	{
-		fprintf(stderr, "Cannot open %s\n", cVFD_DEVICE);
-		perror("");
-	}
-	((Model_t *)context->m)->private = private;
-	memset(private, 0, sizeof(tADB_BOXPrivate));
-	checkConfig(&private->display, &private->display_custom, &private->timeFormat, &private->wakeupDecrement);
-	return vFd;
-}
-
-static int usage(Context_t *context, char *prg_name, char *cmd_name)
-{
-	fprintf(stderr, "%s: not implemented\n", __func__);
-	return -1;
-}
-
-static int setTime(Context_t *context, time_t *theGMTTime)
-{
-	struct adb_box_ioctl_data vData;
-	printf("%s\n", __func__);
-	setAdb_BoxTime(*theGMTTime, vData.u.time.time);
-	if (ioctl(context->fd, VFDSETTIME, &vData) < 0)
-	{
-		perror("setTime: ");
-		return -1;
-	}
-	return 0;
-}
-
-static int getTime(Context_t *context, time_t *theGMTTime)
-{
-	char fp_time[8];
-	fprintf(stderr, "Waiting for current time from fp...\n");
-	/* front controller time */
-	if (ioctl(context->fd, VFDGETTIME, &fp_time) < 0)
-	{
-		perror("getTime: ");
-		return -1;
-	}
-	/* if we get the fp time */
-	if (fp_time[0] != '\0')
-	{
-		fprintf(stderr, "Success reading time from fp\n");
-		/* current front controller time */
-		*theGMTTime = (time_t) getAdb_BoxTime(fp_time);
-	}
-	else
-	{
-		fprintf(stderr, "Error reading time from fp\n");
-		*theGMTTime = 0;
-	}
-	return 0;
-}
-
-static int setTimer(Context_t *context, time_t *theGMTTime)
-{
-	struct adb_box_ioctl_data vData;
-	time_t curTime;
-	time_t wakeupTime;
-	struct tm *ts;
-	time(&curTime);
-	ts = localtime(&curTime);
-	fprintf(stderr, "Current Time: %02d:%02d:%02d %02d-%02d-%04d\n",
-			ts->tm_hour, ts->tm_min, ts->tm_sec, ts->tm_mday, ts->tm_mon + 1, ts->tm_year + 1900);
-	if (theGMTTime == NULL)
-	{
-		wakeupTime = read_timers_utc(curTime);
-	}
-	else
-	{
-		wakeupTime = *theGMTTime;
-	}
-	if ((wakeupTime <= 0) || (wakeupTime == LONG_MAX))
-	{
-		/* nothing to do for e2 */
-		fprintf(stderr, "no e2 timer found clearing fp wakeup time, Goodbye...\n");
-		vData.u.standby.time[0] = '\0';
-		if (ioctl(context->fd, VFDSTANDBY, &vData) < 0)
-		{
-			perror("standby: ");
-			return -1;
-		}
-	}
-	else
-	{
-		unsigned long diff;
-		char fp_time[8];
-		fprintf(stderr, "Waiting for current time from fp ...\n");
-		/* front controller time */
-		if (ioctl(context->fd, VFDGETTIME, &fp_time) < 0)
-		{
-			perror("gettime: ");
-			return -1;
-		}
-		/* difference from now to wake up */
-		diff = (unsigned long int) wakeupTime - curTime;
-		/* if we get the fp time */
-		if (fp_time[0] != '\0')
-		{
-			fprintf(stderr, "Success reading time from fp\n");
-			/* current front controller time */
-			curTime = (time_t) getAdb_BoxTime(fp_time);
-		}
-		else
-		{
-			fprintf(stderr, "Error reading time, assuming localtime\n");
-			/* noop current time already set */
-		}
-		wakeupTime = curTime + diff;
-		setAdb_BoxTime(wakeupTime, vData.u.standby.time);
-		if (ioctl(context->fd, VFDSTANDBY, &vData) < 0)
-		{
-			perror("standby: ");
-			return -1;
-		}
-	}
-	return 0;
-}
-
-static int getWTime(Context_t *context, time_t *theGMTTime)
-{
-	fprintf(stderr, "%s: not implemented\n", __func__);
-	return -1;
-}
-
-static int shutdown(Context_t *context, time_t *shutdownTimeGMT)
-{
-	time_t curTime;
-	/* shutdown immediately */
-	if (*shutdownTimeGMT == -1)
-	{
-		return (setTimer(context, NULL));
-	}
-	while (1)
-	{
-		time(&curTime);
-		/*printf("curTime = %d, shutdown %d\n", curTime, *shutdownTimeGMT);*/
-		if (curTime >= *shutdownTimeGMT)
-		{
-			/* set most recent e2 timer and bye bye */
-			return (setTimer(context, NULL));
-		}
-		usleep(100000);
-	}
-	return -1;
-}
-
-static int reboot(Context_t *context, time_t *rebootTimeGMT)
-{
-	time_t curTime;
-	struct adb_box_ioctl_data vData;
-	while (1)
-	{
-		time(&curTime);
-		if (curTime >= *rebootTimeGMT)
-		{
-			if (ioctl(context->fd, VFDREBOOT, &vData) < 0)
-			{
-				perror("reboot: ");
-				return -1;
-			}
-		}
-		usleep(100000);
-	}
-	return 0;
-}
-
-static int Sleep(Context_t *context, time_t *wakeUpGMT)
-{
-	time_t curTime;
-	int sleep = 1;
-	int vFd = 0;
-	fd_set rfds;
-	struct timeval tv;
-	int retval;
-	struct tm *ts;
-	char output[cMAXCharsADB_BOX + 1];
-	tADB_BOXPrivate *private = (tADB_BOXPrivate *)((Model_t *)context->m)->private;
-#if 0
-	printf("%s\n", __func__);
-	vFd = open(cRC_DEVICE, O_RDWR);
-	if (vFd < 0)
-	{
-		fprintf(stderr, "Cannot open %s\n", cRC_DEVICE);
-		perror("");
-		return -1;
-	}
-#endif
-	printf("%s 1\n", __func__);
-	while (sleep)
-	{
-		time(&curTime);
-		ts = localtime(&curTime);
-		if (curTime >= *wakeUpGMT)
-		{
-			sleep = 0;
-		}
-		else
-		{
-			FD_ZERO(&rfds);
-			FD_SET(vFd, &rfds);
-			tv.tv_sec = 0;
-			tv.tv_usec = 100000;
-			retval = select(vFd + 1, &rfds, NULL, NULL, &tv);
-			if (retval > 0)
-			{
-				sleep = 0;
-			}
-		}
-		if (private->display)
-		{
-			strftime(output, cMAXCharsADB_BOX + 1, private->timeFormat, ts);
-			setText(context, output);
-		}
-	}
-	return 0;
-}
-
-static int setText(Context_t *context, char *theText)
-{
-	char vHelp[cMAXCharsADB_BOX + 1];
-	strncpy(vHelp, theText, cMAXCharsADB_BOX);
-	vHelp[cMAXCharsADB_BOX] = '\0';
-	/* printf("%s, %d\n", vHelp, strlen(vHelp));*/
-	write(context->fd, vHelp, strlen(vHelp));
-	return 0;
-}
-
-static int setLed(Context_t *context, int which, int on)
-{
-	struct adb_box_ioctl_data vData;
-	vData.u.led.led_nr = which;
-	vData.u.led.on = on;
-	if (ioctl(context->fd, VFDSETLED, &vData) < 0)
-	{
-		perror("setLed: ");
-		return -1;
-	}
-	return 0;
-}
-
-static int setIcon(Context_t *context, int which, int on)
-{
-	struct adb_box_ioctl_data vData;
-	vData.u.icon.icon_nr = which;
-	vData.u.icon.on = on;
-	if (ioctl(context->fd, VFDICONDISPLAYONOFF, &vData) < 0)
-	{
-		perror("setIcon: ");
-		return -1;
-	}
-	return 0;
-}
-
-static int setBrightness(Context_t *context, int brightness)
-{
-	struct adb_box_ioctl_data vData;
-	if (brightness < 0 || brightness > 7)
-	{
-		return -1;
-	}
-	vData.u.brightness.level = brightness;
-	printf("%d\n", context->fd);
-	if (ioctl(context->fd, VFDBRIGHTNESS, &vData) < 0)
-	{
-		perror("setBrightness: ");
-		return -1;
-	}
-	return 0;
-}
-
-static int setLight(Context_t *context, int on)
-{
-	if (on)
-	{
-		setBrightness(context, 7);
-	}
-	else
-	{
-		setBrightness(context, 0);
-	}
-	return 0;
-}
-
-static int Exit(Context_t *context)
-{
-	tADB_BOXPrivate *private = (tADB_BOXPrivate *)((Model_t *)context->m)->private;
-	if (context->fd > 0)
-	{
-		close(context->fd);
-	}
-	free(private);
-	exit(1);
-}
-
-static int Clear(Context_t *context)
-{
-	struct adb_box_ioctl_data vData;
-	if (ioctl(context->fd, VFDDISPLAYCLR, &vData) < 0)
-	{
-		perror("Clear: ");
-		return -1;
-	}
-	return 0;
-}
-
-Model_t Adb_Box_model =
-{
-	.Name             = "B4Team ADB_BOX frontpanel control utility",
-	.Type             = Adb_Box,
-	.Init             = init,
-	.Clear            = Clear,
-	.Usage            = usage,
-	.SetTime          = setTime,
-	.GetTime          = getTime,
-	.SetTimer         = setTimer,
-	.GetWTime         = getWTime,
-	.SetWTime         = NULL,
-	.Shutdown         = shutdown,
-	.Reboot           = reboot,
-	.Sleep            = Sleep,
-	.SetText          = setText,
-	.SetLed           = setLed,
-	.SetIcon          = setIcon,
-	.SetBrightness    = setBrightness,
-	.GetWakeupReason  = NULL,
-	.SetLight         = setLight,
-	.SetLedBrightness = NULL,
-	.GetVersion       = NULL,
-	.SetRF            = NULL,
-	.SetFan           = NULL,
-	.GetWakeupTime    = NULL,
-	.SetDisplayTime   = NULL,
-	.SetTimeMode      = NULL,
-#if defined MODEL_SPECIFIC
-	.ModelSpecific    = NULL,
-#endif
-	.Exit             = Exit
-};
diff -Naur sh4-apps/tools/fp_control/Adb_Box.h taapat-apps/tools/fp_control/Adb_Box.h
--- sh4-apps/tools/fp_control/Adb_Box.h	2019-02-20 16:00:47.073955598 +0100
+++ taapat-apps/tools/fp_control/Adb_Box.h	1970-01-01 01:00:00.000000000 +0100
@@ -1,59 +0,0 @@
-#ifndef __adb_box__
-#define __adb_box__
-
-/* this setups the mode temporarily (for one ioctl)
- * to the desired mode. currently the "normal" mode
- * is the compatible vfd mode
- */
-struct set_mode_s
-{
-	int compat; /* 0 = compatibility mode to vfd driver; 1 = nuvoton mode */
-};
-
-struct set_brightness_s
-{
-	int level;
-};
-
-struct set_icon_s
-{
-	int icon_nr;
-	int on;
-};
-
-struct set_led_s
-{
-	int led_nr;
-	int on;
-};
-
-/* time must be given as follows:
- * time[0] & time[1] = mjd ???
- * time[2] = hour
- * time[3] = min
- * time[4] = sec
- */
-struct set_standby_s
-{
-	char time[5];
-};
-
-struct set_time_s
-{
-	char time[5];
-};
-
-struct adb_box_ioctl_data
-{
-	union
-	{
-		struct set_icon_s icon;
-		struct set_led_s led;
-		struct set_brightness_s brightness;
-		struct set_mode_s mode;
-		struct set_standby_s standby;
-		struct set_time_s time;
-	} u;
-};
-
-#endif
diff -Naur sh4-apps/tools/fp_control/autogen.sh taapat-apps/tools/fp_control/autogen.sh
--- sh4-apps/tools/fp_control/autogen.sh	2019-02-20 16:00:47.075955549 +0100
+++ taapat-apps/tools/fp_control/autogen.sh	2019-02-20 15:59:37.637646158 +0100
@@ -1,15 +1,62 @@
 #!/bin/sh
 
-package="tools-fp_control"
+package="tuxbox-apps-misc-tools"
 
 srcdir=`dirname $0`
 test -z "$srcdir" && srcdir=.
 
 cd "$srcdir"
+DIE=0
+
+(autoconf --version) < /dev/null > /dev/null 2>&1 || {
+	echo
+	echo "You must have autoconf installed to compile $package."
+	echo "Download the appropriate package for your system,"
+	echo "or get the source from one of the GNU ftp sites"
+	echo "listed in http://www.gnu.org/order/ftp.html"
+	DIE=1
+}
+
+(automake --version) < /dev/null > /dev/null 2>&1 || {
+	echo
+	echo "You must have automake installed to compile $package."
+	echo "Download the appropriate package for your system,"
+	echo "or get the source from one of the GNU ftp sites"
+	echo "listed in http://www.gnu.org/order/ftp.html"
+	DIE=1
+}
+
+(libtool --version) < /dev/null > /dev/null 2>&1 || {
+	echo
+	echo "You must have libtool installed to compile $package."
+	echo "Download the appropriate package for your system,"
+	echo "or get the source from one of the GNU ftp sites"
+	echo "listed in http://www.gnu.org/order/ftp.html"
+	DIE=1
+}
+
+if test "$DIE" -eq 1; then
+	exit 1
+fi
+
+if [ ! -e acinclude.m4 ]; then
+	for i in .. ../.. ../../..; do
+		if [ -e `pwd`/$i/acinclude.m4 ]; then
+			ln -s `pwd`/$i/acinclude.m4 .
+		fi
+	done
+fi
+
 echo "Generating configuration files for $package, please wait...."
 
-aclocal --force
-libtoolize --force
-autoconf --force
-autoheader  --force
-automake --add-missing --force-missing --foreign
+echo "  aclocal $ACLOCAL_FLAGS"
+aclocal $ACLOCAL_FLAGS
+echo "  libtoolize --automake"
+libtoolize --automake
+echo "  autoconf"
+autoconf
+echo "  autoheader"
+autoheader
+echo "  automake --add-missing"
+automake --add-missing 
+
diff -Naur sh4-apps/tools/fp_control/Cnbox.c taapat-apps/tools/fp_control/Cnbox.c
--- sh4-apps/tools/fp_control/Cnbox.c	2019-02-20 16:00:47.073955598 +0100
+++ taapat-apps/tools/fp_control/Cnbox.c	1970-01-01 01:00:00.000000000 +0100
@@ -1,420 +0,0 @@
-/*
- * CNBOX.c
- *
- * (c) 2009 dagobert@teamducktales
- *
- * This program is free software; you can redistribute it and/or modify
- * it under the terms of the GNU General Public License as published by
- * the Free Software Foundation; either version 2 of the License, or
- * (at your option) any later version.
- *
- * This program is distributed in the hope that it will be useful,
- * but WITHOUT ANY WARRANTY; without even the implied warranty of
- * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the
- * GNU General Public License for more details.
- *
- * You should have received a copy of the GNU General Public License
- * along with this program; if not, write to the Free Software
- * Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA 02111-1307 USA
- *
- */
-
-/* ******************* includes ************************ */
-#include <stdio.h>
-#include <stdlib.h>
-#include <string.h>
-#include <time.h>
-#include <sys/types.h>
-#include <sys/stat.h>
-#include <fcntl.h>
-#include <unistd.h>
-#include <limits.h>
-#include <sys/ioctl.h>
-#include <linux/input.h>
-
-#include "global.h"
-#include "Cnbox.h"
-
-static int setText(Context_t *context, char *theText);
-static int Clear(Context_t *context);
-
-/* ******************* constants ************************ */
-
-#define cVFD_DEVICE "/dev/vfd"
-#define cEVENT_DEVICE "/dev/input/event0"
-
-#define cMAXCharsCnbox 12
-
-typedef struct
-{
-	int display;
-	int display_custom;
-	char *timeFormat;
-
-	time_t wakeupTime;
-	int wakeupDecrement;
-} tCnboxPrivate;
-
-/* ******************* helper/misc functions ****************** */
-
-unsigned long getCnboxTime(char *nuvotonTimeString)
-{
-	unsigned int    mjd     = ((nuvotonTimeString[0] & 0xFF) * 256) + (nuvotonTimeString[1] & 0xFF);
-	unsigned long   epoch   = ((mjd - 40587) * 86400);
-	unsigned int    hour    = nuvotonTimeString[2] & 0xFF;
-	unsigned int    min     = nuvotonTimeString[3] & 0xFF;
-	unsigned int    sec     = nuvotonTimeString[4] & 0xFF;
-	epoch += (hour * 3600 + min * 60 + sec);
-	printf("MJD = %d epoch = %ld, time = %02d:%02d:%02d\n", mjd,
-		   epoch, hour, min, sec);
-	return epoch;
-}
-
-/* Calculate the time value which we can pass to
- * the nuvoton fp. its a mjd time (mjd=modified
- * julian date). mjd is relativ to gmt so theTime
- * must be in GMT/UTC.
- */
-void setCnboxTime(time_t theTime, char *destString)
-{
-	struct tm *now_tm;
-	now_tm = gmtime(&theTime);
-	printf("Set Time (UTC): %02d:%02d:%02d %02d-%02d-%04d\n",
-		   now_tm->tm_hour, now_tm->tm_min, now_tm->tm_sec, now_tm->tm_mday, now_tm->tm_mon + 1, now_tm->tm_year + 1900);
-	double mjd = modJulianDate(now_tm);
-	int mjd_int = mjd;
-	destString[0] = (mjd_int >> 8);
-	destString[1] = (mjd_int & 0xff);
-	destString[2] = now_tm->tm_hour;
-	destString[3] = now_tm->tm_min;
-	destString[4] = now_tm->tm_sec;
-}
-
-/* ******************* driver functions ****************** */
-
-static int init(Context_t *context)
-{
-	tCnboxPrivate *private = malloc(sizeof(tCnboxPrivate));
-	int vFd;
-	vFd = open(cVFD_DEVICE, O_RDWR);
-	if (vFd < 0)
-	{
-		fprintf(stderr, "Cannot open %s\n", cVFD_DEVICE);
-		perror("");
-	}
-	((Model_t *)context->m)->private = private;
-	memset(private, 0, sizeof(tCnboxPrivate));
-	checkConfig(&private->display, &private->display_custom, &private->timeFormat, &private->wakeupDecrement);
-	return vFd;
-}
-
-static int usage(Context_t *context, char *prg_name, char *cmd_name)
-{
-	fprintf(stderr, "%s: not implemented\n", __func__);
-	return -1;
-}
-
-static int setTime(Context_t *context, time_t *theGMTTime)
-{
-	struct cnbox_ioctl_data vData;
-	vData.u.time.localTime = *theGMTTime;
-	if (ioctl(context->fd, VFDSETTIME, &vData) < 0)
-	{
-		perror("setTime: ");
-		return -1;
-	}
-	return 0;
-}
-
-static int getTime(Context_t *context, time_t *theGMTTime)
-{
-	char fp_time[8];
-	fprintf(stderr, "Waiting for current time from fp...\n");
-	/* front controller time */
-	if (ioctl(context->fd, VFDGETTIME, &fp_time) < 0)
-	{
-		perror("getTime: ");
-		return -1;
-	}
-	/* if we get the fp time */
-	if (fp_time[0] != '\0')
-	{
-		fprintf(stderr, "Success reading time from fp\n");
-		/* current front controller time */
-		*theGMTTime = (time_t)getCnboxTime(fp_time);
-	}
-	else
-	{
-		fprintf(stderr, "Error reading time from fp\n");
-		*theGMTTime = 0;
-	}
-	return 0;
-}
-
-static int setTimer(Context_t *context, time_t *theGMTTime)
-{
-	struct cnbox_ioctl_data vData;
-	time_t curTime;
-	time_t curTimeFP;
-	time_t wakeupTime;
-	struct tm *ts;
-	struct tm *tsw;
-	time(&curTime);
-	ts = localtime(&curTime);
-	fprintf(stderr, "Current Time: %02d:%02d:%02d %02d-%02d-%04d\n",
-			ts->tm_hour, ts->tm_min, ts->tm_sec, ts->tm_mday, ts->tm_mon + 1, ts->tm_year + 1900);
-	if (theGMTTime == NULL)
-	{
-		wakeupTime = read_timers_utc(curTime);
-	}
-	else
-	{
-		wakeupTime = *theGMTTime;
-	}
-	tsw = localtime(&wakeupTime);
-	printf("wakeup Time: %02d:%02d:%02d %02d-%02d-%04d\n",
-		   tsw->tm_hour, tsw->tm_min, tsw->tm_sec, tsw->tm_mday, tsw->tm_mon + 1, tsw->tm_year + 1900);
-	tsw = localtime(&curTime);
-	printf("current Time: %02d:%02d:%02d %02d-%02d-%04d\n",
-		   tsw->tm_hour, tsw->tm_min, tsw->tm_sec, tsw->tm_mday, tsw->tm_mon + 1, tsw->tm_year + 1900);
-	//check --> WakupTime is set and larger curTime and no larger than a year in the future (gost)
-	if ((wakeupTime <= 0) || (curTime > wakeupTime) || (curTime < (wakeupTime-25920000)))
-	//if ((wakeupTime <= 0) || (wakeupTime == LONG_MAX))
-	{
-		/* nothing to do for e2 */
-		fprintf(stderr, "no e2 timer found clearing fp wakeup time ... good bye ...\n");
-		vData.u.standby.localTime = 0;
-		if (ioctl(context->fd, VFDSTANDBY, &vData) < 0)
-		{
-			perror("standBy: ");
-			return -1;
-		}
-	}
-	else
-	{
-		unsigned long diff;
-		char    fp_time[8];
-		fprintf(stderr, "Waiting for current time from fp...\n");
-		/* front controller time */
-		if (ioctl(context->fd, VFDGETTIME, &fp_time) < 0)
-		{
-			perror("getTime: ");
-			return -1;
-		}
-		/* difference from now to wake up */
-		diff = (unsigned long int) wakeupTime - curTime;
-		/* if we get the fp time */
-		if (fp_time[0] != '\0')
-		{
-			fprintf(stderr, "Success reading time from fp\n");
-			/* current front controller time */
-			curTimeFP = (time_t) getCnboxTime(fp_time);
-			/* set FP-Time if curTime > or < 12h (gost)*/
-			if (((curTimeFP - curTime) > 43200) || ((curTime - curTimeFP) > 43200))
-			{
-				setTime(context, &curTime);
-				curTimeFP = curTime;
-			}
-			tsw = gmtime(&curTimeFP);
-			printf("fp_time (UTC): %02d:%02d:%02d %02d-%02d-%04d\n",
-				   tsw->tm_hour, tsw->tm_min, tsw->tm_sec, tsw->tm_mday, tsw->tm_mon + 1, tsw->tm_year + 1900);
-		}
-		else
-		{
-			fprintf(stderr, "Error reading time, assuming localtime\n");
-			/* noop current time already set */
-		}
-		wakeupTime = curTimeFP + diff;
-//		setCnboxTime(wakeupTime, vData.u.standby.time);
-		if (ioctl(context->fd, VFDSTANDBY, &vData) < 0)
-		{
-			perror("standBy: ");
-			return -1;
-		}
-	}
-	return 0;
-}
-
-static int getWTime(Context_t *context, time_t *theGMTTime)
-{
-	fprintf(stderr, "%s: not implemented\n", __func__);
-	return -1;
-}
-
-static int shutdown(Context_t *context, time_t *shutdownTimeGMT)
-{
-	time_t curTime;
-
-	/* shutdown immediately */
-	if (*shutdownTimeGMT == -1)
-	{
-		return (setTimer(context, NULL));
-	}
-	while (1)
-	{
-		time(&curTime);
-		if (curTime >= *shutdownTimeGMT)
-		{
-			/* set most recent e2 timer and bye bye */
-			return (setTimer(context, NULL));
-		}
-		usleep(100000);
-	}
-	return -1;
-}
-
-static int reboot(Context_t *context, time_t *rebootTimeGMT)
-{
-	time_t curTime;
-	struct cnbox_ioctl_data vData;
-	while (1)
-	{
-		time(&curTime);
-		if (curTime >= *rebootTimeGMT)
-		{
-			if (ioctl(context->fd, VFDREBOOT, &vData) < 0)
-			{
-				perror("reboot: ");
-				return -1;
-			}
-		}
-		usleep(100000);
-	}
-	return 0;
-}
-
-static int Sleep(Context_t *context, time_t *wakeUpGMT)
-{
-	time_t curTime;
-	int sleep = 1;
-	int vFd;
-	fd_set rfds;
-	struct timeval tv;
-	int retval, i, rd;
-	struct tm *ts;
-	char output[cMAXCharsCnbox + 1];
-	struct input_event ev[64];
-	tCnboxPrivate *private = (tCnboxPrivate *)((Model_t *)context->m)->private;
-	vFd = open(cEVENT_DEVICE, O_RDWR);
-	if (vFd < 0)
-	{
-		fprintf(stderr, "Cannot open %s\n", cEVENT_DEVICE);
-		perror("");
-		return -1;
-	}
-	while (sleep)
-	{
-		time(&curTime);
-		ts = localtime(&curTime);
-		if (curTime >= *wakeUpGMT)
-		{
-			sleep = 0;
-		}
-		else
-		{
-			FD_ZERO(&rfds);
-			FD_SET(vFd, &rfds);
-			tv.tv_sec = 0;
-			tv.tv_usec = 100000;
-			retval = select(vFd + 1, &rfds, NULL, NULL, &tv);
-			if (retval > 0)
-			{
-				rd = read(vFd, ev, sizeof(struct input_event) * 64);
-				if (rd < (int) sizeof(struct input_event))
-				{
-					continue;
-				}
-				for (i = 0; i < rd / sizeof(struct input_event); i++)
-				{
-					if (ev[i].type == EV_SYN)
-					{
-					}
-					else if (ev[i].type == EV_MSC && (ev[i].code == MSC_RAW || ev[i].code == MSC_SCAN))
-					{
-					}
-					else
-					{
-						if (ev[i].code == 116)
-						{
-							sleep = 0;
-						}
-					}
-				}
-			}
-		}
-		if (private->display)
-		{
-			strftime(output, cMAXCharsCnbox + 1, private->timeFormat, ts);
-			setText(context, output);
-		}
-	}
-	return 0;
-}
-
-static int setText(Context_t *context, char *theText)
-{
-	char vHelp[cMAXCharsCnbox + 1];
-	strncpy(vHelp, theText, cMAXCharsCnbox);
-	vHelp[cMAXCharsCnbox] = '\0';
-	/* printf("%s, %d\n", vHelp, strlen(vHelp));*/
-	write(context->fd, vHelp, strlen(vHelp));
-	return 0;
-}
-
-static int setLed(Context_t *context, int which, int on)
-{
-	return 0;
-}
-
-static int Exit(Context_t *context)
-{
-	tCnboxPrivate *private = (tCnboxPrivate *)((Model_t *)context->m)->private;
-	if (context->fd > 0)
-	{
-		close(context->fd);
-	}
-	free(private);
-	exit(1);
-}
-
-static int Clear(Context_t *context)
-{
-//	int i;
-	setText(context, "        ");
-	return 0;
-}
-
-Model_t CNBOX_model =
-{
-	.Name             = "CreNova Micom frontpanel control utility",
-	.Type             = CNBox,
-	.Init             = init,
-	.Clear            = Clear,
-	.Usage            = usage,
-	.SetTime          = setTime,
-	.GetTime          = getTime,
-	.SetTimer         = setTimer,
-	.GetWTime         = getWTime,
-	.SetWTime         = NULL,
-	.Shutdown         = shutdown,
-	.Reboot           = reboot,
-	.Sleep            = Sleep,
-	.SetText          = setText,
-	.SetLed           = setLed,
-	.SetIcon          = NULL,
-	.SetBrightness    = NULL,
-	.GetWakeupReason  = NULL,
-	.SetLight         = NULL,
-	.SetLedBrightness = NULL,
-	.GetVersion       = NULL,
-	.SetRF            = NULL,
-	.SetFan           = NULL,
-	.GetWakeupTime    = NULL,
-	.SetDisplayTime   = NULL,
-	.SetTimeMode      = NULL,
-#if defined MODEL_SPECIFIC
-	.ModelSpecific    = NULL,
-#endif
-	.Exit             = Exit
-};
-
diff -Naur sh4-apps/tools/fp_control/Cnbox.h taapat-apps/tools/fp_control/Cnbox.h
--- sh4-apps/tools/fp_control/Cnbox.h	2019-02-20 16:00:47.073955598 +0100
+++ taapat-apps/tools/fp_control/Cnbox.h	1970-01-01 01:00:00.000000000 +0100
@@ -1,23 +0,0 @@
-#ifndef __CNBOX_H
-#define __CNBOX_H
-
-struct set_standby_s
-{
-	time_t localTime;
-};
-
-struct set_time_s
-{
-	time_t localTime;
-};
-
-struct cnbox_ioctl_data
-{
-	union
-	{
-		struct set_standby_s standby;
-		struct set_time_s time;
-	} u;
-};
-
-#endif
diff -Naur sh4-apps/tools/fp_control/configure.ac taapat-apps/tools/fp_control/configure.ac
--- sh4-apps/tools/fp_control/configure.ac	2019-02-20 16:00:47.075955549 +0100
+++ taapat-apps/tools/fp_control/configure.ac	2019-02-20 15:59:37.638646134 +0100
@@ -1,16 +1,33 @@
-AC_INIT([fp_control],[1.0],[],[fp_control])
-AC_PREREQ(2.53)
+AC_INIT(tuxbox-apps-misc-tools,0.0.1,,tuxbox-misc-tools)
+AM_INIT_AUTOMAKE(tuxbox-misc-tools,0.0.1)
 
-AM_INIT_AUTOMAKE
+TUXBOX_APPS
 
 AC_PROG_CC
 AC_PROG_CXX
+AM_PROG_LIBTOOL
+
+AC_ARG_ENABLE([multicom406], 
+        [AS_HELP_STRING(--enable-multicom406,    enable multicom406 stuff)], 
+        [case "${enableval}" in 
+                yes) enable_multicom406=true ;; 
+                no) enable_multicom406=false ;; 
+                *) AC_MSG_ERROR([bad value ${enableval} for --enable-multicom406]) ;; 
+        esac]) 
+AM_CONDITIONAL([ENABLE_MULTICOM406], [test x$enable_multicom406 = xtrue])
+AC_SUBST(MULTICOM406)
+
+AC_ARG_ENABLE([multicom324], 
+        [AS_HELP_STRING(--enable-multicom324,    enable multicom324 stuff)], 
+        [case "${enableval}" in 
+                yes) enable_multicom324=true ;; 
+                no) enable_multicom324=false ;; 
+                *) AC_MSG_ERROR([bad value ${enableval} for --enable-multicom324]) ;; 
+        esac]) 
+AM_CONDITIONAL([ENABLE_MULTICOM324], [test x$enable_multicom324 = xtrue])
+AC_SUBST(MULTICOM324)
 
-m4_ifdef([AM_SILENT_RULES], [AM_SILENT_RULES([yes])])
-m4_ifdef([LT_INIT], [LT_INIT], [AC_PROG_LIBTOOL])
-AC_CONFIG_MACRO_DIR([m4])
 
-AC_CHECK_LIB(pthread, pthread_create, [LIBS="$LIBS -lpthread"])
 
 AC_OUTPUT([
 Makefile
diff -Naur sh4-apps/tools/fp_control/Cuberevo.c taapat-apps/tools/fp_control/Cuberevo.c
--- sh4-apps/tools/fp_control/Cuberevo.c	2019-03-09 07:59:43.000000000 +0200
+++ taapat-apps/tools/fp_control/Cuberevo.c	1970-01-01 01:00:00.000000000 +0100
@@ -1,998 +0,0 @@
-/*
- * Cuberevo.c
- *
- * (c) 2009 dagobert@teamducktales
- *
- * This program is free software; you can redistribute it and/or modify
- * it under the terms of the GNU General Public License as published by
- * the Free Software Foundation; either version 2 of the License, or
- * (at your option) any later version.
- *
- * This program is distributed in the hope that it will be useful,
- * but WITHOUT ANY WARRANTY; without even the implied warranty of
- * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the
- * GNU General Public License for more details.
- *
- * You should have received a copy of the GNU General Public License
- * along with this program; if not, write to the Free Software
- * Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA 02111-1307 USA
- *
- *****************************************************************************
- *
- * Changes
- *
- * Date     By              Description
- * --------------------------------------------------------------------------
- * 20190210 Audioniek       CubeRevo specific usage added.
- * 20190212 Audioniek       Completely tested through and improved/expanded.
- *
- ****************************************************************************/
-
-/* ******************* includes ************************ */
-#include <stdio.h>
-#include <stdlib.h>
-#include <string.h>
-#include <time.h>
-#include <sys/types.h>
-#include <sys/stat.h>
-#include <fcntl.h>
-#include <unistd.h>
-#include <limits.h>
-#include <sys/ioctl.h>
-#include <linux/input.h>
-
-#include "global.h"
-#include "Cuberevo.h"
-
-static int setText(Context_t *context, char *theText);
-static int Clear(Context_t *context);
-static int setIcon(Context_t *context, int which, int on);
-static int getVersion(Context_t *context, int *version);
-static int setDisplayTime(Context_t *context, int on);
-
-/* ******************* constants ************************ */
-
-#define cVFD_DEVICE "/dev/vfd"
-#define cRTC_OFFSET_FILE "/proc/stb/fp/rtc_offset"
-#define cEVENT_DEVICE "/dev/input/event0"
-
-#define cMAXCharsCuberevo 14 /* 14seg ->rest is filtered by driver */
-
-typedef struct
-{
-	char *arg;
-	char *arg_long;
-	char *arg_description;
-} tArgs;
-
-tArgs vCArgs[] =
-{
-	{ "-e", "  --setTimer         * ", "Args: [time date]  Format: HH:MM:SS dd-mm-YYYY" },
-	{ "", "                         ", "      No arg: Set the most recent timer from e2 or neutrino" },
-	{ "", "                         ", "      to the frontcontroller and shutdown" },
-	{ "", "                         ", "      Arg time date: Set frontcontroller wake up time to" },
-	{ "", "                         ", "      time, shutdown, and wake up at given time" },
-	{ "-d", "  --shutdown         * ", "Args: None or [time date]  Format: HH:MM:SS dd-mm-YYYY" },
-	{ "", "                         ", "      No arg: Shut down immediately" },
-	{ "", "                         ", "      Arg time date: Shut down at given time/date" },
-	{ "-r", "  --reboot           * ", "Args: None" },
-	{ "", "                         ", "      No arg: Reboot immediately" },
-	{ "", "                         ", "      Arg time date: Reboot at given time/date" },
-	{ "-g", "  --getTime          * ", "Args: None        Display currently set frontprocessor time" },
-	{ "-gs", " --getTimeAndSet    * ", "Args: None" },
-	{ "", "                         ", "      Set system time to current frontprocessor time" },
-	{ "", "                         ", "      WARNING: system date will be 01-01-1970!" },
-	{ "-gw", " --getWTime         * ", "Args: None        Get the current frontcontroller wake up time" },
-	{ "-st", " --setWakeTime      * ", "Args: time date   Format: HH:MM:SS dd-mm-YYYY" },
-	{ "", "                         ", "      Set the frontcontroller wake up time" },
-	{ "-s", "  --setTime          * ", "Args: time date   Format: HH:MM:SS dd-mm-YYYY" },
-	{ "", "                         ", "      Set the frontprocessor time" },
-	{ "-sst", "--setSystemTime    * ", "Args: None        Set front processor time to system time" },
-	{ "-p", "  --sleep            * ", "Args: time date   Format: HH:MM:SS dd-mm-YYYY" },
-	{ "", "                         ", "      Reboot receiver via fp at given time" },
-	{ "-t", "  --settext            ", "Args: text        Set text to frontpanel" },
-	{ "-l", "  --setLed             ", "Args: LED# int    LED#: int=on,off,blink (0,1,2,3)" },
-	{ "-i", "  --setIcon            ", "Args: icon# 1|0   Set an icon on or off" },
-	{ "-b", "  --setBrightness      ", "Arg : 0..7        Set display brightness" },
-	{ "-led", "--setBrightness      ", "Arg : 0..255      Set LED brightness" },
-	{ "-w", "  --getWakeupReason    ", "Args: None        Get the wake up reason" },
-	{ "-L", "  --setLight           ", "Arg : 0|1         Set display on/off" },
-	{ "-c", "  --clear              ", "Args: None        Clear display, all icons and LEDs off" },
-	{ "-v", "  --version            ", "Args: None        Get version info from frontprocessor" },
-	{ "-sf", " --setFan             ", "Arg : 0/1         Set fan on/off" },
-	{ "-sr", " --setRF              ", "Arg : 0/1         Set rf modulator on/off" },
-	{ "-dt", " --display_time       ", "Arg : 0/1         Set time display on/off" },
-	{ "-tm", " --time_mode          ", "Arg : 0/1         Set 12 or 24 hour time mode" },
-	{ "-V", "  --verbose            ", "Args: None        Verbose operation" },
-#if defined MODEL_SPECIFIC
-	{ "-ms", " --model_specific     ", "Args: int1 [int2] [int3] ... [int16]   (note: input in hex)" },
-	{ "", "                         ", "                  Model specific test function" },
-#endif
-	{ NULL, NULL, NULL }
-};
-
-typedef struct
-{
-	int display;
-	int display_custom;
-	char *timeFormat;
-
-	time_t wakeupTime;
-	int wakeupDecrement;
-} tCubeRevoPrivate;
-
-/* ******************* helper/misc functions ****************** */
-
-static void setMode(int fd)
-{
-	struct micom_ioctl_data micom;
-
-	micom.u.mode.compat = 1;
-	if (ioctl(fd, VFDSETMODE, &micom) < 0)
-	{
-		perror("Set compatibility mode");
-	}
-}
-
-/* Remark on times:
- *
- * System time is in UTC
- * RTC/FP time is local (required for correct time display in time display mode)
- * User supplied times on the command line are assumed to be local
- */
-
-/* Calculate the time value which we can pass to
- * the micom fp.
- */
-static void setMicomTime(time_t theGMTTime, char *destString, bool seconds)
-{ // time_t -> micom string
-	struct tm *now_tm;
-	char tmpString[13];
-
-	memset(tmpString, 0, sizeof(tmpString));
-//	//printf("Time to set: %10d (time_t)\n", (int)theGMTTime);
-	now_tm = gmtime(&theGMTTime);
-
-	if (seconds)
-	{
-#if 0
-		printf("Time to set: %02d:%02d:%02d %02d-%02d-20%02d\n", now_tm->tm_hour, now_tm->tm_min, now_tm->tm_sec, now_tm->tm_mday,
-			now_tm->tm_mon + 1, now_tm->tm_year - 100);
-#endif
-		sprintf(tmpString, "%02d%02d%02d%02d%02d%02d",
-			now_tm->tm_year - 100, now_tm->tm_mon + 1, now_tm->tm_mday, now_tm->tm_hour, now_tm->tm_min, now_tm->tm_sec);
-		strncpy(destString, tmpString, 12);
-	}
-	else
-	{
-#if 0
-		printf("Time to set: %02d:%02d:%02d %02d-%02d-20%02d (seconds ignored)\n", now_tm->tm_hour, now_tm->tm_min, now_tm->tm_sec, now_tm->tm_mday,
-			now_tm->tm_mon + 1, now_tm->tm_year - 100);
-#endif
-		sprintf(tmpString, "%02d%02d%02d%02d%02d", 
-			now_tm->tm_year - 100, now_tm->tm_mon + 1, now_tm->tm_mday, now_tm->tm_hour, now_tm->tm_min);
-		strncpy(destString, tmpString, 10);
-	}
-}
-
-static time_t getMicomTime(char* TimeString)
-{ // micomstring -> time_t
-	char convertTime[128];
-	unsigned int year, month, day;
-	unsigned int hour, min, sec;
-	struct tm the_tm;
-	struct tm *tz_time_utc_tm;
-	struct tm *tz_time_local_tm;
-	time_t convertedTime;
-
-	memset(convertTime, 0, sizeof(convertTime));
-	sprintf(convertTime, "%02x %02x %02x %02x %02x %02x\n",
-			TimeString[0], TimeString[1], TimeString[2],
-			TimeString[3], TimeString[4], TimeString[5]);
-	sscanf(convertTime, "%d %d %d %d %d %d", &sec, &min, &hour, &day, &month, &year);
-	the_tm.tm_year = year + 100;
-	the_tm.tm_mon  = month - 1;
-	the_tm.tm_mday = day;
-	the_tm.tm_hour = hour;
-	the_tm.tm_min  = min;
-	the_tm.tm_sec  = sec;
-	the_tm.tm_isdst = -1; // struct tm in local time, convert to UTC
-//	printf("Converted time: %02d:%02d:%02d %02d-%02d-20%02d (seconds ignored)\n", the_tm.tm_hour, the_tm.tm_min, the_tm.tm_sec, the_tm.tm_mday,
-//		the_tm.tm_mon + 1, the_tm.tm_year - 100);
-	convertedTime = mktime(&the_tm); // twice local due to mktime...
-	tz_time_local_tm = localtime(&convertedTime);
-	hour = tz_time_local_tm->tm_hour;
-	if (hour == 0)
-	{
-		hour = 24;
-	}
-	tz_time_utc_tm = gmtime(&convertedTime);
-//	printf("Converted time2: %02d:%02d:%02d %02d-%02d-20%02d (seconds ignored)\n", tz_time_utc_tm->tm_hour, tz_time_utc_tm->tm_min, tz_time_utc_tm->tm_sec, tz_time_utc_tm->tm_mday,
-//		tz_time_utc_tm->tm_mon + 1, tz_time_utc_tm->tm_year - 100);
-	convertedTime += ((hour - tz_time_utc_tm->tm_hour) * 3600); 
-//	printf("Addition: %d\n",  ((hour - tz_time_utc_tm->tm_hour) * 3600));
-	return convertedTime;
-}
-
-/* ******************* driver functions ****************** */
-
-static int init(Context_t *context)
-{
-	tCubeRevoPrivate *private = malloc(sizeof(tCubeRevoPrivate));
-	int vFd;
-
-	vFd = open(cVFD_DEVICE, O_RDWR);
-	if (vFd < 0)
-	{
-		fprintf(stderr, "Cannot open %s\n", cVFD_DEVICE);
-		perror("");
-	}
-	((Model_t *)context->m)->private = private;
-	memset(private, 0, sizeof(tCubeRevoPrivate));
-	checkConfig(&private->display, &private->display_custom, &private->timeFormat, &private->wakeupDecrement);
-	return vFd;
-}
-
-static int usage(Context_t *context, char *prg_name, char *cmd_name)
-{
-	int i;
-
-	fprintf(stderr, "Usage:\n\n");
-	fprintf(stderr, "%s argument [optarg1] [optarg2]\n", prg_name);
-	for (i = 0; ; i++)
-	{
-		if (vCArgs[i].arg == NULL)
-		{
-			break;
-		}
-		if ((cmd_name == NULL) || (strcmp(cmd_name, vCArgs[i].arg) == 0) || (strstr(vCArgs[i].arg_long, cmd_name) != NULL))
-		{
-			fprintf(stderr, "%s   %s   %s\n", vCArgs[i].arg, vCArgs[i].arg_long, vCArgs[i].arg_description);
-		}
-	}
-	fprintf(stderr, "Options marked * should be the only calling argument.\n");
-	return 0;
-}
-
-static int setTime(Context_t *context, time_t *theGMTTime)
-{
-	// -s command
-	struct micom_ioctl_data vData;
-
-	setMicomTime(*theGMTTime - 3506716800u, vData.u.time.time, 1); // with seconds
-
-	if (ioctl(context->fd, VFDSETTIME, &vData) < 0)
-	{
-		perror("Set time");
-		printf("%s < (-1)\n", __func__);
-		return -1;
-	}
-	return 0;
-}
-
-static int getTime(Context_t *context, time_t *theGMTTime)
-{
-	// -g command
-	struct micom_ioctl_data vData;
-
-	if (ioctl(context->fd, VFDGETTIME, &vData) < 0)
-	{
-		perror("getTime");
-		//printf("%s <- -1\n", __func__);
-		return -1;
-	}
-	*theGMTTime = (time_t)getMicomTime(vData.u.time.time);
-#if 0
-	printf("Got current FP time %02x:%02x:%02x %02x-%02x-20%02x\n",
-		vData.u.time.time[2], vData.u.time.time[1], vData.u.time.time[0], vData.u.time.time[3], vData.u.time.time[4], vData.u.time.time[5]);
-#endif
-	return 0;
-}
-
-static int setSTime(Context_t *context, time_t *theGMTTime)
-{
-	// -sst command
-	time_t curTime;
-	char fp_time[8];
-	time_t curTimeFP;
-	struct tm *ts_gmt;
-	int gmt_offset;
-	int proc_fs;
-	FILE *proc_fs_file;
-
-	time(&curTime); // get system time in UTC
-	ts_gmt = gmtime(&curTime);
-	gmt_offset = get_GMT_offset(*ts_gmt);
-	printf("Current system time: %02d:%02d:%02d %02d-%02d-%04d (local)\n",
-		ts_gmt->tm_hour + (gmt_offset / 3600), ts_gmt->tm_min, ts_gmt->tm_sec,
-		ts_gmt->tm_mday, ts_gmt->tm_mon + 1, ts_gmt->tm_year + 1900);
-	curTime += gmt_offset;
-	curTime += 3506716800u; // start of MJD
-	setTime(context, &curTime); // set fp clock to local time
-	sleep(2); // allow FP time to process the new time
-
-	/* Read fp time back */
-	if (ioctl(context->fd, VFDGETTIME, &fp_time) < 0)
-	{
-		perror("Gettime");
-		return -1;
-	}
-	curTimeFP = (time_t)getMicomTime(fp_time);
-	ts_gmt = gmtime(&curTimeFP);
-	printf("Front panel time set to: %02d:%02d:%02d %02d-%02d-%04d (local)\n", ts_gmt->tm_hour, ts_gmt->tm_min, ts_gmt->tm_sec,
-		ts_gmt->tm_mday, ts_gmt->tm_mon + 1, ts_gmt->tm_year + 1900);
-
-	// write UTC offset to /proc/stb/fp/rtc_offset
-	proc_fs_file = fopen(cRTC_OFFSET_FILE, "w");
-	if (proc_fs_file == NULL)
-	{
-		perror("Open rtc_offset");
-		return -1;
-	}
-	proc_fs = fprintf(proc_fs_file, "%d", gmt_offset);
-	if (proc_fs < 0)
-	{
-		perror("Write rtc_offset");
-		return -1;
-	}
-	fclose(proc_fs_file);
-	printf("Note: /proc/stb/fp/rtc_offset set to: %+d seconds.\n", gmt_offset);
-	return 0; // ?? -> segmentation fault
-}
-
-static int setTimer(Context_t *context, time_t *theGMTTime)
-{
-	// -e command
-	time_t curTime    = 0;
-	time_t curTimeFP  = 0;
-	time_t wakeupTime = 0;
-	struct tm *ts_gmt;
-	int gmt_offset;
-	struct tm *tsw;
-	struct micom_ioctl_data vData;
-
-	time(&curTime);// get system time in UTC
-	ts_gmt = gmtime(&curTime);
-	gmt_offset = get_GMT_offset(*ts_gmt);
-	printf("Current system time: %02d:%02d:%02d %02d-%02d-%04d (local)\n",
-		ts_gmt->tm_hour + (gmt_offset / 3600), ts_gmt->tm_min, ts_gmt->tm_sec,
-		ts_gmt->tm_mday, ts_gmt->tm_mon + 1, ts_gmt->tm_year + 1900);
-
-	if (theGMTTime == NULL) // -e no argument = shutdown until next e2/neutrino timer
-	{
-		wakeupTime = read_timers_utc(curTime); //get current 1st timer
-		wakeupTime += gmt_offset; // timers are stored in UTC
-	}
-	else
-	{
-		wakeupTime = *theGMTTime; //get specified time (assumed local)
-		wakeupTime -= 3506716800u; // start of MJD
-		tsw = gmtime(&wakeupTime);
-#if 0
-		printf("Wake up time (arg): %02d:%02d:%02d %02d-%02d-%04d (local)\n", tsw->tm_hour, tsw->tm_min,
-		tsw->tm_sec, tsw->tm_mday, tsw->tm_mon + 1, tsw->tm_year + 1900);
-#endif
-	}
-	curTime += gmt_offset; // convert to local
-	// check --> wakeupTime is set and larger than curTime and no larger than 300 days in the future
-	// check --> there is no timer set
-	if ((wakeupTime <= 0) || ((wakeupTime == LONG_MAX)) || (curTime > wakeupTime) || (curTime < (wakeupTime - 25920000)))
-	{
-		/* shut down immedately */
-		printf("No timers set or 1st timer more than 300 days ahead,\nor all timer(s) in the past.\n");
-//		wakeupTime = 946684800u; // 00:00:00 01-01-2000 -> timer icon off
-		vData.u.wakeup_time.time[0] = '\0';
-	}
-	else // wake up time valid and in the coming 300 days
-	{
-		unsigned long diff;
-		char fp_time[7];
-
-		/* Determine difference between system time and wake up time */
-		diff = (unsigned long int) wakeupTime - curTime;
-
-		/* Check if front panel clock is set properly */
-		memset(fp_time, 0, sizeof(fp_time));
-		if (ioctl(context->fd, VFDGETTIME, &fp_time) < 0)
-		{
-			perror("Gettime");
-			return -1;
-		}
-#if 0
-		printf("Current FP time %02x:%02x:%02x %02x-%02x-20%02x\n",
-			fp_time.u.time.time[2], fp_time.u.time.time[1], fp_time.u.time.time[0], fp_time.u.time.time[3], fp_time.u.time.time[4], fp_time.u.time.time[5]);
-#endif
-		sleep(1);
-		if (fp_time[0] != '\0')
-		{
-			curTimeFP = (time_t)getMicomTime(fp_time);
-			/* set FP-Time if time is more than 5 minutes off */
-			if (abs((int)(curTimeFP - curTime)) > 300)
-			{
-				printf("Time difference between fp and system: %+d seconds.\n", (int)(curTimeFP - curTime));
-				setTime(context, &curTime); // sync fp clock
-				ts_gmt = gmtime(&curTimeFP);
-				printf("Front panel time corrected, set to: %02d:%02d:%02d %02d-%02d-%04d (local)\n",
-					ts_gmt->tm_hour, ts_gmt->tm_min, ts_gmt->tm_sec, ts_gmt->tm_mday, ts_gmt->tm_mon + 1, ts_gmt->tm_year + 1900);
-			}
-		}
-		else
-		{
-			fprintf(stderr, "Error reading front panel time... using system time.\n");
-			curTimeFP = curTime;
-		}
-		wakeupTime = curTimeFP + diff;
-	}
-	tsw = gmtime(&wakeupTime);
-	printf("Wake up time: %02d:%02d:%02d %02d-%02d-%04d (local)\n", tsw->tm_hour, tsw->tm_min,
-		tsw->tm_sec, tsw->tm_mday, tsw->tm_mon + 1, tsw->tm_year + 1900);
-
-	setMicomTime(wakeupTime, vData.u.wakeup_time.time, 0); // ignore seconds
-	fflush(stdout);
-	fflush(stderr);
-	sleep(2);
-	if (ioctl(context->fd, VFDSTANDBY, &vData) < 0)
-	{
-		perror("Shut down");
-		printf("%s <- -1\n", __func__);
-		return -1;
-	}
-	return 0;
-}
-
-static int getWakeupTime(Context_t *context, time_t *theGMTTime)
-{
-	// -gw command
-	struct micom_ioctl_data vData;
-
-	if (ioctl(context->fd, VFDGETWAKEUPTIME_CUB, &vData) < 0)
-	{
-		perror("getWakeupTime");
-		return -1;
-	}
-	*theGMTTime = (time_t)getMicomTime(vData.u.wakeup_time.time);
-	return 0;
-}
-
-static int setWakeupTime(Context_t *context, time_t *theGMTTime)
-{
-	// -st command
-	struct micom_ioctl_data vData;
-
-	setMicomTime(*theGMTTime - 3506716800u, vData.u.wakeup_time.time, 0); // without seconds
-
-	if (ioctl(context->fd, VFDSETWAKEUPTIME_CUB, &vData) < 0)
-	{
-		perror("Set wake up time");
-		return -1;
-	}
-	return 0;
-}
-
-static int shutdown(Context_t *context, time_t *shutdownTimeGMT)
-{
-	// -d command
-	time_t curTime;
-	struct tm *ts_gmt;
-	int gmt_offset;
-
-	/* shutdown immediately */
-	if (*shutdownTimeGMT == -1)
-	{
-		return (setTimer(context, NULL));
-	}
-	/* shut down time given */
-	time(&curTime);// get system time in UTC
-	ts_gmt = gmtime(&curTime);
-	gmt_offset = get_GMT_offset(*ts_gmt);
-	//printf("Waiting until shut down time (%10d)", (int)*shutdownTimeGMT);
-
-	while (1)
-	{
-		time(&curTime);
-		curTime += gmt_offset;
-		curTime += 3506716800u; // start of MJD
-		if (curTime >= *shutdownTimeGMT)
-		{
-			/* set most recent e2 timer and shut down */
-			return (setTimer(context, NULL));
-		}
-		//printf(".");
-		sleep(1);
-	}
-	return -1;
-}
-
-static int reboot(Context_t *context, time_t *rebootTimeGMT)
-{
-	//-r command
-	time_t curTime;
-	struct tm *ts_gmt;
-	int gmt_offset;
-	struct micom_ioctl_data vData;
-
-	time(&curTime); // get system time in UTC
-	ts_gmt = gmtime(&curTime);
-	gmt_offset = get_GMT_offset(*ts_gmt);
-
-	//printf("Waiting until reboot time (%10d)", (int)*rebootTimeGMT);
-	while (1)
-	{
-		time(&curTime);
-		curTime += gmt_offset;
-		curTime += 3506716800u; // start of MJD
-		//printf("time: %10d, reboot: %10d\n", (int)curTime, (int)*rebootTimeGMT);
-		if (curTime >= *rebootTimeGMT)
-		{
-			if (ioctl(context->fd, VFDREBOOT, &vData) < 0)
-			{
-				perror("Reboot");
-				return -1;
-			}
-//		printf(".");
-		}
-		sleep(1);
-	}
-	return 0;
-}
-
-static int Sleep(Context_t *context, time_t *wakeUpGMT)
-{
-	// -p command
-	time_t curTime;
-	int gmt_offset;
-	int sleep_flag;
-	int vFd;
-	fd_set rfds;
-	struct timeval tv;
-	int retval, i, rd, version;
-	struct tm *ts;
-	char output[cMAXCharsCuberevo + 1];
-	struct input_event ev[64];
-
-	tCubeRevoPrivate *private = (tCubeRevoPrivate *)((Model_t *)context->m)->private;
-	vFd = open(cEVENT_DEVICE, O_RDWR);
-	if (vFd < 0)
-	{
-		fprintf(stderr, "Cannot open %s\n", cEVENT_DEVICE);
-		perror("");
-		return -1;
-	}
-	Clear(context); /* clear display */
-	getVersion(context, &version);
-	/* 13char VFD */
-	if ((version == 3) && (private->display))
-	{
-		setIcon(context, 1, 1); /* FIXME: show standby icon */
-		/* yes: then enable fp time */
-		setDisplayTime(context, 1);
-	}
-	else
-	{
-		setDisplayTime(context, 0);
-	}
-
-	sleep_flag = 1;
-	while (sleep_flag)
-	{
-		time(&curTime);  // get system time (UTC)
-		ts = gmtime(&curTime);
-		gmt_offset = get_GMT_offset(*ts); // convert to local
-		curTime += gmt_offset;
-		curTime += 3506716800u; // start of MJD
-
-		if (curTime >= *wakeUpGMT)
-		{
-			sleep_flag = 0;
-		}
-		else
-		{
-			FD_ZERO(&rfds);
-			FD_SET(vFd, &rfds);
-			tv.tv_sec = 0;
-			tv.tv_usec = 100000;
-			retval = select(vFd + 1, &rfds, NULL, NULL, &tv);
-			if (retval > 0)
-			{
-				rd = read(vFd, ev, sizeof(struct input_event) * 64);
-				if (rd < (int) sizeof(struct input_event))
-				{
-					continue;
-				}
-				for (i = 0; i < rd / sizeof(struct input_event); i++)
-				{
-					if (ev[i].type == EV_SYN)
-					{
-					}
-					else if (ev[i].type == EV_MSC && (ev[i].code == MSC_RAW || ev[i].code == MSC_SCAN))
-					{
-					}
-					else
-					{
-						if (ev[i].code == 116)
-						{
-							sleep_flag = 0;
-						}
-					}
-				}
-			}
-		}
-		if ((private->display) && (version != 3))
-		{
-			/* show soft time with user format */
-			strftime(output, cMAXCharsCuberevo + 1, private->timeFormat, ts);
-			setText(context, output);
-		}
-		sleep(1);
-	}
-	Clear(context); /* clear display */
-	if (version == 3)
-	{
-		setIcon(context, 1, 0); /* FIXME standby icon off */
-		setDisplayTime(context, 0);
-	}
-	return 0;
-}
-
-static int setText(Context_t *context, char *theText)
-{
-	// -t command
-	char vHelp[128];
-
-	strncpy(vHelp, theText, 64);
-	vHelp[64] = '\0';
-	write(context->fd, vHelp, strlen(vHelp));
-	return 0;
-}
-
-static int setLed(Context_t *context, int which, int state)
-{
-	// -l command
-	struct micom_ioctl_data vData;
-
-	// states: 0 = off, 1 = on, 2 = slow blink, 3 = fast blink
-	if (state < 0 || state > 3)
-		{
-		printf("Illegal LED state %d (valid is 0..3)\n", state);
-		return -1;
-	}
-	switch (state)
-	{
-		case 2:
-		{
-			state = 3;
-			break;
-		}
-		case 3:
-		{
-			state = 5;
-			break;
-		}
-		default:
-		{
-			break;
-		}
-	}
-	vData.u.led.led_nr = which;
-	vData.u.led.state = state;
-	setMode(context->fd);
-	if (ioctl(context->fd, VFDSETLED, &vData) < 0)
-	{
-		perror("SetLED");
-		return -1;
-	}
-	return 0;
-}
-
-static int setRFModulator(Context_t *context, int on)
-{
-	// -sr command
-	struct micom_ioctl_data vData;
-	int version;
-
-	getVersion(context, &version);
-	if (version >= 2)
-	{
-		printf("This model does not have an RF modulator.\n");
-		return 0;
-	}
-	vData.u.rf.on = on;
-	setMode(context->fd);
-	if (ioctl(context->fd, VFDSETRF_CUB, &vData) < 0)
-	{
-		perror("setRFModulator");
-		return -1;
-	}
-	return 0;
-}
-
-static int setDisplayTime(Context_t *context, int on)
-{
-	// -dt command
-	struct micom_ioctl_data vData;
-
-	vData.u.display_time.on = on;
-	setMode(context->fd);
-	if (ioctl(context->fd, VFDSETDISPLAYTIME_CUB, &vData) < 0)
-	{
-		perror("setDisplayTime");
-		return -1;
-	}
-	return 0;
-}
-
-static int setFan(Context_t *context, int on)
-{
-	// -sf command
-	struct micom_ioctl_data vData;
-	int version;
-
-	getVersion(context, &version);
-	if (version >= 2)
-	{
-		printf("This model cannot control the fan.\n");
-		return 0;
-	}
-	vData.u.fan.on = on;
-	setMode(context->fd);
-	if (ioctl(context->fd, VFDSETFAN, &vData) < 0)
-	{
-		perror("setFan");
-		return -1;
-	}
-	return 0;
-}
-
-static int setIcon(Context_t *context, int which, int on)
-{
-	// -i command
-	struct micom_ioctl_data vData;
-
-	vData.u.icon.icon_nr = which;
-	vData.u.icon.on = on;
-	setMode(context->fd);
-	if (ioctl(context->fd, VFDICONDISPLAYONOFF, &vData) < 0)
-	{
-		perror("setIcon");
-		return -1;
-	}
-	return 0;
-}
-
-static int setBrightness(Context_t *context, int brightness)
-{
-	// -b command
-	struct micom_ioctl_data vData;
-	int version;
-
-	getVersion(context, &version);
-	if (version >= 2)
-	{
-		printf("This model cannot control display brightness.\n");
-		return 0;
-	}
-	if (brightness < 0 || brightness > 7)
-	{
-		return -1;
-	}
-	vData.u.brightness.level = brightness;
-	setMode(context->fd);
-	printf("%d\n", context->fd);
-	if (ioctl(context->fd, VFDBRIGHTNESS, &vData) < 0)
-	{
-		perror("setBrightness");
-		return -1;
-	}
-	return 0;
-}
-
-static int Clear(Context_t *context)
-{
-	// -c command
-	struct vfd_ioctl_data data;
-
-	data.start = 0;
-	if (ioctl(context->fd, VFDDISPLAYWRITEONOFF, &data) < 0)
-	{
-		perror("Clear");
-		return -1;
-	}
-	return 0;
-}
-
-static int setLight(Context_t *context, int on)
-{
-	// -L command, FIXME: add models that cannot control brightness in micom and use IOCTL
-	int version;
-
-	getVersion(context, &version);
-	if (version >= 2)
-	{
-		printf("Command not yet supported on this model.\n");
-		return 0;
-	}
-	if (on)
-	{
-		setBrightness(context, 7);
-	}
-	else
-	{
-		setBrightness(context, 0);
-	}
-	return 0;
-}
-
-/* Attention: this is not the wakeup reason as for other
- * boxes (poweron, timer and so on) this is:
- * 0x00 ->timer off
- * 0x02 ->timer on
- */
-static int getWakeupReason(Context_t *context, eWakeupReason *reason)
-{
-	//-w command
-	struct micom_ioctl_data vData;
-
-	/* front controller data */
-	if (ioctl(context->fd, VFDGETWAKEUPMODE, &vData) < 0)
-	{
-		perror("Get wakeup reason");
-		return -1;
-	}
-	if ((vData.u.status.status & 0xff) == 0x02)
-	{
-		*reason = TIMER;
-	}
-	else
-	{
-		*reason = NONE;
-	}
-	//printf("Reason = 0x%x\n", *reason);
-	return 0;
-}
-
-static int getVersion(Context_t *context, int *version)
-{
-	//-v command
-	/* Version: 0 = 12 char VFD, 1 = 13 char VFD, 2 = 14 char VFD, 3 = 4 char LED */
-	struct micom_ioctl_data micom;
-
-	/* front controller version */
-	if (ioctl(context->fd, VFDGETVERSION_CUB, &micom) < 0)
-	{
-		perror("getVersion");
-		return -1;
-	}
-	*version = micom.u.version.version;
-//	printf("micom version = %d\n", micom.u.version.version);
-	return 0;
-}
-
-static int setTimeMode(Context_t *context, int twentyFour)
-{
-	// -tm command
-	struct micom_ioctl_data vData;
-
-	vData.u.timemode.twentyFour = twentyFour;
-	setMode(context->fd);
-	if (ioctl(context->fd, VFDSETTIMEMODE, &vData) < 0)
-	{
-		perror("setTimeMode");
-		return -1;
-	}
-	return 0;
-}
-
-static int setLedBrightness(Context_t *context, int brightness)
-{
-	// -led command, not tested
-	struct micom_ioctl_data vData;
-	int version;
-
-	getVersion(context, &version);
-	if (version >= 2)
-	{
-		printf("This model cannot control LED brightness.\n");
-		return 0;
-	}
-
-	if (brightness < 0 || brightness > 0xff)
-	{
-		return -1;
-	}
-	vData.u.brightness.level = brightness;
-	setMode(context->fd);
-
-	if (ioctl(context->fd, VFDLEDBRIGHTNESS_CUB, &vData) < 0)
-	{
-		perror("setLedBrightness");
-		return -1;
-	}
-	return 0;
-}
-
-#if defined MODEL_SPECIFIC
-static int modelSpecific(Context_t *context, char len, unsigned char *data)
-{
-	//-ms command, not tested
-	int i, res;
-	unsigned char testdata[18];
-
-	memset(testdata, 0, sizeof(testdata));
-	testdata[0] = 5; // set length (always 5)
-	
-	printf("micom ioctl: VFDTEST (0x%08x) CMD=", VFDTEST);
-	for (i = 1; i <= len; i++)
-	{
-		testdata[i] = data[i - 1] & 0xff;
-		printf("0x%02x ", testdata[i]);
-	}
-	printf("\n");
-
-	memset(data, 0, 18);
-
-//	setMode(context->fd); //set mode 1
-
-	res = (ioctl(context->fd, VFDTEST, &testdata) < 0);
-
-	if (res < 0)
-	{
-		perror("Model specific");
-		return -1;
-	}
-	else
-	{
-		for (i = 0; i < ((testdata[1] == 1) ? 11 : 2); i++)
-		{
-			data[i] = testdata[i]; //return values
-		}
-	}
-	return testdata[0];
-}
-#endif
-
-static int Exit(Context_t *context)
-{
-	tCubeRevoPrivate *private = (tCubeRevoPrivate *)((Model_t *)context->m)->private;
-
-	if (context->fd > 0)
-	{
-		close(context->fd);
-	}
-	free(private);
-	return 1;
-}
-
-Model_t Cuberevo_model =
-{
-	.Name             = "CubeRevo frontpanel control utility",
-	.Type             = Cuberevo,
-	.Init             = init,
-	.Clear            = Clear,
-	.Usage            = usage,
-	.SetTime          = setTime,
-	.GetTime          = getTime,
-	.SetTimer         = setTimer,
-	.GetWTime         = getWakeupTime,
-	.SetWTime         = setWakeupTime,
-	.SetSTime         = setSTime,
-	.Shutdown         = shutdown,
-	.Reboot           = reboot,
-	.Sleep            = Sleep,
-	.SetText          = setText,
-	.SetLed           = setLed,
-	.SetIcon          = setIcon,
-	.SetBrightness    = setBrightness,
-	.GetWakeupReason  = getWakeupReason,
-	.SetLight         = setLight,
-	.SetLedBrightness = setLedBrightness,
-	.GetVersion       = getVersion,
-	.SetRF            = setRFModulator,
-	.SetFan           = setFan,
-	.GetWakeupTime    = getWakeupTime,
-	.SetDisplayTime   = setDisplayTime,
-	.SetTimeMode      = setTimeMode,
-#if defined MODEL_SPECIFIC
-	.ModelSpecific    = modelSpecific,
-#endif
-	.Exit             = Exit
-};

diff -Naur sh4-apps/tools/fp_control/Cuberevo.h taapat-apps/tools/fp_control/Cuberevo.h
--- sh4-apps/tools/fp_control/Cuberevo.h	2019-02-20 16:00:47.073955598 +0100
+++ taapat-apps/tools/fp_control/Cuberevo.h	1970-01-01 01:00:00.000000000 +0100
@@ -1,137 +0,0 @@
-#ifndef __cuberevo__
-#define __cuberevo__
-
-#if 0 // moved to global.h
-/* ioctl numbers ->hacky */
-#define VFDBRIGHTNESS         0xc0425a03
-#define VFDPWRLED             0xc0425a04 // deprecated, use VFDSETLED (0xc0425afe) instead.
-#define VFDDRIVERINIT         0xc0425a08
-#define VFDICONDISPLAYONOFF   0xc0425a0a
-#define VFDDISPLAYWRITEONOFF  0xc0425a05
-#define VFDDISPLAYCHARS       0xc0425a00
-
-#define VFDCLEARICONS         0xc0425af6
-#define VFDSETRF              0xc0425af7
-#define VFDSETFAN             0xc0425af8
-#define VFDGETWAKEUPMODE      0xc0425af9
-#define VFDGETTIME            0xc0425afa
-#define VFDSETTIME            0xc0425afb
-#define VFDSTANDBY            0xc0425afc
-#define VFDREBOOT             0xc0425afd
-#define VFDSETLED             0xc0425afe
-#define VFDSETMODE            0xc0425aff
-
-#define VFDGETWAKEUPTIME      0xc0425b00
-#define VFDGETVERSION_1       0xc0425b01
-#define VFDSETDISPLAYTIME     0xc0425b02
-#define VFDSETTIMEMODE        0xc0425b03
-#endif
-
-#define VFDSETRF_CUB          0xc0425af7 /* Cuberevo/micom specific */
-#define VFDSETFAN             0xc0425af8 /* Cuberevo/micom specific */
-#define VFDGETWAKEUPTIME_CUB  0xc0425b00 /* Cuberevo/micom specific */
-#define VFDGETVERSION_CUB     0xc0425b01 /* Cuberevo/micom specific */
-#define VFDSETDISPLAYTIME_CUB 0xc0425b02 /* Cuberevo/micom specific */
-#define VFDSETTIMEMODE        0xc0425b03 /* Cuberevo/micom specific */
-#define VFDSETWAKEUPTIME_CUB  0xc0425b04 /* Cuberevo/micom specific */
-#define VFDLEDBRIGHTNESS_CUB  0xc0425b05 /* Cuberevo/micom specific */
-
-struct set_brightness_s
-{
-	int level;
-};
-
-struct set_icon_s
-{
-	int icon_nr;
-	int on;
-};
-
-struct set_led_s
-{
-	int led_nr;
-	int state; 	/* state: 0 = off, 1 = on, 2 = slow, 3 = fast */
-};
-
-struct set_fan_s
-{
-	int on;
-};
-
-struct set_rf_s
-{
-	int on;
-};
-
-struct set_display_time_s
-{
-	int on;
-};
-
-/* YYMMDDhhmm */
-struct time_10_s
-{
-	char time[10];
-};
-
-/* YYMMDDhhmmss */
-struct time_12_s
-{
-	char time[12];
-};
-
-/* this sets the mode temporarily (for one ioctl)
- * to the desired mode. currently the "normal" mode
- * is the compatible vfd mode
- */
-struct set_mode_s
-{
-	int compat; /* 0 = compatibility mode to vfd driver; 1 = micom mode */
-};
-
-struct set_timemode_s
-{
-	int twentyFour;
-};
-
-struct get_wakeupstatus_s
-{
-	char status;
-};
-
-/* 0 = 12dot 12seg, 1 = 13grid, 2 = 12 dot 14seg, 3 = 7seg */
-struct get_version_s
-{
-	int version;
-};
-
-#if defined MODEL_SPECIFIC
-struct modelspecific_s
-{
-	char data[19]; //the bytes to send, and returned
-};
-#endif
-
-struct micom_ioctl_data
-{
-	union
-	{
-		struct set_icon_s icon;
-		struct set_led_s led;
-		struct set_fan_s fan;
-		struct set_rf_s rf;
-		struct set_brightness_s brightness;
-		struct set_mode_s mode;
-		struct time_10_s wakeup_time;
-		struct time_12_s time;
-		struct get_wakeupstatus_s status;
-		struct set_display_time_s display_time;
-		struct get_version_s version;
-		struct set_timemode_s timemode;
-#if defined MODEL_SPECIFIC
-		struct modelspecific_s modelspecific;
-#endif
-	} u;
-};
-#endif
-// vim:ts=4
diff -Naur sh4-apps/tools/fp_control/Fortis.c taapat-apps/tools/fp_control/Fortis.c
--- sh4-apps/tools/fp_control/Fortis.c	2019-03-11 00:22:35.921225046 +0200
+++ taapat-apps/tools/fp_control/Fortis.c	1970-01-01 01:00:00.000000000 +0100
@@ -1,837 +0,0 @@
-/*
- * Fortis.c
- *
- * (c) 2009 dagobert@teamducktales
- *
- * This program is free software; you can redistribute it and/or modify
- * it under the terms of the GNU General Public License as published by
- * the Free Software Foundation; either version 2 of the License, or
- * (at your option) any later version.
- *
- * This program is distributed in the hope that it will be useful,
- * but WITHOUT ANY WARRANTY; without even the implied warranty of
- * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the
- * GNU General Public License for more details.
- *
- * You should have received a copy of the GNU General Public License
- * along with this program; if not, write to the Free Software
- * Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA 02111-1307 USA
- *
- *****************************************************************************
- *
- * Changes
- *
- * Date     By              Description
- * --------------------------------------------------------------------------
- * 20130930 Audioniek       Fortis specific usage added.
- * 20170103 Audioniek       VFDTEST (-ms command) fixed.
- * 20170127 Audioniek       Get version fixed.
- *
- ****************************************************************************/
-
-/* ******************* includes ************************ */
-#include <stdio.h>
-#include <stdlib.h>
-#include <string.h>
-#include <time.h>
-#include <sys/types.h>
-#include <sys/stat.h>
-#include <fcntl.h>
-#include <unistd.h>
-#include <limits.h>
-#include <sys/ioctl.h>
-#include <linux/input.h>
-#include <math.h>
-
-#include "global.h"
-#include "Fortis.h"
-
-static int setText(Context_t *context, char *theText);
-static int Clear(Context_t *context);
-static int setIcon(Context_t *context, int which, int on);
-//extern int gmt_offset;
-
-/* ******************* constants ************************ */
-
-#define cVFD_DEVICE "/dev/vfd"
-#define cRTC_OFFSET_FILE "/proc/stb/fp/rtc_offset"
-#define cEVENT_DEVICE "/dev/input/event0"
-
-#define cMAXCharsFortis 12
-
-typedef struct
-{
-	char *arg;
-	char *arg_long;
-	char *arg_description;
-} tArgs;
-
-tArgs vFArgs[] =
-{
-	{ "-e", "  --setTimer         * ", "Args: [time date]  Format: HH:MM:SS dd-mm-YYYY" },
-	{ "", "                         ", "      No arg: Set the most recent timer from e2 or neutrino" },
-	{ "", "                         ", "      to the frontcontroller and shutdown" },
-	{ "", "                         ", "      Arg time date: Set frontcontroller wake up time to" },
-	{ "", "                         ", "      time, shutdown, and wake up at given time" },
-	{ "-d", "  --shutdown         * ", "Args: None or [time date]  Format: HH:MM:SS dd-mm-YYYY" },
-	{ "", "                         ", "      No arg: Shut down immediately" },
-	{ "", "                         ", "      Arg time date: Shut down at given time/date" },
-	{ "-r", "  --reboot           * ", "Args: None" },
-	{ "", "                         ", "      No arg: Reboot immediately" },
-	{ "", "                         ", "      Arg time date: Reboot at given time/date" },
-	{ "-g", "  --getTime          * ", "Args: None        Display currently set frontprocessor time" },
-	{ "-gs", " --getTimeAndSet    * ", "Args: None" },
-	{ "", "                         ", "      Set system time to current frontprocessor time" },
-	{ "", "                         ", "      WARNING: system date will be 01-01-1970!" },
-	{ "-gw", " --getWTime         * ", "Args: None        Get the current frontcontroller wake up time" },
-	{ "-st", " --setWakeTime      * ", "Args: time date   Format: HH:MM:SS dd-mm-YYYY" },
-	{ "", "                         ", "      Set the frontcontroller wake up time" },
-	{ "-s", "  --setTime          * ", "Args: time date   Format: HH:MM:SS dd-mm-YYYY" },
-	{ "", "                         ", "      Set the frontprocessor time" },
-	{ "-sst", "--setSystemTime    * ", "Args: None        Set front processor time to system time" },
-	{ "-p", "  --sleep            * ", "Args: time date   Format: HH:MM:SS dd-mm-YYYY" },
-	{ "", "                         ", "      Reboot receiver via fp at given time" },
-	{ "-t", "  --settext            ", "Args: text        Set text to frontpanel" },
-	{ "-l", "  --setLed             ", "Args: LED# int    LED#: int=brightness (0..31)" },
-	{ "-i", "  --setIcon            ", "Args: icon# 1|0   Set an icon on or off" },
-	{ "-b", "  --setBrightness      ", "Arg : 0..7        Set display brightness" },
-	{ "-w", "  --getWakeupReason    ", "Args: None        Get the wake up reason" },
-	{ "-L", "  --setLight           ", "Arg : 0|1         Set display on/off" },
-	{ "-c", "  --clear              ", "Args: None        Clear display, all icons and LEDs off" },
-	{ "-v", "  --version            ", "Args: None        Get version info from frontprocessor" },
-	{ "-tm", " --time_mode          ", "Arg : 0/1         Set time mode" },
-#if defined MODEL_SPECIFIC
-	{ "-ms", " --model_specific     ", "Args: int1 [int2] [int3] ... [int16]   (note: input in hex)" },
-	{ "", "                         ", "                  Model specific test function" },
-#endif
-	{ NULL, NULL, NULL }
-};
-
-typedef struct
-{
-	int display;
-	int display_custom;
-	char *timeFormat;
-
-	time_t wakeupTime;
-	int wakeupDecrement;
-} tFortisPrivate;
-
-/* ******************* helper/misc functions ****************** */
-
-static void setMode(int fd)
-{
-	struct nuvoton_ioctl_data nuvoton;
-
-	nuvoton.u.mode.compat = 1;
-	if (ioctl(fd, VFDSETMODE, &nuvoton) < 0)
-	{
-		perror("Set compatibility mode");
-	}
-}
-
-unsigned long calcGetNuvotonTime(char *nuvotonTimeString)
-{
-	unsigned int    mjd     = ((nuvotonTimeString[0] & 0xFF) * 256) + (nuvotonTimeString[1] & 0xFF);
-	unsigned long   epoch   = ((mjd - 40587) * 86400);
-	unsigned int    hour    = nuvotonTimeString[2] & 0xFF;
-	unsigned int    min     = nuvotonTimeString[3] & 0xFF;
-	unsigned int    sec     = nuvotonTimeString[4] & 0xFF;
-
-	epoch += (hour * 3600 + min * 60 + sec);
-	return epoch;
-}
-
-/* Calculate the time value which we can pass to
- * the nuvoton fp. it is a mjd time (mjd=modified
- * julian date). mjd is relative to gmt so theTime
- * must be in GMT/UTC.
- */
-void calcSetNuvotonTime(time_t theTime, char *destString)
-{
-	struct tm *now_tm;
-	int mjd;
-
-	now_tm = gmtime(&theTime);
-	mjd = (int)modJulianDate(now_tm);
-	destString[0] = (mjd >> 8);
-	destString[1] = (mjd & 0xff);
-	destString[2] = now_tm->tm_hour;
-	destString[3] = now_tm->tm_min;
-	destString[4] = now_tm->tm_sec;
-}
-
-/* ******************* driver functions ****************** */
-
-static int init(Context_t *context)
-{
-	tFortisPrivate *private = malloc(sizeof(tFortisPrivate));
-	int vFd;
-
-	vFd = open(cVFD_DEVICE, O_RDWR);
-	if (vFd < 0)
-	{
-		fprintf(stderr, "Cannot open %s\n", cVFD_DEVICE);
-		perror("");
-	}
-	((Model_t *)context->m)->private = private;
-	memset(private, 0, sizeof(tFortisPrivate));
-	checkConfig(&private->display, &private->display_custom, &private->timeFormat, &private->wakeupDecrement);
-	return vFd;
-}
-
-static int usage(Context_t *context, char *prg_name, char *cmd_name)
-{
-	int i;
-
-	fprintf(stderr, "Usage:\n\n");
-	fprintf(stderr, "%s argument [optarg1] [optarg2]\n", prg_name);
-	for (i = 0; ; i++)
-	{
-		if (vFArgs[i].arg == NULL)
-		{
-			break;
-		}
-		if ((cmd_name == NULL) || (strcmp(cmd_name, vFArgs[i].arg) == 0) || (strstr(vFArgs[i].arg_long, cmd_name) != NULL))
-		{
-			fprintf(stderr, "%s   %s   %s\n", vFArgs[i].arg, vFArgs[i].arg_long, vFArgs[i].arg_description);
-		}
-	}
-	fprintf(stderr, "Options marked * should be the only calling argument.\n");
-	return 0;
-}
-
-static int setTime(Context_t *context, time_t *theGMTTime)
-{
-	// -s command
-	struct nuvoton_ioctl_data vData;
-
-	calcSetNuvotonTime(*theGMTTime, vData.u.time.time);
-	if (ioctl(context->fd, VFDSETTIME, &vData) < 0)
-	{
-		perror("Set time");
-		return -1;
-	}
-	return 0;
-}
-
-static int getTime(Context_t *context, time_t *theGMTTime)
-{
-	// -g command
-	char fp_time[8];
-
-	if (ioctl(context->fd, VFDGETTIME, &fp_time) < 0)
-	{
-		perror("Get time");
-		return -1;
-	}
-	/* if we get the fp time */
-	if (fp_time[0] != '\0')
-	{
-		*theGMTTime = (time_t)calcGetNuvotonTime(fp_time);
-	}
-	else
-	{
-		fprintf(stderr, "Error reading time from fp\n");
-		*theGMTTime = 0;
-	}
-	return 0;
-}
-
-static int setSTime(Context_t *context, time_t *theGMTTime)
-{
-	// -sst command
-	time_t curTime;
-	char fp_time[8];
-	time_t curTimeFP;
-	struct tm *ts_gmt;
-	int gmt_offset;
-	int proc_fs;
-	FILE *proc_fs_file;
-
-	time(&curTime); // get system time in UTC
-	ts_gmt = gmtime(&curTime);
-	gmt_offset = get_GMT_offset(*ts_gmt);
-	printf("Current system time: %02d:%02d:%02d %02d-%02d-%04d (local)\n", ts_gmt->tm_hour + (gmt_offset / 3600), ts_gmt->tm_min, ts_gmt->tm_sec,
-		ts_gmt->tm_mday, ts_gmt->tm_mon + 1, ts_gmt->tm_year + 1900);
-	curTime += gmt_offset;
-	setTime(context, &curTime); // set fp clock to local time
-
-	/* Read fp time back */
-	if (ioctl(context->fd, VFDGETTIME, &fp_time) < 0)
-	{
-		perror("Gettime");
-		return -1;
-	}
-	curTimeFP = (time_t)calcGetNuvotonTime(fp_time);
-	ts_gmt = gmtime(&curTimeFP);
-	printf("Front panel time set to: %02d:%02d:%02d %02d-%02d-%04d (local)\n", ts_gmt->tm_hour, ts_gmt->tm_min, ts_gmt->tm_sec,
-		ts_gmt->tm_mday, ts_gmt->tm_mon + 1, ts_gmt->tm_year + 1900);
-
-	// write UTC offset to /proc/stb/fp/rtc_offset
-	proc_fs_file = fopen(cRTC_OFFSET_FILE, "w");
-	if (proc_fs_file == NULL)
-	{
-		perror("Open rtc_offset");
-		return -1;
-	}
-	proc_fs = fprintf(proc_fs_file, "%d", gmt_offset);
-	if (proc_fs < 0)
-	{
-		perror("Write rtc_offset");
-		return -1;
-	}
-	fclose(proc_fs_file);
-	printf("Note: /proc/stb/fp/rtc_offset set to: %+d seconds.\n", gmt_offset);
-
-	return 0;
-}
-
-static int setTimer(Context_t *context, time_t *theGMTTime)
-{
-	// -e command, OK
-	time_t curTime;
-	time_t curTimeFP = 0;
-	time_t wakeupTime;
-	struct tm *ts_gmt;
-	int gmt_offset;
-	struct tm *tsw;
-	struct nuvoton_ioctl_data vData;
-
-	time(&curTime); // get system time in UTC
-	ts_gmt = gmtime(&curTime);
-	gmt_offset = get_GMT_offset(*ts_gmt);
-	printf("Current system time: %02d:%02d:%02d %02d-%02d-%04d (local)\n", ts_gmt->tm_hour + (gmt_offset / 3600), ts_gmt->tm_min, ts_gmt->tm_sec,
-		ts_gmt->tm_mday, ts_gmt->tm_mon + 1, ts_gmt->tm_year + 1900);
-
-	if (theGMTTime == NULL) // -e no argument = shutdown until next e2/neutrino timer
-	{
-		wakeupTime = read_timers_utc(curTime); //get current 1st timer
-		wakeupTime += gmt_offset; // timers are stored in UTC
-	}
-	else
-	{
-		wakeupTime = *theGMTTime; //get specified time (assumed local)
-	}
-	curTime += gmt_offset;
-	// check --> wakeupTime is set and larger than curTime and no larger than 300 days in the future
-	// check --> there is no timer set
-	if ((wakeupTime <= 0) || ((wakeupTime == LONG_MAX)) || (curTime > wakeupTime) || (curTime < (wakeupTime - 25920000)))
-	{
-		/* shut down immedately */
-		printf("No timers set or 1st timer more than 300 days ahead,\nor all timer(s) in the past.\n");
-//		wakeupTime = read_fake_timer_utc(curTime) = gmt_offset; //Set wake up time to max. in the future
-		wakeupTime = LONG_MAX;
-	}
-	else // wake up time valid and in the coming 300 days
-	{
-		unsigned long diff;
-		char fp_time[8];
-
-		/* Determine difference between system time and wake up time */
-		diff = (unsigned long int) wakeupTime - curTime;
-
-		/* Check if front panel clock is set properly */
-		if (ioctl(context->fd, VFDGETTIME, &fp_time) < 0)
-		{
-			perror("Gettime");
-			return -1;
-		}
-
-		if (fp_time[0] != '\0')
-		{
-			curTimeFP = (time_t)calcGetNuvotonTime(fp_time);
-			/* set FP-Time if system time is more than 5 minutes off */
-			if (((curTimeFP - curTime) > 300) || ((curTime - curTimeFP) > 300))
-			{
-				printf("Time difference between fp and system: %+d seconds.\n", (int)(curTimeFP - curTime));
-				setTime(context, &curTime); // sync fp clock
-				curTimeFP = curTime;
-				ts_gmt = gmtime(&curTimeFP);
-				printf("Front panel time corrected, set to: %02d:%02d:%02d %02d-%02d-%04d (local)\n",
-					ts_gmt->tm_hour, ts_gmt->tm_min, ts_gmt->tm_sec, ts_gmt->tm_mday, ts_gmt->tm_mon + 1, ts_gmt->tm_year + 1900);
-			}
-		}
-		else
-		{
-			fprintf(stderr, "Error reading front panel time... using system time.\n");
-			curTimeFP = curTime;
-		}
-		wakeupTime = curTimeFP + diff;
-	}
-
-	tsw = gmtime(&wakeupTime);
-	printf("Wake up Time: %02d:%02d:%02d %02d-%02d-%04d (local)\n", tsw->tm_hour, tsw->tm_min,
-		tsw->tm_sec, tsw->tm_mday, tsw->tm_mon + 1, tsw->tm_year + 1900);
-	calcSetNuvotonTime(wakeupTime, vData.u.standby.time);
-	sleep(1);
-	if (ioctl(context->fd, VFDSTANDBY, &vData) < 0)
-	{
-		perror("Shut down");
-		return -1;
-	}
-	return 0;
-}
-
-static int getWTime(Context_t *context, time_t *theGMTTime)
-{
-	//-gw command: VFDGETWAKEUPTIME not supported by older nuvotons
-	char fp_time[5];
-	time_t iTime;
-
-	/* front controller wake up time */
-	if (ioctl(context->fd, VFDGETWAKEUPTIME, &fp_time) < 0)
-	{
-		perror("Get wakeup time");
-		return -1;
-	}
-	/* if we get the fp wakeup time */
-	if (fp_time[0] != '\0')
-	{
-		iTime = (time_t)calcGetNuvotonTime(fp_time);
-		*theGMTTime = iTime;
-	}
-	else
-	{
-		fprintf(stderr, "Error reading wake up time from frontprocessor\n");
-		*theGMTTime = 0;
-		return -1;
-	}
-	return 0;
-}
-
-static int setWTime(Context_t *context, time_t *theGMTTime)
-{
-	//-st command
-	struct nuvoton_ioctl_data vData;
-	struct tm *swtm;
-	int gmt_offset;
-	time_t wakeupTime;
-	int proc_fs;
-	FILE *proc_fs_file;
-
-	wakeupTime = *theGMTTime;
-	swtm = gmtime(&wakeupTime);
-	gmt_offset= get_GMT_offset(*swtm);
-	printf("Setting wake up time to %02d:%02d:%02d %02d-%02d-%04d (local, seconds ignored)\n", swtm->tm_hour + (gmt_offset / 3600),
-		swtm->tm_min, swtm->tm_sec, swtm->tm_mday, swtm->tm_mon + 1, swtm->tm_year + 1900);
-	wakeupTime += gmt_offset;
-
-	calcSetNuvotonTime(wakeupTime, vData.u.standby.time);
-	if (ioctl(context->fd, VFDSETPOWERONTIME, &vData) < 0)
-	{
-		perror("Set wake up time");
-		return -1;
-	}
-
-	// write UTC offset to /proc/stb/fp/rtc_offset
-	proc_fs_file = fopen(cRTC_OFFSET_FILE, "w");
-	if (proc_fs_file == NULL)
-	{
-		perror("Open rtc_offset");
-		return -1;
-	}
-	proc_fs = fprintf(proc_fs_file, "%d", gmt_offset);
-	if (proc_fs < 0)
-	{
-		perror("Write rtc_offset");
-		return -1;
-	}
-	fclose(proc_fs_file);
-	printf("Note: /proc/stb/fp/rtc_offset set to: %+d seconds.\n", gmt_offset);
-	return 0;
-}
-
-static int shutdown(Context_t *context, time_t *shutdownTimeGMT)
-{
-	// -d command to check
-	time_t curTime;
-
-	/* shutdown immediately */
-	if (*shutdownTimeGMT == -1)
-	{
-		return (setTimer(context, NULL));
-	}
-	while (1)
-	{
-		time(&curTime);
-		if (curTime >= *shutdownTimeGMT)
-		{
-			/* set most recent e2 timer and shut down */
-			return (setTimer(context, NULL));
-		}
-		usleep(100000);
-	}
-	return -1;
-}
-
-static int reboot(Context_t *context, time_t *rebootTimeGMT)
-{
-	//-r command to check
-	time_t curTime;
-	struct nuvoton_ioctl_data vData;
-
-	while (1)
-	{
-		time(&curTime);
-		if (curTime >= *rebootTimeGMT)
-		{
-			if (ioctl(context->fd, VFDREBOOT, &vData) < 0)
-			{
-				perror("Reboot");
-				return -1;
-			}
-		}
-		usleep(100000);
-	}
-	return 0;
-}
-
-static int Sleep(Context_t *context, time_t *wakeUpGMT)
-{
-	// -p command
-	time_t curTime;
-	int gmt_offset;
-	struct tm *ts;
-	int sleep = 1;
-	fd_set rfds;
-	struct timeval tv;
-	int vFd;
-	int retval, i, rd;
-	char output[cMAXCharsFortis + 1];
-	struct input_event ev[64];
-
-	tFortisPrivate *private = (tFortisPrivate *)((Model_t *)context->m)->private;
-	vFd = open(cEVENT_DEVICE, O_RDWR);
-	if (vFd < 0)
-	{
-		fprintf(stderr, "Cannot open %s\n", cEVENT_DEVICE);
-		perror("");
-		return -1;
-	}
-	while (sleep)
-	{
-		time(&curTime);  // get system time (UTC)
-		ts = gmtime(&curTime);
-		gmt_offset = get_GMT_offset(*ts);
-		curTime += gmt_offset;
-
-		if (curTime >= *wakeUpGMT)
-		{
-			sleep = 0;
-		}
-		else
-		{
-			FD_ZERO(&rfds);
-			FD_SET(vFd, &rfds);
-			tv.tv_sec = 0;
-			tv.tv_usec = 100000;
-			retval = select(vFd + 1, &rfds, NULL, NULL, &tv);
-			if (retval > 0)
-			{
-				rd = read(vFd, ev, sizeof(struct input_event) * 64);
-				if (rd < (int) sizeof(struct input_event))
-				{
-					continue;
-				}
-				for (i = 0; i < rd / sizeof(struct input_event); i++)
-				{
-					if (ev[i].type == EV_SYN)
-					{
-					}
-					else if (ev[i].type == EV_MSC && (ev[i].code == MSC_RAW || ev[i].code == MSC_SCAN))
-					{
-					}
-					else
-					{
-						if (ev[i].code == 116)
-						{
-							sleep = 0;
-						}
-					}
-				}
-			}
-		}
-		if (private->display)
-		{
-			strftime(output, cMAXCharsFortis + 1, private->timeFormat, ts);
-			setText(context, output);
-		}
-	}
-	return 0;
-}
-
-static int setText(Context_t *context, char *theText)
-{
-	// -t command
-	char vHelp[128];
-
-//	strncpy(vHelp, theText, cMAXCharsFortis);
-	strncpy(vHelp, theText, 64);
-//	vHelp[cMAXCharsFortis] = '\0';
-	vHelp[64] = '\0';
-	write(context->fd, vHelp, strlen(vHelp));
-	return 0;
-}
-
-static int setLed(Context_t *context, int which, int level)
-{
-	// -l command
-	struct nuvoton_ioctl_data vData;
-
-	if (level < 0 || level > 31)
-	{
-		printf("Illegal brightness level %d (valid is 0..31)\n", level);
-		return -1;
-	}
-
-	if (which < 8)
-	{
-		if (which < 0)
-		{
-			printf("Illegal LED number %d (valid is 0..7)\n", which);
-			return 0;
-		}
-		else
-		{
-			vData.u.led.led_nr = 1 << which; //LED# is bitwise in Fortis
-		}
-	}
-	else // allow more than one led to be set at once
-	{
-		vData.u.led.led_nr = which;
-	}
-
-	vData.u.led.on = level;
-	setMode(context->fd);
-	if (ioctl(context->fd, VFDSETLED, &vData) < 0)
-	{
-		perror("SetLED");
-		return -1;
-	}
-	usleep(100000); //allow frontprocessor to keep up
-	return 0;
-}
-
-static int setIcon(Context_t *context, int which, int on)
-{
-	// -i command
-	struct nuvoton_ioctl_data vData;
-
-	vData.u.icon.icon_nr = which;
-	vData.u.icon.on = on;
-	setMode(context->fd);
-	if (ioctl(context->fd, VFDICONDISPLAYONOFF, &vData) < 0)
-	{
-		perror("Set icon");
-		return -1;
-	}
-	return 0;
-}
-
-static int setBrightness(Context_t *context, int brightness)
-{
-	//-b command, OK
-	struct nuvoton_ioctl_data vData;
-
-	if (brightness < 0 || brightness > 7)
-	{
-		printf("Illegal brightness level %d (valid is 0..7)\n", brightness);
-		return -1;
-	}
-	vData.u.brightness.level = brightness;
-	setMode(context->fd);
-	if (ioctl(context->fd, VFDBRIGHTNESS, &vData) < 0)
-	{
-		perror("Set VFD brightness");
-		return -1;
-	}
-	return 0;
-}
-
-static int Clear(Context_t *context)
-{
-	// -c command
-	int i;
-	int led_nr;
-
-	setText(context, "            ");  //show no text
-	led_nr = 1;
-	for (i = 0; i <= 7; i++)
-	{
-		setLed(context, led_nr, 0); //all leds off
-	}
-	for (i = 1; i < 40; i++) //all icons off
-	{
-		setIcon(context, i, 0);
-	}
-	return 0;
-}
-
-static int setLight(Context_t *context, int on)
-{
-	// -L command, OK
-	struct nuvoton_ioctl_data vData;
-
-	vData.u.light.onoff = on;
-//	setMode(context->fd);
-	if (ioctl(context->fd, VFDDISPLAYWRITEONOFF, &vData) < 0)
-	{
-		perror("Set light");
-		return -1;
-	}
-	return 0;
-}
-
-static int getWakeupReason(Context_t *context, eWakeupReason *reason)
-{
-	//-w command, OK
-	int mode = -1;
-
-	if (ioctl(context->fd, VFDGETWAKEUPMODE, &mode) < 0)
-	{
-		perror("Get wakeup reason");
-		return -1;
-	}
-	if (mode != '\0')  /* if we get a fp wake up reason */
-	{
-		*reason = mode & 0xff; //get LS byte
-	}
-	else
-	{
-		fprintf(stderr, "Error reading wakeup mode from frontprocessor\n");
-		*reason = 0;  //echo unknown
-	}
-	return 0;
-}
-
-static int getVersion(Context_t *context, int *version)
-{
-	//-v command
-	int fp_version;
-	int resellerID;
-
-	if (ioctl(context->fd, VFDGETVERSION, &fp_version, &resellerID) < 0) // get version info
-	{
-		perror("Get version info");
-		return -1;
-	}
-	if (fp_version != '\0')  /* if the version info is OK */
-	{
-		*version = fp_version;
-	}
-	else
-	{
-		*version = -1;
-	}
-	if (resellerID != '\0')  /* if the reseller info is OK */
-	{
-		printf("Reseller ID is %08X\n", resellerID);
-	}
-	else
-	{
-		printf("Reseller ID is unknown\n");
-	}
-	return 0;
-}
-
-static int setTimeMode(Context_t *context, int timemode)
-{
-	// -tm command, OK
-	struct nuvoton_ioctl_data vData;
-
-	vData.u.timemode.timemode = timemode;
-//	setMode(context->fd);
-	if (ioctl(context->fd, VFDSETTIMEFORMAT, &vData) < 0)
-	{
-		perror("Set time mode");
-		return -1;
-	}
-	return 0;
-}
-
-#if defined MODEL_SPECIFIC
-static int modelSpecific(Context_t *context, char len, unsigned char *data)
-{
-	//-ms command
-	int i, res;
-	char testdata[18];
-
-	testdata[0] = len; // set length
-	
-	printf("nuvoton ioctl: VFDTEST (0x%08x) SOP CMD=", VFDTEST);
-	for (i = 0; i < len; i++)
-	{
-		testdata[i + 1] = data[i];
-		printf("0x%02x ", data[i] & 0xff);
-	}
-	printf("EOP\n");
-
-	memset(data, 0, 18);
-
-//	setMode(context->fd); //set mode 1
-
-	res = (ioctl(context->fd, VFDTEST, &testdata) < 0);
-
-	if (res < 0)
-	{
-		perror("Model specific");
-		return -1;
-	}
-	else
-	{
-		for (i = 0; i < ((testdata[1] == 1) ? 11 : 2); i++)
-		{
-			data[i] = testdata[i]; //return values
-		}
-	}
-	return testdata[0];
-}
-#endif
-
-static int Exit(Context_t *context)
-{
-	tFortisPrivate *private = (tFortisPrivate *)((Model_t *)context->m)->private;
-
-	if (context->fd > 0)
-	{
-		close(context->fd);
-	}
-	free(private);
-	return 1;
-}
-
-Model_t Fortis_model =
-{
-	.Name             = "Fortis frontpanel control utility",
-	.Type             = Fortis,
-	.Init             = init,
-	.Clear            = Clear,
-	.Usage            = usage,
-	.SetTime          = setTime,
-	.GetTime          = getTime,
-	.SetTimer         = setTimer,
-	.GetWTime         = getWTime,
-	.SetWTime         = setWTime,
-	.SetSTime         = setSTime,
-	.Shutdown         = shutdown,
-	.Reboot           = reboot,
-	.Sleep            = Sleep,
-	.SetText          = setText,
-	.SetLed           = setLed,
-	.SetIcon          = setIcon,
-	.SetBrightness    = setBrightness,
-	.GetWakeupReason  = getWakeupReason,
-	.SetLight         = setLight,
-	.SetLedBrightness = NULL,
-	.GetVersion       = getVersion,
-	.SetRF            = NULL,
-	.SetFan           = NULL,
-	.GetWakeupTime    = getWTime,
-	.SetDisplayTime   = NULL,
-	.SetTimeMode      = setTimeMode,
-#if defined MODEL_SPECIFIC
-	.ModelSpecific    = modelSpecific,
-#endif
-	.Exit             = Exit
-};
diff -Naur sh4-apps/tools/fp_control/Fortis.h taapat-apps/tools/fp_control/Fortis.h
--- sh4-apps/tools/fp_control/Fortis.h	2019-02-20 16:00:47.073955598 +0100
+++ taapat-apps/tools/fp_control/Fortis.h	1970-01-01 01:00:00.000000000 +0100
@@ -1,81 +0,0 @@
-#ifndef __fortis__
-#define __fortis__
-
-struct set_brightness_s
-{
-	int level;
-};
-
-struct set_icon_s
-{
-	int icon_nr;
-	int on;
-};
-
-struct set_led_s
-{
-	int led_nr;
-	int on;
-};
-
-struct set_light_s
-{
-	int onoff;
-};
-
-/* time must be given as follows:
- * time[0] = mjd high
- * time[1] = mjd low
- * time[2] = hour
- * time[3] = min
- * time[4] = sec
- */
-struct set_standby_s
-{
-	char time[5];
-};
-
-struct set_time_s
-{
-	char time[5];
-};
-
-/* this sets the mode temporarily (for one ioctl)
- * to the desired mode. currently the "normal" mode
- * is the compatible vfd mode
- */
-struct set_mode_s
-{
-	int compat; /* 0 = compatibility mode to vfd driver; 1 = nuvoton mode */
-};
-
-struct set_timemode_s
-{
-	char timemode;
-};
-
-#if defined MODEL_SPECIFIC
-struct modelspecific_s
-{
-	char data[19]; //the bytes to send, and returned
-};
-#endif
-
-struct nuvoton_ioctl_data
-{
-	union
-	{
-		struct set_icon_s icon;
-		struct set_led_s led;
-		struct set_brightness_s brightness;
-		struct set_light_s light;
-		struct set_mode_s mode;
-		struct set_standby_s standby;
-		struct set_time_s time;
-		struct set_timemode_s timemode;
-#if defined MODEL_SPECIFIC
-		struct modelspecific_s modelspecific;
-#endif
-	} u;
-};
-#endif
diff -Naur sh4-apps/tools/fp_control/fp_control.c taapat-apps/tools/fp_control/fp_control.c
--- sh4-apps/tools/fp_control/fp_control.c	2019-03-09 07:59:43.000000000 +02000
+++ taapat-apps/tools/fp_control/fp_control.c	2019-03-16 15:21:58.000000000 +0200
@@ -10,7 +10,7 @@
  *
  * This program is distributed in the hope that it will be useful,
  * but WITHOUT ANY WARRANTY; without even the implied warranty of
- * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
  * GNU General Public License for more details.
  *
  * You should have received a copy of the GNU General Public License
@@ -19,6 +19,12 @@
  *
  */
 
+/*
+ * added:
+ * powerLed intensity adjustment
+ * by zeroone
+ */
+
 #include <fcntl.h>
 #include <stdio.h>
 #include <stdlib.h>
@@ -34,229 +40,189 @@
 ////////////////////////////////////////////////////////////////////////////////////////////////////
 ////////////////////////////////////////////////////////////////////////////////////////////////////
 
-/* Software version of fp_control, please increase on every change */
-static const char *sw_version = "1.10Audioniek 20190308.1";
-static eWakeupReason reason = 0;
+/* software version of fp_control. please increas on every change */
+static const char* sw_version = "1.03";
 
 typedef struct
 {
-	char *arg;
-	char *arg_long;
-	char *arg_description;
+	char* arg;
+	char* arg_long;
+	char* arg_description;
 } tArgs;
 
-time_t *theGMTTime;
-//int gmt_offset;
-char vName[129] = "Unknown";
-int Vdisplay = 0; //
-int Vdisplay_custom = 0;
-char *VtimeFormat = "Unknown";
-int Vwakeup = 5 * 60; //default wakeup decrement in minutes
-const char *wakeupreason[8] = { "Unknown", "Power on", "From deep standby", "Timer", "Power switch", "Unknown", "Unknown", "Unknown" };
-
 tArgs vArgs[] =
 {
-	{ "-e", "  --setTimer         * ", "Args: None or [time date] in format HH:MM:SS dd-mm-YYYY \
+   { "-e", "--setTimer       ",
+"Args: No arguments or [time date] Format: HH:MM:SS dd-mm-YYYY \
 \n\tSet the most recent timer from e2 or neutrino to the frontcontroller and standby \
-\n\tSet the current frontcontroller wake-up time" 
-	},
-	{ "-d", "  --shutDown         * ", "Args: [time date] Format: HH:MM:SS dd-mm-YYYY\n\tMimics shutdown command. Shutdown receiver via fc at given time." },
-	{ "-g", "  --getTime          * ", "Args: No arguments\n\tReturn current set frontcontroller time" },
-	{ "-gs", " --getTimeAndSet    * ", "Args: No arguments\n\tSet system time to current frontcontroller time" },
-	{ "-gw", " --getWakeupTime    * ", "Args: No arguments\n\tReturn current wakeup time" },
-	{ "-s", "  --setTime          * ", "Args: time date Format: HH:MM:SS dd-mm-YYYY\n\tSet the frontcontroller time" },
-	{ "-sst", "--setSystemTime    * ", "Args: No arguments\n\tSet the frontcontroller time equal to system time" },
-	{ "-gt", " --getWakeTime      * ", "Args: No arguments\n\tGet the frontcontroller wake up time" },
-	{ "-st", " --setWakeTime      * ", "Args: time date Format: HH:MM:SS dd-mm-YYYY\n\tSet the frontcontroller wake up time" },
-	{ "-r", "  --reboot           * ", "Args: time date Format: HH:MM:SS dd-mm-YYYY\n\tReboot receiver via fc at given time" },
-	{ "-p", "  --sleep            * ", "Args: time date Format: HH:MM:SS dd-mm-YYYY\n\tSleep receiver via fc until given time" },
-	{ "-t", "  --settext            ", "Arg : text\n\tSet text to frontpanel." },
-	{ "-l", "  --setLed             ", "Args: led on\n\tSet a led on or off" },
-	{ "-i", "  --setIcon            ", "Args: icon on\n\tSet an icon on or off" },
-	{ "-b", "  --setBrightness      ", "Arg : brightness 0..7\n\tSet display brightness" },
-	{ "-led", "--setLedBrightness   ", "Arg : brightness\n\tSet LED brightness" },
-	{ "-w", "  --getWakeupReason  * ", "Args: No arguments\n\tGet the wake-up reason" },
-	{ "-L", "  --setLight           ", "Arg : 0/1\n\tSet light" },
-	{ "-c", "  --clear              ", "Args: No arguments\n\tClear display, all icons and leds off" },
-	{ "-v", "  --version            ", "Args: No arguments\n\tGet version from fc" },
-	{ "-sf", " --setFan             ", "Arg : 0/1\n\tSet fan on/off" },
-	{ "-sr", " --setRF              ", "Arg : 0/1\n\tSet rf modulator on/off" },
-	{ "-dt", " --display_time       ", "Arg : 0/1\n\tSet time display on/off" },
-	{ "-tm", " --time_mode          ", "Arg : 0/1\n\tSet 12 or 24 hour time mode" },
-	{ "-V", "  --verbose            ", "Args: None\n\tVerbose operation" },
-#if defined MODEL_SPECIFIC
-	{ "-ms", " --set_model_specific ", "Args: int\n\tModel specific set function (note: hex input)" },
-#endif
-	{ NULL, NULL, NULL }
+\n\tSet the current frontcontroller wake-up time" },
+   { "-d", "--shutdown       ",
+"Args: [time date] Format: HH:MM:SS dd-mm-YYYY\n\tMimics shutdown command. Shutdown receiver via fc at given time." },
+
+   { "-g", "--getTime        ",
+"Args: No arguments\n\tReturn current set frontcontroller time" },
+   { "-gs", "--getTimeAndSet        ",
+"Args: No arguments\n\tSet system time to current frontcontroller time" },
+   { "-s", "--setTime        ",
+"Args: time date Format: HH:MM:SS dd-mm-YYYY\n\tSet the current frontcontroller time" },
+   { "-gt", "--getTimer       ",
+"Args: No arguments\n\tGet the current frontcontroller wake-up time" },
+
+   { "-r", "--reboot         ",
+"Args: time date Format: HH:MM:SS dd-mm-YYYY\n\tReboot receiver via fc at given time." },
+   { "-p", "--sleep          ",
+"Args: time date Format: HH:MM:SS dd-mm-YYYY\n\tReboot receiver via fc at given time." },
+   { "-t", "--settext        ",
+"Args: text\n\tSet text to frontpanel." },
+   { "-l", "--setLed         ",
+"Args: led on\n\tSet a led on or off" },
+   { "-i", "--setIcon        ",
+"Args: icon on\n\tSet an icon on or off" },
+   { "-b", "--setBrightness  ",
+"Args: brightness\n\tSet display brightness" },
+   { "-w", "--getWakeupReason",
+"Args: No arguments\n\tGet the wake-up reason" },
+   { "-L", "--setLight",
+"Args: 0/1\n\tSet light" },
+   { "-c", "--clear",
+"Args: No argumens\n\tClear display, all icons and leds off" },
+   { "-dt", "--display_timer",
+"Args: 0/1\n\tset display time on/off" },
+   { NULL, NULL, NULL }
 };
 
+const char *wakeupreason[4] = { "unknown", "poweron", "standby", "timer" };
 
-int usage(Context_t *context, char *prg, char *cmd)
+void usage(Context_t * context, char* prg, char* cmd)
 {
-	/* let the model print out what it can handle in reality */
-	if ((((Model_t *)context->m)->Usage == NULL)
-	|| (((Model_t *)context->m)->Usage(context, prg, cmd) < 0))
+	/* let the model print out what it can handle in real */
+	if ((((Model_t*)context->m)->Usage == NULL) || (((Model_t*)context->m)->Usage(context, prg) < 0))
 	{
 		int i;
+
 		/* or printout a default usage */
-		fprintf(stderr, "General usage:\n\n");
+		fprintf(stderr, "usage:\n\n");
 		fprintf(stderr, "%s argument [optarg1] [optarg2]\n", prg);
-		for (i = 0; ; i++)
+
+		for (i = 0; ;i++)
 		{
 			if (vArgs[i].arg == NULL)
-			{
 				break;
-			}
+
 			if ((cmd == NULL) || (strcmp(cmd, vArgs[i].arg) == 0) || (strstr(vArgs[i].arg_long, cmd) != NULL))
-			{
 				fprintf(stderr, "%s   %s   %s\n", vArgs[i].arg, vArgs[i].arg_long, vArgs[i].arg_description);
-			}
 		}
-		fprintf(stderr, "Options marked * should be the only calling argument.\n");
-	}
-	if (((Model_t *)context->m)->Exit)
-	{
-		((Model_t *)context->m)->Exit(context);
 	}
+
+	if (((Model_t*)context->m)->Exit)
+		((Model_t*)context->m)->Exit(context);
 	exit(1);
 }
 
 ////////////////////////////////////////////////////////////////////////////////////////////////////
 ////////////////////////////////////////////////////////////////////////////////////////////////////
 
-void getTimeFromArg(char *timeStr, char *dateStr, time_t *theTime)
-{ // timeStr, dateStr -> time_t
-	struct tm thetempTime;
-	int mjd;
-
-	sscanf(timeStr, "%d:%d:%d", &thetempTime.tm_hour, &thetempTime.tm_min, &thetempTime.tm_sec);
-	sscanf(dateStr, "%d-%d-%d", &thetempTime.tm_mday, &thetempTime.tm_mon, &thetempTime.tm_year);
-	//printf("%s > input: %02d:%02d:%02d %02d-%02d-%02d\n", __func__, thetempTime.tm_hour, thetempTime.tm_min, thetempTime.tm_sec, thetempTime.tm_mday, thetempTime.tm_mon, thetempTime.tm_year);
-	thetempTime.tm_mon  -= 1;
- 	thetempTime.tm_year -= 1900;
-
-	thetempTime.tm_isdst = -1; /* say mktime that we do not know */
-//	/* FIXME: hmm this is not a gmt or, isn't it? */
-//	theTime = mktime(&thetempTime);
-	/* FIXED: indeed, but this one is... */
-	mjd = (int)modJulianDate(&thetempTime);
-	//printf("%s date seconds: %d (time_t)\n", __func__, mjd);
-	mjd *= 86400; // MJD * seconds per day
-	//printf("%s date seconds: %d (time_t)\n", __func__, mjd);
-	mjd += thetempTime.tm_hour * 3600;
-	//printf("%s date + hour seconds: %d (time_t)\n", __func__, mjd);
-	mjd += thetempTime.tm_min * 60;
-	//printf("%s date + hour + min seconds: %d (time_t)\n", __func__, mjd);
-	mjd += thetempTime.tm_sec;
-	//printf("%s date + hour + min seconds: %d (time_t)\n", __func__, mjd);
-	*theTime = mjd;
-	//printf("%s < output: %d (time_t)\n", __func__, (int)*theTime);
+/* fixme: check if this function is correct and delivers gmt time */
+void getTimeFromArg(char* timeStr, char* dateStr, time_t* theGMTTime)
+{
+	struct tm  theTime;
+
+	printf("%s\n", __func__);
+
+	sscanf(timeStr, "%d:%d:%d",
+		&theTime.tm_hour, &theTime.tm_min, &theTime.tm_sec);
+
+	sscanf(dateStr, "%d-%d-%d",
+		&theTime.tm_mday, &theTime.tm_mon, &theTime.tm_year);
+
+	theTime.tm_year -= 1900;
+	theTime.tm_mon   = theTime.tm_mon - 1;
+
+	theTime.tm_isdst = -1; /* say mktime that we dont know */
+	/* fixme: hmm this is not a gmt or, isn't it? */
+	*theGMTTime = mktime(&theTime);
+
+	/* new_time = localtime(&dummy);*/
+	printf("%s <\n", __func__);
+
 }
 
 ////////////////////////////////////////////////////////////////////////////////////////////////////
 ////////////////////////////////////////////////////////////////////////////////////////////////////
 
-void processCommand(Context_t *context, int argc, char *argv[])
+void processCommand (Context_t * context, int argc, char* argv[])
 {
 	int i;
 
-	if (((Model_t *)context->m)->Init)
-	{
-		context->fd = ((Model_t *)context->m)->Init(context);
-	}
+	if (((Model_t*)context->m)->Init)
+		context->fd = ((Model_t*)context->m)->Init(context);
+
 	if (argc > 1)
 	{
 		i = 1;
-		while (argc > i)
+		while (i < argc)
 		{
-			if ((strcmp(argv[i], "-V") == 0) || (strcmp(argv[i], "--verbose") == 0))
-			{
-				/* switch verbose on */
-				disp = 1;
-			}
-			else if ((strcmp(argv[i], "-e") == 0) || (strcmp(argv[i], "--setTimer") == 0))
+			if ((strcmp(argv[i], "-e") == 0) || (strcmp(argv[i], "--setTimer") == 0))
 			{
 				if (argc == 4)
 				{
 					time_t theGMTTime;
 					getTimeFromArg(argv[i + 1], argv[i + 2], &theGMTTime);
 					/* set the frontcontroller timer from args */
-					if (((Model_t *)context->m)->SetTimer)((Model_t *)context->m)->SetTimer(context, &theGMTTime);
+					if (((Model_t*)context->m)->SetTimer)
+						((Model_t*)context->m)->SetTimer(context, &theGMTTime);
 					i += 2;
 				}
 				else if (argc == 2)
 				{
-					/* setup timer; wake-up time will be read */
-					if (((Model_t *)context->m)->SetTimer)((Model_t *)context->m)->SetTimer(context, NULL);
+					/* setup timer; wake-up time will be read from e2 */
+					if (((Model_t*)context->m)->SetTimer)
+						((Model_t*)context->m)->SetTimer(context, NULL);
 				}
 				else
-				{
-					usage(context, argv[0], argv[i]);
-				}
+					usage(context, argv[0], argv[1]);
 			}
 			else if ((strcmp(argv[i], "-g") == 0) || (strcmp(argv[i], "--getTime") == 0))
 			{
-				time_t theGMTTime;  //TODO: print time according to receiver mask
+				time_t theGMTTime;
 
 				/* get the frontcontroller time */
-				if (((Model_t *)context->m)->GetTime)
+				if (((Model_t*)context->m)->GetTime)
 				{
-					if (((Model_t *)context->m)->GetTime(context, &theGMTTime) == 0)
+					if (((Model_t*)context->m)->GetTime(context, &theGMTTime) == 0)
 					{
 						struct tm *gmt = gmtime(&theGMTTime);
-						printf("Current front processor time: %02d:%02d:%02d %02d-%02d-%04d\n",
-							   gmt->tm_hour, gmt->tm_min, gmt->tm_sec, gmt->tm_mday, gmt->tm_mon + 1, gmt->tm_year + 1900);
+
+						fprintf(stderr, "Current Time: %02d:%02d:%02d %02d-%02d-%04d\n",
+						     gmt->tm_hour, gmt->tm_min, gmt->tm_sec, gmt->tm_mday, gmt->tm_mon+1, gmt->tm_year+1900);
 					}
 				}
+
 			}
 			else if ((strcmp(argv[i], "-gs") == 0) || (strcmp(argv[i], "--getTimeAndSet") == 0))
 			{
 				time_t theGMTTime;
 
 				/* get the frontcontroller time */
-				if (((Model_t *)context->m)->GetTime)
+				if (((Model_t*)context->m)->GetTime)
 				{
-					if (((Model_t *)context->m)->GetTime(context, &theGMTTime) == 0)
+					if (((Model_t*)context->m)->GetTime(context, &theGMTTime) == 0)
 					{
-						/* FIXME/CAUTION: assumes frontprocessor time is local and not UTC */
 						struct tm *gmt = gmtime(&theGMTTime);
 
-						printf("Setting system time to current frontpanel time: %02d:%02d:%02d %02d-%02d-%04d\n",
-								gmt->tm_hour, gmt->tm_min, gmt->tm_sec, gmt->tm_mday, gmt->tm_mon + 1, gmt->tm_year + 1900);
-						char cmd[50];
-						sprintf(cmd, "date -s %04d.%02d.%02d-%02d:%02d:%02d\n", gmt->tm_year + 1900, gmt->tm_mon + 1, gmt->tm_mday, gmt->tm_hour, gmt->tm_min, gmt->tm_sec);
-						system(cmd);
-					}
-				}
-			}
-			else if ((strcmp(argv[i], "-gt") == 0) || (strcmp(argv[i], "--getWakeTime") == 0))
-			{
-				time_t theGMTTime;
+						struct timeval tv;
+						time_t allsec;
 
-				/* get the current wake up time from frontcontroller */
-				if (((Model_t *)context->m)->GetWTime)
-				{
-					if (((Model_t *)context->m)->GetWTime(context, &theGMTTime) == 0)
-					{
-						struct tm *gmt = gmtime(&theGMTTime);
-						fprintf(stderr, "Current wake up time: %02d:%02d:%02d %02d-%02d-%04d\n",
-								gmt->tm_hour, gmt->tm_min, gmt->tm_sec, gmt->tm_mday, gmt->tm_mon + 1, gmt->tm_year + 1900);
-					}
-				}
-			}
-			else if ((strcmp(argv[i], "-gw") == 0) || (strcmp(argv[i], "--getWakeupTime") == 0))
-			{
-				time_t theGMTTime;
+						allsec=mktime(gmt);
+						tv.tv_sec=allsec;
 
-				/* get the frontcontroller wakeup time */
-				if (((Model_t*)context->m)->GetWakeupTime)
-				{
-					if (((Model_t*)context->m)->GetWakeupTime(context, &theGMTTime) == 0)
-					{
-						struct tm *gmt = gmtime(&theGMTTime);
+//						settimeofday(&tv, 0);   // only works on spark, so we make a system-call later
 
-						fprintf(stderr, "Wakeup Time: %02d:%02d:%02d %02d-%02d-%04d\n",
+						fprintf(stderr, "Setting RTC to current frontpanel-time: %02d:%02d:%02d %02d-%02d-%04d\n",
 							gmt->tm_hour, gmt->tm_min, gmt->tm_sec, gmt->tm_mday, gmt->tm_mon+1, gmt->tm_year+1900);
+						char cmd[50];
+						sprintf(cmd, "date -s %04d.%02d.%02d-%02d:%02d:%02d\n", gmt->tm_year+1900, gmt->tm_mon+1, gmt->tm_mday, gmt->tm_hour, gmt->tm_min, gmt->tm_sec);
+						system(cmd);
 					}
 				}
 			}
@@ -267,73 +233,53 @@
 				if (argc == 4)
 				{
 					getTimeFromArg(argv[i + 1], argv[i + 2], &theGMTTime);
+
 					/* set the frontcontroller time */
-					if (((Model_t *)context->m)->SetTime)
-					{
-						((Model_t *)context->m)->SetTime(context, &theGMTTime);
-					}
-					else
-					{
-						usage(context, argv[0], argv[i]);
-					}
-				}
+					if (((Model_t*)context->m)->SetTime)
+						((Model_t*)context->m)->SetTime(context, &theGMTTime);
+				} else
+					usage(context, argv[0], argv[1]);
+
 				i += 2;
 			}
-			else if ((strcmp(argv[i], "-sst") == 0) || (strcmp(argv[i], "--setSystemTime") == 0))
+			else if ((strcmp(argv[i], "-gt") == 0) || (strcmp(argv[i], "--getTimer") == 0))
 			{
 				time_t theGMTTime;
 
-				/* set the frontcontroller time to system time */
-				if (((Model_t *)context->m)->SetSTime)
-				{
-					((Model_t *)context->m)->SetSTime(context, &theGMTTime);
-				}
-			}
-			else if ((strcmp(argv[i], "-st") == 0) || (strcmp(argv[i], "--setWakeTime") == 0))
-			{
-				time_t theLocalTime;
-
-				if (argc == 4)
+				/* get the current timer value from frontcontroller */
+				if (((Model_t*)context->m)->GetTimer)
 				{
-					getTimeFromArg(argv[i + 1], argv[i + 2], &theLocalTime);
-					/* set the frontcontroller wake up time */
-					if (((Model_t *)context->m)->SetWTime)
+					if (((Model_t*)context->m)->GetTimer(context, &theGMTTime) == 0)
 					{
-						((Model_t *)context->m)->SetWTime(context, &theLocalTime);
-					}
-					else
-					{
-						usage(context, argv[0], argv[i]);
+						struct tm *gmt = gmtime(&theGMTTime);
+
+						fprintf(stderr, "Current Timer: %02d:%02d:%02d %02d-%02d-%04d\n",
+							gmt->tm_hour, gmt->tm_min, gmt->tm_sec, gmt->tm_mday, gmt->tm_mon+1, gmt->tm_year+1900);
 					}
 				}
-				i += 2;
 			}
-			else if ((strcmp(argv[i], "-d") == 0) || (strcmp(argv[i], "--shutDown") == 0))
+			else if ((strcmp(argv[i], "-d") == 0) || (strcmp(argv[i], "--shutdown") == 0))
 			{
 				time_t theGMTTime;
 
 				if (argc == 4)
 				{
 					getTimeFromArg(argv[i + 1], argv[i + 2], &theGMTTime);
-					/* shutdown at the given time */
-					if (((Model_t *)context->m)->Shutdown)
-					{
-						((Model_t *)context->m)->Shutdown(context, &theGMTTime);
-					}
+
+					/* shutdown immediately or at a given time */
+					if (((Model_t*)context->m)->Shutdown)
+					      ((Model_t*)context->m)->Shutdown(context, &theGMTTime);
 				}
 				else if (argc == 2)
 				{
 					theGMTTime = -1;
-					/* shutdown immediately */
-					if (((Model_t *)context->m)->Shutdown)
-					{
-						((Model_t *)context->m)->Shutdown(context, &theGMTTime);
-					}
+					/* shutdown immediately or at a given time */
+					if (((Model_t*)context->m)->Shutdown)
+						((Model_t*)context->m)->Shutdown(context, &theGMTTime);
 				}
 				else
-				{
-					usage(context, argv[0], argv[i]);
-				}
+					usage(context, argv[0], argv[1]);
+
 				i += 2;
 			}
 			else if ((strcmp(argv[i], "-r") == 0) || (strcmp(argv[i], "--reboot") == 0))
@@ -343,27 +289,15 @@
 				if (argc == 4)
 				{
 					getTimeFromArg(argv[i + 1], argv[i + 2], &theGMTTime);
-					/* reboot at the given time */
-					if (((Model_t *)context->m)->Reboot)
-					{
-						((Model_t *)context->m)->Reboot(context, &theGMTTime);
-					}
-					i += 2;
-				}
-				else if (argc == 2)
-				{
-					theGMTTime = -1;
-					/* reboot immediately */
-					printf("Receiver: %s\n", vName);
-					if (((Model_t *)context->m)->Reboot)
-					{
-						((Model_t *)context->m)->Reboot(context, &theGMTTime);
-					}
+
+					/* reboot immediately or at a given time */
+					if (((Model_t*)context->m)->Reboot)
+						((Model_t*)context->m)->Reboot(context, &theGMTTime);
 				}
 				else
-				{
-					usage(context, argv[0], argv[i]);
-				}
+					usage(context, argv[0], argv[1]);
+
+				i += 2;
 			}
 			else if ((strcmp(argv[i], "-p") == 0) || (strcmp(argv[i], "--sleep") == 0))
 			{
@@ -372,334 +306,146 @@
 				if (argc == 4)
 				{
 					getTimeFromArg(argv[i + 1], argv[i + 2], &theGMTTime);
+
 					/* sleep for a while, or wake-up on another reason (rc ...) */
-					if (((Model_t *)context->m)->Sleep)
-						((Model_t *)context->m)->Sleep(context, &theGMTTime);
-				}
+					if (((Model_t*)context->m)->Sleep)
+						((Model_t*)context->m)->Sleep(context, &theGMTTime);
+		 		}
 				else
-				{
-					usage(context, argv[0], argv[i]);
-				}
+		 			usage(context, argv[0], argv[1]);
+
 				i += 2;
 			}
 			else if ((strcmp(argv[i], "-t") == 0) || (strcmp(argv[i], "--settext") == 0))
 			{
-				if (argc >= i + 1)
-				{
-					if ((argc - i) == 1)
-					{
-						usage(context, argv[0], argv[i]);
-					}
+				if (i + 1 <= argc)
 					/* set display text */
-					if (((Model_t *)context->m)->SetText)
-					{
-						((Model_t *)context->m)->SetText(context, argv[i + 1]);
-					}
-				}
+					if (((Model_t*)context->m)->SetText)
+						((Model_t*)context->m)->SetText(context, argv[i+1]);
 				i += 1;
+
 			}
 			else if ((strcmp(argv[i], "-l") == 0) || (strcmp(argv[i], "--setLed") == 0))
 			{
-				if (argc >= i + 2)
+				if (i + 2 <= argc)
 				{
 					int which, on;
 
 					which = atoi(argv[i + 1]);
-					if ((argc - i) == 2)
-					{
-						usage(context, argv[0], argv[i]);
-					}
 					on = atoi(argv[i + 2]);
+					i+=2;
+
 					/* set display led */
-					if (((Model_t *)context->m)->SetLed)
-					{
-						((Model_t *)context->m)->SetLed(context, which, on);
-					}
-				}
-				else
-				{
-					usage(context, argv[0], argv[i]);
+					if (((Model_t*)context->m)->SetLed)
+					   ((Model_t*)context->m)->SetLed(context, which, on);
 				}
 				i += 2;
 			}
 			else if ((strcmp(argv[i], "-i") == 0) || (strcmp(argv[i], "--setIcon") == 0))
 			{
-				if (argc >= i + 2)
+				if (i + 2 <= argc)
 				{
 					int which, on;
 
 					which = atoi(argv[i + 1]);
-					if ((argc - i) == 2)
-					{
-						usage(context, argv[0], argv[i]);
-					}
 					on = atoi(argv[i + 2]);
+
 					/* set display icon */
-					if (((Model_t *)context->m)->SetIcon)
-					{
-						((Model_t *)context->m)->SetIcon(context, which, on);
-					}
-				}
-				else
-				{
-					usage(context, argv[0], argv[i]);
+					if (((Model_t*)context->m)->SetIcon)
+						((Model_t*)context->m)->SetIcon(context, which, on);
 				}
 				i += 2;
 			}
 			else if ((strcmp(argv[i], "-b") == 0) || (strcmp(argv[i], "--setBrightness") == 0))
 			{
-				if (argc >= i + 1)
+				if (i + 1 <= argc)
 				{
 					int brightness;
 
-					if ((argc - i) == 1)
-					{
-						usage(context, argv[0], argv[i]);
-					}
 					brightness = atoi(argv[i + 1]);
-					/* set display brightness */
-					if (((Model_t *)context->m)->SetBrightness)
-					{
-						((Model_t *)context->m)->SetBrightness(context, brightness);
-					}
-				}
-				i += 1;
-			}
-			else if ((strcmp(argv[i], "-w") == 0) || (strcmp(argv[i], "--getWakeupReason") == 0))
-			{
-				int ret = -1;
 
-				if (((Model_t *)context->m)->GetWakeupReason)
-				{
-					ret = ((Model_t *)context->m)->GetWakeupReason(context, &reason);
-				}
-				else
-				{
-					ret = getWakeupReasonPseudo(&reason);
-				}
-				if (ret == 0)
-				{
-					printf("Wakeup reason = %d (%s)\n\n", reason & 0x07, wakeupreason[reason & 0x07]);
-					syncWasTimerWakeup((eWakeupReason)reason);
-				}
-			}
-			else if ((strcmp(argv[i], "-L") == 0) || (strcmp(argv[i], "--setLight") == 0))
-			{
-				if (argc >= i + 1)
-				{
-					int on;
 
-					if ((argc - i) == 1)
-					{
-						usage(context, argv[0], argv[i]);
-					}
-					on = atoi(argv[i + 1]);
-					if (((Model_t *)context->m)->SetLight)
-					{
-						((Model_t *)context->m)->SetLight(context, on);
-					}
+					/* set display brightness */
+					if (((Model_t*)context->m)->SetBrightness)
+						((Model_t*)context->m)->SetBrightness(context, brightness);
 				}
 				i += 1;
 			}
-			else if ((strcmp(argv[i], "-c") == 0) || (strcmp(argv[i], "--clear") == 0))
-			{
-				/* clear the display */
-				if (((Model_t *)context->m)->Clear)
-				{
-					((Model_t *)context->m)->Clear(context);
-				}
-			}
-			else if ((strcmp(argv[i], "-led") == 0) || (strcmp(argv[i], "--setLedBrightness") == 0))
+			/* added by zeroone; set PowerLed Brightness on HDBOX*/
+			// BEGIN SetPwrLed
+			else if((strcmp(argv[i], "-P") == 0) || (strcmp(argv[i], "--setPwrLed") == 0))
 			{
-				if (argc >= i + 1)
+				if (i + 1 <= argc)
 				{
-					/* set LED brightness */
 					int brightness;
 
-					if ((argc - i) == 1)
-					{
-						usage(context, argv[0], argv[i]);
-					}
 					brightness = atoi(argv[i + 1]);
-					if (((Model_t *)context->m)->SetLedBrightness)
-					{
-						((Model_t *)context->m)->SetLedBrightness(context, brightness);
-					}
+
+					/* set PwrLed Brightness icon */
+					if (((Model_t*)context->m)->SetPwrLed)
+						((Model_t*)context->m)->SetPwrLed(context, brightness);
+
 				}
 				i += 1;
 			}
-			else if ((strcmp(argv[i], "-v") == 0) || (strcmp(argv[i], "--version") == 0))
+			// END SetPwrLed
+			else if ((strcmp(argv[i], "-w") == 0) || (strcmp(argv[i], "--getWakeupReason") == 0))
 			{
-				int version = -1;
+				int ret = -1;
+				eWakeupReason reason;
 
-				if (!disp)
-				{
-					printf("\nProgram version info:\n");
-					printf("fp_control version %s\n", sw_version);
-					printf("\nConfiguration of receiver:\n");
-					printf("Display      : %d  Time format: %s", Vdisplay, VtimeFormat);
-					printf("Displaycustom: %d  Wakeupdecrement: %d minute(s)", Vdisplay_custom, Vwakeup / 60);
-					if (Vwakeup % 60 != 0)
-					{
-						printf(" %d second(s)\n\n", Vwakeup % 60);
-					}
-					else
-					{
-						printf("\n\n");
-					}
-				}
-				/* get FP version info */
-				if (((Model_t *)context->m)->GetVersion)
-				{
-					((Model_t *)context->m)->GetVersion(context, &version);
-				}
-				if (version == -1)
-				{
-					printf("Remark: FP version is unknown\n");
-				}
+				if (((Model_t*)context->m)->GetWakeupReason)
+					ret = ((Model_t*)context->m)->GetWakeupReason(context, &reason);
 				else
+					ret = getWakeupReasonPseudo(&reason);
+				
+				if (ret == 0)
 				{
-					printf("FP version is %d.%02d\n", (version / 100) & 0xff, (version % 100) & 0xff);
+					printf("wakeup reason = %d\n", reason);
+					printf("(%s)\n", wakeupreason[reason & 0x03]);
+					syncWasTimerWakeup(reason);
 				}
 			}
-			else if ((strcmp(argv[i], "-sf") == 0) || (strcmp(argv[i], "--setFan") == 0))
+			else if ((strcmp(argv[i], "-L") == 0) || (strcmp(argv[i], "--setLight") == 0))
 			{
-				if (argc >= i + 1)
+				if (i + 1 < argc)
 				{
 					int on;
 
-					if ((argc - i) == 1)
-					{
-						usage(context, argv[0], argv[i]);
-					}
 					on = atoi(argv[i + 1]);
-					/* set fan on/off */
-					if (((Model_t *)context->m)->SetFan)
-					{
-						((Model_t *)context->m)->SetFan(context, on);
-					}
-				}
+
+					/* set brightness on/off */
+					if (((Model_t*)context->m)->SetLight)
+					((Model_t*)context->m)->SetLight(context, on);
+
+			 	}
 				i += 1;
 			}
-			else if ((strcmp(argv[i], "-sr") == 0) || (strcmp(argv[i], "--setRF") == 0))
+			else if ((strcmp(argv[i], "-c") == 0) || (strcmp(argv[i], "--clear") == 0))
 			{
-				if (argc >= i + 1)
-				{
-					int on;
-
-					if ((argc - i) == 1)
-					{
-						usage(context, argv[0], argv[i]);
-					}
-					on = atoi(argv[i + 1]);
-					/* set rf on/off */
-					if (((Model_t *)context->m)->SetRF)
-					{
-						((Model_t *)context->m)->SetRF(context, on);
-					}
-				}
-				i += 1;
+				/* clear the display */
+				if (((Model_t*)context->m)->Clear)
+					((Model_t*)context->m)->Clear(context);
 			}
 			else if ((strcmp(argv[i], "-dt") == 0) || (strcmp(argv[i], "--display_time") == 0))
 			{
-				if (argc >= i + 1)
+				if (i + 1 <= argc)
 				{
 					int on;
 
-					if ((argc - i) == 1)
-					{
-						usage(context, argv[0], argv[i]);
-					}
 					on = atoi(argv[i + 1]);
-					/* set time display */
-					if (((Model_t *)context->m)->SetDisplayTime)
-					{
-						((Model_t *)context->m)->SetDisplayTime(context, on);
-					}
-				}
-				i += 1;
-			}
-			else if ((strcmp(argv[i], "-tm") == 0) || (strcmp(argv[i], "--time_mode") == 0))
-			{
-				if (argc >= i + 1)
-				{
-					int twentyFour;
-
-					if ((argc - i) == 1)
-					{
-						usage(context, argv[0], argv[i]);
-					}
-					twentyFour = atoi(argv[i + 1]);
-					/* set 12/24 hour mode */
-					if (((Model_t *)context->m)->SetTimeMode)
-					{
-						((Model_t *)context->m)->SetTimeMode(context, twentyFour);
-					}
-				}
-				i += 1;
-			}
-#if defined MODEL_SPECIFIC
-			else if ((strcmp(argv[i], "-ms") == 0) || (strcmp(argv[i], "--model_specific") == 0))
-			{
-				int j;
-				char len;
-				unsigned char testdata[16];
-
-				len = argc - 2;
-
-				if ((len > 0) && (len <= 16))
-				{
-					if (i + len <= argc)
-					{
-						memset(testdata, 0, sizeof(testdata));						
 
-						for (j = 1; j <= len; j++)
-						{
-							sscanf(argv[j + 1], "%x", (unsigned int *)&testdata[j - 1]); 
-						}
-
-
-						/* do model specific function */
-						if (((Model_t *)context->m)->ModelSpecific)
-						{
-							j = ((Model_t *)context->m)->ModelSpecific(context, len, testdata);
-						}
-						if (j != 0)
-						{
-							printf("Error occurred.\n");
-						}
-						else
-						{
-							printf("Command executed OK, ");
-							if (testdata[1] == 1)
-							{
-								printf("data returned:\n");
-								for (j = 0; j <= 8; j++)
-								{
-									printf("Byte #%1d = 0x%02x\n", j, testdata[j + 2] & 0xff);
-								}
-//								printf("\n");
-							}
-							else
-							{
-								printf("no return data.\n");
-							}
-						}
-					}
-				}
-				else
-				{
-					printf("Wrong number of arguments, minimum is 1, maximum is 16.\n");
-					usage(context, argv[0], argv[1]);
+					/* set display icon */
+					if (((Model_t*)context->m)->SetDisplayTime)
+						((Model_t*)context->m)->SetDisplayTime(context, on);
 				}
-				i += len;
+				i += 2;
 			}
-#endif
 			else
 			{
-				printf("\nUnknown option [ %s ]\n", argv[i]);
 				usage(context, argv[0], NULL);
 			}
+
 			i++;
 		}
 	}
@@ -707,182 +453,62 @@
 	{
 		usage(context, argv[0], NULL);
 	}
-	if (((Model_t *)context->m)->Exit)
-	{
-		((Model_t *)context->m)->Exit(context);
-	}
+
+	if (((Model_t*)context->m)->Exit)
+		((Model_t*)context->m)->Exit(context);
+	exit(1);
 }
 
 ////////////////////////////////////////////////////////////////////////////////////////////////////
 ////////////////////////////////////////////////////////////////////////////////////////////////////
 
-int getKathreinUfs910BoxType()
-{
-	char vType;
-	int vFdBox = open("/proc/boxtype", O_RDONLY);
-	read(vFdBox, &vType, 1);
-	close(vFdBox);
-	return vType == '0' ? 0 : vType == '1' || vType == '3' ? 1 : -1;
-}
-
 int getModel()
 {
-	int vFd = -1;
-	const int cSize = 128;
-	char vName[129] = "Unknown";
-	int vLen = -1;
-	eBoxType vBoxType = Unknown;
+	int         vFd             = -1;
+	const int   cSize           = 128;
+	char        vName[129]      = "Unknown";
+	int         vLen            = -1;
+	eBoxType    vBoxType        = Unknown;
 
 	vFd = open("/proc/stb/info/model", O_RDONLY);
-	vLen = read(vFd, vName, cSize);
+	vLen = read (vFd, vName, cSize);
+
 	close(vFd);
 
-	if (vLen > 0)
-	{
-		vName[vLen - 1] = '\0';
-		if (!strncasecmp(vName, "ufs910", 6))
-		{
-			switch (getKathreinUfs910BoxType())
-			{
-				case 0:
-				{
-					vBoxType = Ufs910_1W;
-					break;
-				}
-				case 1:
-				{
-					vBoxType = Ufs910_14W;
-					break;
-				}
-				default:
-				{
-					vBoxType = Unknown;
-					break;
-				}
-			}
-		}
-		else if (!strncasecmp(vName, "ufs922", 6))
-		{
-			vBoxType = Ufs922;
-		}
-		else if (!strncasecmp(vName, "ufc960", 6))
-		{
-			vBoxType = Ufc960;
-		}
-		else if (!strncasecmp(vName, "ufs912", 6))
-		{
-			vBoxType = Ufs912;
-		}
-		else if (!strncasecmp(vName, "ufs913", 6))
-		{
-			vBoxType = Ufs912;
-		}
-		else if (!strncasecmp(vName, "tf7700hdpvr", 11))
-		{
-			vBoxType = Tf7700;
-		}
-		else if (!strncasecmp(vName, "hl101", 5))
-		{
-			vBoxType = Hl101;
-		}
-		else if (!strncasecmp(vName, "vip1-v2", 7))
-		{
-			vBoxType = Vip2;
-		}
-		else if (!strncasecmp(vName, "vip2-v1", 7))
-		{
-			vBoxType = Vip2;
-		}
-		else
-			if ((!strncasecmp(vName, "hdbox", 5))
-			|| (!strncasecmp(vName, "octagon1008", 11))
-			|| (!strncasecmp(vName, "atevio7500", 10))
-			|| (!strncasecmp(vName, "hs7110", 6))
-			|| (!strncasecmp(vName, "hs7420", 6))
-			|| (!strncasecmp(vName, "hs7810a", 7))
-			|| (!strncasecmp(vName, "hs7119", 6))
-			|| (!strncasecmp(vName, "hs7429", 6))
-			|| (!strncasecmp(vName, "hs7819", 6)))
-			{
-				vBoxType = Fortis;
-			}
-		else
-			if ((!strncasecmp(vName, "atemio520", 9))
-			|| (!strncasecmp(vName, "atemio530", 9)))
-			{
-				vBoxType = CNBox;
-			}
-		else if (!strncasecmp(vName, "hs5101", 6))
-		{
-			vBoxType = Hs5101;
-		}
-		else
-			if ((!strncasecmp(vName, "spark", 5))
-			|| (!strncasecmp(vName, "spark7162", 9)))
-			{
-				vBoxType = Spark;
-			}
-		else if (!strncasecmp(vName, "adb_box", 7))
-		{
-			vBoxType = Adb_Box;
-		}
-		else
-			if ((!strncasecmp(vName, "cuberevo", 8))
-		    || (!strncasecmp(vName, "cuberevo-mini", 13))
-		    || (!strncasecmp(vName, "cuberevo-mini2", 14))
-		    || (!strncasecmp(vName, "cuberevo-mini-fta", 17))
-		    || (!strncasecmp(vName, "cuberevo-250hd", 14))
-		    || (!strncasecmp(vName, "cuberevo-2000hd", 15))
-		    || (!strncasecmp(vName, "cuberevo-9500hd", 15))
-		    || (!strncasecmp(vName, "cuberevo-3000hd", 14)))
-			{
-				vBoxType = Cuberevo;
-			}
+	if (vLen > 0) {
+		vName[vLen-1] = '\0';
+
+		printf("Model: %s\n", vName);
+
+		if (!strncasecmp(vName,"spark", 6))
+			vBoxType = Spark;
+		else if (!strncasecmp(vName,"spark7162", 9))
+			vBoxType = Spark;
 		else
-		{
 			vBoxType = Unknown;
-		}
-		if (disp)
-		{
-			printf("Receiver: %s\n\n", vName);
-		}
 	}
+
+	printf("vBoxType: %d\n", vBoxType);
+
 	return vBoxType;
 }
 
-int main(int argc, char *argv[])
+int main (int argc, char* argv[])
 {
-	Context_t context;
-	int i;
 	eBoxType vBoxType = Unknown;
+	Context_t context;
+
+	printf("%s: SW Version %s\n", argv[0], sw_version);
 
-	if (argc > 1)
-	{
-		i = 1;
-		while (argc > i) //scan the command line for -V or --verbose
-		{
-			if ((strcmp(argv[i], "-V") == 0) || (strcmp(argv[i], "--verbose") == 0))
-			{
-				/* switch verbose on */
-				disp = 1;
-			}
-			i++;
-		}
-	}
-	
-	if (disp)
-	{
-		printf("%s Version %s\n", argv[0], sw_version);
-	}
 	vBoxType = getModel();
 
-	if (searchModel(&context, vBoxType) != 0)
-	{
-		printf("Model not found\n");
-		return -1;
+	if(!searchModel(&context, vBoxType)) {
+		printf("Selected Model: %s\n", ((Model_t*)context.m)->Name);
+
+		processCommand(&context, argc, argv);
 	}
-	processCommand(&context, argc, argv);
+	else
+		printf("Warning: Model not found in available models!\n");
 
-	exit(reason & 0x07);
+	return 0;
 }
-// vim:ts=4
diff -Naur sh4-apps/tools/fp_control/global.c taapat-apps/tools/fp_control/global.c
--- sh4-apps/tools/fp_control/global.c	2019-02-20 16:00:47.075955549 +0100
+++ taapat-apps/tools/fp_control/global.c	2019-02-20 15:59:37.638646134 +0100
@@ -1,18 +1,18 @@
 /*
  * global.c
- *
+ * 
  * (c) 2009 dagobert/donald@teamducktales
  *
  * This program is free software; you can redistribute it and/or modify
  * it under the terms of the GNU General Public License as published by
- * the Free Software Foundation; either version 2 of the License, or
+ * the Free Software Foundation; either version 2 of the License, or 
  * (at your option) any later version.
- *
+ * 
  * This program is distributed in the hope that it will be useful,
  * but WITHOUT ANY WARRANTY; without even the implied warranty of
- * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
  * GNU General Public License for more details.
- *
+ * 
  * You should have received a copy of the GNU General Public License
  * along with this program; if not, write to the Free Software
  * Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA 02111-1307 USA
@@ -29,45 +29,28 @@
 
 #include "global.h"
 
+/* #define E2TIMERSXML "/usr/local/share/enigma2/timers.xml" */
 #define E2TIMERSXML "/etc/enigma2/timers.xml"
 #define E2WAKEUPTIME "/proc/stb/fp/wakeup_time"
 
-#define NEUTRINO_TIMERS "/var/tuxbox/config/timerd.conf"
+#define NEUTRINO_TIMERS "/usr/local/share/config/timerd.conf"
 
 #define CONFIG "/etc/vdstandby.cfg"
-char *sDisplayStd = "%a %d %H:%M:%S";
+char * sDisplayStd = "%a %d %H:%M:%S";
 
 #define WAKEUPFILE "/var/wakeup"
 #define WAS_TIMER_WAKEUP "/proc/stb/fp/was_timer_wakeup"
 
 #define E2_WAKEUP_TIME_PROC
-int verbose = 0; //verbose is off by default
-
-static Model_t *AvailableModels[] =
-{
-	&Ufs910_1W_model,
-	&Ufs910_14W_model,
-	&UFS922_model,
-	&Fortis_model,
-	&HL101_model,
-	&VIP2_model,
-	&Hs5101_model,
-	&UFS912_model,
-	&UFC960_model,
-	&Spark_model,
-	&Adb_Box_model,
-	&Cuberevo_model,
-	&CNBOX_model,
-	NULL
-};
-
-#if 0
-static time_t read_e2_wakeup(time_t curTime)
+#ifdef E2_WAKEUP_TIME_PROC
+static time_t read_e2_timers(time_t curTime)
 {
-	char line[12];
+	char   line[12];
 	time_t recordTime = LONG_MAX;
-	FILE *fd = fopen(E2WAKEUPTIME, "r");
-	printf("Getting Enigma2 wakeup time");
+	FILE   *fd        = fopen (E2WAKEUPTIME, "r");
+
+	printf("Getting enigma2 wakeup time");
+
 	if (fd > 0)
 	{
 		fgets(line, 11, fd);
@@ -75,76 +58,74 @@
 		if (recordTime <= curTime)
 		{
 			recordTime = LONG_MAX;
-			printf(" - Got time, but in the past (ignoring)\n");
+			printf(" - Got timer but in the past (ignoring)\n");
 		}
 		else
 			printf(" - Done\n");
 		fclose(fd);
 	}
 	else
-	{
 		printf(" - Error reading %s\n", E2WAKEUPTIME);
-	}
+
 	return recordTime;
 }
 #else
 static time_t read_e2_timers(time_t curTime)
 {
-	char recordString[12];
-	char line[1000];
+	char   recordString[11];
+	char   line[1000];
 	time_t recordTime = LONG_MAX;
-	FILE *fd = fopen(E2TIMERSXML, "r");
-	printf("Getting 1st Enigma2 timer");
+	FILE   *fd        = fopen (E2TIMERSXML, "r");
+
+	printf("Getting enigma2 wakeup time");
+
 	if (fd > 0)
 	{
-		while (fgets(line, 999, fd) != NULL)
+		while(fgets(line, 999, fd) != NULL)
 		{
-			line[999] = '\0';
-			if (!strncmp("<timer begin=\"", line, 14))
+			line[999]='\0';
+			if (!strncmp("<timer begin=\"",line,14) )
 			{
 				unsigned long int tmp = 0;
-				strncpy(recordString, line + 14, 10);
+				strncpy(recordString, line+14, 10);
 				recordString[11] = '\0';
 				tmp = atol(recordString);
 				recordTime = (tmp < recordTime && tmp > curTime ? tmp : recordTime);
 			}
 		}
-		if (recordTime == LONG_MAX)
-		{
-			printf(" (none set)");
-			recordTime = -1;
-		}
-		else
-		{
-			recordTime -= Vwakeup;
-		}
 		printf(" - Done\n");
-		fclose(fd);
 	}
 	else
-	{
 		printf(" - Error reading %s\n", E2TIMERSXML);
-	}
+
+
 	return recordTime;
 }
 #endif
 
 static time_t read_neutrino_timers(time_t curTime)
 {
-	char line[1000];
+	char   line[1000];
 	time_t recordTime = LONG_MAX;
-	FILE *fd = fopen(NEUTRINO_TIMERS, "r");
-	printf("Getting 1st neutrino timer");
+	FILE   *fd        = fopen (NEUTRINO_TIMERS, "r");
+
+	printf("Getting neutrino wakeup time");
+
 	if (fd > 0)
 	{
-		while (fgets(line, 999, fd) != NULL)
+		printf("opening %s\n", NEUTRINO_TIMERS);
+		
+		while(fgets(line, 999, fd) != NULL)
 		{
-			line[999] = '\0';
-			if (strstr(line, "ALARM_TIME_") != NULL)
+			line[999]='\0';
+
+			if (strstr(line, "ALARM_TIME_") != NULL )
 			{
 				time_t tmp = 0;
-				char *str;
+				char* str;
+
 				str = strstr(line, "=");
+
 				if (str != NULL)
 				{
 					tmp = atol(str + 1);
@@ -157,26 +138,24 @@
 	}
 	else
 		printf(" - Error reading %s\n", NEUTRINO_TIMERS);
-	if (recordTime != LONG_MAX)
-	{
-		int wakeupDecrement = Vwakeup;
-		int platzhalter;
-		char *dummy;
 
-		checkConfig(&platzhalter, &platzhalter, &dummy, &wakeupDecrement);
+	if (recordTime != LONG_MAX) {
+		int wakeupDecrement = 5*60;
+		int platzhalter;
+		checkConfig(&platzhalter, &platzhalter, &platzhalter, &wakeupDecrement);
 		recordTime -= wakeupDecrement;
 	}
+
 	return recordTime;
 }
 
-// Write the wakeup time to a file to allow detection of wakeup cause
-// in case fp does not support wakeup cause
+// Write the wakeup time to a file to allow detection of wakeupcause if fp does not support
 static void write_wakeup_file(time_t wakeupTime)
 {
 	FILE *wakeupFile;
-	wakeupFile = fopen(WAKEUPFILE, "w");
-	if (wakeupFile)
-	{
+
+	wakeupFile = fopen(WAKEUPFILE,"w");
+	if (wakeupFile) {
 		fprintf(wakeupFile, "%ld", wakeupTime);
 		fclose(wakeupFile);
 		system("sync");
@@ -187,56 +166,49 @@
 {
 	time_t wakeupTime = LONG_MAX;
 	FILE  *wakeupFile;
-	wakeupFile = fopen(WAKEUPFILE, "r");
-	if (wakeupFile)
-	{
-		fscanf(wakeupFile, "%ld", &wakeupTime);
+
+	wakeupFile = fopen(WAKEUPFILE,"r");
+	if (wakeupFile) {
+		fscanf(wakeupFile,"%ld", &wakeupTime);
 		fclose(wakeupFile);
 	}
+
 	return wakeupTime;
 }
 
 #define FIVE_MIN 300
 
-// Important: system has to have a valid current time
-// This is a little bit tricky, we can only detect if the time is valid
+// Important: system has to have a vaild current time
+// This is a little bit triggy, we can only detect if the time is valid
 // and this check happens +-5min arround the timer
 int getWakeupReasonPseudo(eWakeupReason *reason)
 {
 	time_t curTime    = 0;
 	time_t wakeupTime = LONG_MAX;
 
-	printf("%s: IMPORTANT: Valid Linux System Time is mandatory\n", __func__);
+	printf("getWakeupReasonPseudo: IMPORTANT: Valid Linux System Time is mandetory\n");
 
 	time(&curTime);
 	wakeupTime = read_wakeup_file();
+
 	if ((curTime - FIVE_MIN) < wakeupTime && (curTime + FIVE_MIN) > wakeupTime)
-	{
 		*reason = TIMER;
-	}
 	else
-	{
 		*reason = NONE;
-	}
 	return 0;
 }
 
 int syncWasTimerWakeup(eWakeupReason reason)
 {
 	FILE *wasTimerWakeupProc = fopen(WAS_TIMER_WAKEUP, "w");
-	if (wasTimerWakeupProc == NULL)
-	{
+	if(wasTimerWakeupProc == NULL) {
 		fprintf(stderr, "setWakeupReason failed to open %s\n", WAS_TIMER_WAKEUP);
 		return -1;
 	}
 	if (reason == TIMER)
-	{
 		fwrite("1\n", 2, 1, wasTimerWakeupProc);
-	}
 	else
-	{
 		fwrite("0\n", 2, 1, wasTimerWakeupProc);
-	}
 	fclose(wasTimerWakeupProc);
 	return 0;
 }
@@ -246,198 +218,125 @@
 // If no wakeup time can be found LONG_MAX will be returned
 time_t read_timers_utc(time_t curTime)
 {
-	time_t wakeupTime = LONG_MAX;  // flag no timer read (yet)
-	wakeupTime = read_e2_timers(curTime);  // get next e2timer
-	if (wakeupTime == LONG_MAX) // if none
-	{
-		wakeupTime = read_neutrino_timers(curTime);  // try neutrino timer
-	}
+	time_t wakeupTime = LONG_MAX;
+
+	wakeupTime = read_e2_timers(curTime);
+
+	if (wakeupTime == LONG_MAX)
+		wakeupTime = read_neutrino_timers(curTime);
+
 	write_wakeup_file(wakeupTime);
+
 	return wakeupTime;
 }
 
-// This function returns a time in the future
+// This functio returns a time in the future
 time_t read_fake_timer_utc(time_t curTime)
 {
 	struct tm tsWake;
 	struct tm *ts;
 	time_t wakeupTime = LONG_MAX;
 
-	ts = gmtime(&curTime);
+	ts = gmtime (&curTime);
+
 	tsWake.tm_hour = ts->tm_hour;
 	tsWake.tm_min  = ts->tm_min;
 	tsWake.tm_sec  = ts->tm_sec;
 	tsWake.tm_mday = ts->tm_mday;
 	tsWake.tm_mon  = ts->tm_mon;
 	tsWake.tm_year = ts->tm_year + 1;
+
 	wakeupTime = mktime(&tsWake);
+
 	return wakeupTime;
 }
 /* ******************************************** */
 
 double modJulianDate(struct tm *theTime)
-{ // struct tm (date) -> MJD since epoch
+{
+
 	double date;
 	int month;
-	int day;
+	int day; 
 	int year;
 
 	year  = theTime->tm_year + 1900;
 	month = theTime->tm_mon + 1;
 	day   = theTime->tm_mday;
-	date = day - 32076 +
-		   1461 * (year + 4800 + (month - 14) / 12) / 4 +
-		   367 * (month - 2 - (month - 14) / 12 * 12) / 12 -
-		   3 * ((year + 4900 + (month - 14) / 12) / 100) / 4;
-	date += (theTime->tm_hour + 12.0) / 24.0;
-	date += (theTime->tm_min) / 1440.0;
-	date += (theTime->tm_sec) / 86400.0;
-	date -= 2400000.5;
-	return date;
-}
 
-int get_GMT_offset(struct tm theTime)
-{
-	time_t theoffsetTime;
-	time_t theinputTime;
-	int gmt_offset;
-
-	// Calculate time_t of input time theTime
-//	theinputTime = (((int)modJulianDate(&theTime) & 0xffff) - 40587) * 86400;  // mjd starts on midnight 17-11-1858 which is 40587 days before unix epoch
-	theinputTime = ((int)modJulianDate(&theTime) - 40587) * 86400;  // mjd starts on midnight 17-11-1858 which is 40587 days before unix epoch
-	theinputTime += theTime.tm_hour * 3600;
-	theinputTime += theTime.tm_min * 60;
-	theinputTime += theTime.tm_sec;
-
-	// Get time_t of input time theTime minus GMT offset
-	theTime.tm_isdst = -1; /* say mktime that we do not know */
-	theoffsetTime = mktime(&theTime);
-
-	gmt_offset = theinputTime - theoffsetTime;
-	return gmt_offset;
-}
-
-#if 0
-#define LEAPYEAR(year) (!((year) % 4) && (((year) % 100) || !((year) % 400)))
-#define YEARSIZE(year) (LEAPYEAR(year) ? 366 : 365)
-static const int _ytab[2][12] =
-{
-	{ 31, 28, 31, 30, 31, 30, 31, 31, 30, 31, 30, 31 },
-	{ 31, 29, 31, 30, 31, 30, 31, 31, 30, 31, 30, 31 }
-};
-
-int get_ndays(struct tm *theTime)
-{ // struct tm (date) -> number of days since linux epoch
-	int ndays = 0;
-	int year;
-	int i;
+	date = day - 32076 + 
+		1461 * (year + 4800 + (month - 14)/12)/4 +
+		367 * (month - 2 - (month - 14)/12*12)/12 - 
+		3 * ((year + 4900 + (month - 14)/12)/100)/4;
+
+	date += (theTime->tm_hour + 12.0)/24.0;
+	date += (theTime->tm_min)/1440.0;
+	date += (theTime->tm_sec)/86400.0;
 
-	year  = theTime->tm_year - 1; // do not count current year
-	while (year >= 70)
-	{
-		ndays += 365;
-		if (LEAPYEAR(year))
-		{
-			ndays++;
-		}
-		year--;
-	}
-	for (i = 0; i < theTime->tm_mon; i++)
-	{
-		ndays += _ytab[0][i];
-	}
-	if ((LEAPYEAR(theTime->tm_year)) && (theTime->tm_mon > 2))
-	{
-		ndays++;
-	}
-	ndays += theTime->tm_mday;
-	printf("%s ndays: %d\n", __func__, ndays);
-	printf("%s MJD: %d\n", __func__, ndays + 40587);
-	return ndays;
+	date -= 2400000.5;
+
+	return date;
 }
-#endif
 
 /* ********************************************** */
 
-int searchModel(Context_t *context, eBoxType type)
-{
+int searchModel(Context_t  *context, eBoxType type) {
 	int i;
 	for (i = 0; AvailableModels[i] != NULL; i++)
-		if (AvailableModels[i]->Type == type)
-		{
+
+		if (AvailableModels[i]->Type == type) {
 			context->m = AvailableModels[i];
 			return 0;
 		}
+
 	return -1;
 }
 
-int checkConfig(int *display, int *display_custom, char **timeFormat, int *wakeup)
-{
+int checkConfig(int* display, int* display_custom, char** timeFormat, int* wakeup) {
 	const int MAX = 100;
-	char buffer[MAX];
+	char puffer[MAX];
+	
 	*display = 0;
 	*display_custom = 0;
-	*timeFormat = "Unknown";
-	*wakeup = 5 * 60;
-	FILE *fd_config = fopen(CONFIG, "r");  //read box /etc/vdstandby.cfg
+	*timeFormat = NULL;
+	*wakeup = 5*60;
+	
+	FILE *fd_config = fopen(CONFIG, "r");
+
+	printf("%s\n", __func__);
 
 	if (fd_config == NULL)
 	{
-		Vwakeup = 5 * 60; //default wakeupdecrement is 5 minutes
-
-		printf("Config file (%s) not found,\nusing standard config:", CONFIG);
-		printf("Config:\nDisplay: %d              Time format: %d\n", *display, *display_custom);
-		printf("Displaycustom: %s  Wakeupdecrement: %d minutes %d seconds\n", *timeFormat, *wakeup/60, *wakeup%60);
+		printf("config file (%s) not found, use standard config", CONFIG);
+		printf("configs: DISPLAY = %d, DISPLAYCUSTOM = %d, CUSTOM = %s, WAKEUPDECREMENT  %d\n", 
+			*display, *display_custom, *timeFormat, *wakeup);
 		return -1;
 	}
-	while (fgets(buffer, MAX, fd_config))
-	{
-		if (!strncmp("DISPLAY=", buffer, 8))
-		{
-			char *option = &buffer[8];
-			if (!strncmp("TRUE", option, 4))
-			{
+	
+	while (fgets(puffer, MAX, fd_config)) {
+		if (!strncmp("DISPLAY=", puffer, 8)) {
+			char * option = &puffer[8];
+			if (!strncmp("TRUE", option, 2))
 				*display = 1;
-			}
-			else
-			{
-				*display = 0;
-			}
-		}
-		else if (!strncmp("DISPLAYCUSTOM=", buffer, 14))
-		{
-			char *option = &buffer[14];  //get buffer from character 14 on
+
+		} else if (!strncmp("DISPLAYCUSTOM=", puffer, 14)) {
+			char * option = &puffer[14];
 			*display_custom = 1;
 			*timeFormat = strdup(option);
 		}
-		else if (!strncmp("WAKEUPDECREMENT=", buffer, 16))
-		{
-			char *option = &buffer[16];
+		else if (!strncmp("WAKEUPDECREMENT=", puffer, 16)) {
+			char * option = &puffer[16];
 			*wakeup = atoi(option);
 		}
 	}
+	
 	if (*timeFormat == NULL)
-	{
-		*timeFormat = "?";
-	}
-	if (disp)
-	{
-		printf("Configuration of receiver:\n");
-		printf("Display      : %d  Time format: %s", *display, *timeFormat);
-		printf("Displaycustom: %d  Wakeupdecrement: %d minute(s)", *display_custom, *wakeup / 60);
-		if (*wakeup % 60 != 0)
-		{
-			printf(" %d second(s)\n", *wakeup % 60);
-		}
-		else
-		{
-			printf("\n");
-		}
-	}
-	Vdisplay = *display;
-	VtimeFormat = *timeFormat;
-	Vdisplay_custom = *display_custom;
-	Vwakeup = *wakeup;
+		*timeFormat = sDisplayStd;
+	
+	printf("configs: DISPLAY = %d, DISPLAYCUSTOM = %d, CUSTOM = %s, WAKEUPDECREMENT  %d\n", 
+		*display, *display_custom, *timeFormat, *wakeup);
+	
 	fclose(fd_config);
+	
 	return 0;
 }
diff -Naur sh4-apps/tools/fp_control/global.h taapat-apps/tools/fp_control/global.h
--- sh4-apps/tools/fp_control/global.h	2019-03-16 15:46:28.000000000 +0200
+++ taapat-apps/tools/fp_control/global.h	2019-03-16 15:57:12.000000000 +0200
@@ -7,123 +7,71 @@
 #define false 0
 #endif
 
-#define VFDDISPLAYCHARS         0xc0425a00
-#define VFDBRIGHTNESS           0xc0425a03
-#define VFDPWRLED               0xc0425a04 /* added by zeroone, also used in nuvoton.h; set PowerLed Brightness on Fortis*/
-#define VFDDISPLAYWRITEONOFF    0xc0425a05
-#define VFDICONDISPLAYONOFF     0xc0425a0a
-
-#define VFDTEST                 0xc0425af0
-#define VFDGETBLUEKEY           0xc0425af1 /* Spark specific */
-#define VFDSETBLUEKEY           0xc0425af2 /* Spark specific */
-#define VFDGETSTBYKEY           0xc0425af3 /* Spark specific */
-#define VFDSETSTBYKEY           0xc0425af4 /* Spark specific */
-#define VFDPOWEROFF             0xc0425af5 /* Spark specific */
-#define VFDSETPOWERONTIME       0xc0425af6 /* Spark specific */
-#define VFDGETVERSION           0xc0425af7
-#define VFDGETSTARTUPSTATE      0xc0425af8 /* Spark specific */
-#define VFDLEDBRIGHTNESS        0xc0425af8 /* ufs912 */
-#define VFDGETWAKEUPMODE        0xc0425af9 /* Fortis, does the same as spark VFDGETSTARTUPSTATE */
-#define VFDGETTIME              0xc0425afa
-#define VFDSETTIME              0xc0425afb
-#define VFDSTANDBY              0xc0425afc
-#define VFDREBOOT               0xc0425afd /* ufs912, fortis */
-#define VFDSETTIME2             0xc0425afd /* Spark specific */
-#define VFDSETLED               0xc0425afe
-#define VFDSETMODE              0xc0425aff /* ufs912, 922, Fortis ->unset compat mode */
-#define VFDDISPLAYCLR           0xc0425b00
-#define VFDGETLOOPSTATE         0xc0425b01 /* Spark specific */
-#define VFDSETLOOPSTATE         0xc0425b02 /* Spark specific */
-#define VFDGETWAKEUPTIME        0xc0425b03 /* Fortis/nuvoton, Cuberevo/micom specific */
-#define VFDSETTIMEFORMAT        0xc0425b04 /* Fortis specific */
-#define VFDGETTIMEFORMAT        0xc0425b05 /* Fortis specific */
+#define VFDGETTIME		0xc0425afa
+#define VFDSETTIME		0xc0425afb
+#define VFDSTANDBY		0xc0425afc
+#define VFDREBOOT		0xc0425afd
+#define VFDSETLED		0xc0425afe
+#define VFDICONDISPLAYONOFF	0xc0425a0a
+#define VFDBRIGHTNESS		0xc0425a03
+#define VFDDISPLAYCLR		0xc0425b00
+/*spark*/
+#define VFDGETSTARTUPSTATE	0xc0425af8
 
-//Comment next line if you do not want the -ms option
-#define MODEL_SPECIFIC 1
-
-struct vfd_ioctl_data
-{
+struct vfd_ioctl_data {
 	unsigned char start;
 	unsigned char data[64];
 	unsigned char length;
 };
 
-typedef enum {NONE, POWERON, STANDBY, TIMER, POWER_SWITCH, UNK1, UNK2, UNK3} eWakeupReason;
+typedef enum {NONE, TIMER} eWakeupReason;
 
-typedef enum {Unknown, Ufs910_1W, Ufs910_14W, Ufs922, Ufc960, Tf7700, Hl101, Vip2, Fortis, Hs5101, Ufs912, Spark, Cuberevo, Adb_Box, CNBox} eBoxType;
+typedef enum {Unknown, Spark} eBoxType;
 
-typedef struct Context_s
-{
-	/* Model_t */
-	void *m; /* instance data */
-	int fd; /* filedescriptor of fd */
+typedef struct Context_s {
+	void* /* Model_t */  *m; /* instance data */
+	int                  fd; /* filedescriptor of fd */
 } Context_t;
 
-typedef struct Model_s
-{
-	char *Name;
+typedef struct Model_s {
+	char *   Name;
 	eBoxType Type;
-	int	(*Init)             (Context_t *context);
-	int	(*Clear)            (Context_t *context);
-	int	(*Usage)            (Context_t *context, char *prg_name, char *cmd_name);
-	int	(*SetTime)          (Context_t *context, time_t *theGMTTime);
-	int	(*SetSTime)         (Context_t *context, time_t *theGMTTime);
-	int	(*GetTime)          (Context_t *context, time_t *theGMTTime);
-	int	(*SetWTime)         (Context_t *context, time_t *theGMTTime);
-	int	(*GetWTime)         (Context_t *context, time_t *theGMTTime);
-	int	(*SetTimer)         (Context_t *context, time_t *theGMTTime);
-	int	(*GetTimer)         (Context_t *context, time_t *theGMTTime);
-	int	(*Shutdown)         (Context_t *context, time_t *shutdownTimeGMT);
-	int	(*Reboot)           (Context_t *context, time_t *rebootTimeGMT);
-	int	(*Sleep)            (Context_t *context, time_t *wakeUpGMT);
-	int	(*SetText)          (Context_t *context, char *theText);
-	int	(*SetLed)           (Context_t *context, int which, int on);
-	int	(*SetIcon)          (Context_t *context, int which, int on);
-	int	(*SetBrightness)    (Context_t *context, int brightness);
-	int	(*GetWakeupReason)  (Context_t *context, eWakeupReason *reason);
-	int	(*SetLight)         (Context_t *context, int on);
-	int	(*Exit)             (Context_t *context);
-	int	(*SetLedBrightness) (Context_t *context, int brightness);
-	int	(*GetVersion)       (Context_t *context, int *version);
-	int	(*SetRF)            (Context_t *context, int on);
-	int	(*SetFan)           (Context_t *context, int on);
-	int	(*GetWakeupTime)    (Context_t *context, time_t *theGMTTime);
-	int	(*SetDisplayTime)   (Context_t *context, int on);
-	int	(*SetTimeMode)      (Context_t *context, int twentyFour);
-#if defined MODEL_SPECIFIC
-	int	(*ModelSpecific)    (Context_t *context, char len, unsigned char *testdata); /* added by audioniek */
-#endif
-	void	*private;
+	int     (* Init)           (Context_t* context);
+	int     (* Clear)          (Context_t* context);
+	int     (* Usage)          (Context_t* context, char* prg_name);
+	int     (* SetTime)        (Context_t* context, time_t* theGMTTime);
+	int     (* GetTime)        (Context_t* context, time_t* theGMTTime);
+	int     (* SetTimer)       (Context_t* context, time_t* theGMTTime);
+	int     (* GetTimer)       (Context_t* context, time_t* theGMTTime);
+	int     (* SetDisplayTime) (Context_t* context, int on);
+	int     (* Shutdown)       (Context_t* context, time_t* shutdownTimeGMT);
+	int     (* Reboot)         (Context_t* context, time_t* rebootTimeGMT);
+	int     (* Sleep)          (Context_t* context, time_t* wakeUpGMT);
+	int     (* SetText)        (Context_t* context, char* theText);
+	int     (* SetLed)         (Context_t* context, int which, int on);
+	int     (* SetIcon)        (Context_t* context, int which, int on);
+	int     (* SetBrightness)  (Context_t* context, int brightness);
+	int     (* SetPwrLed)  	   (Context_t* context, int pwrled); /* added by zeroone; set PowerLed Brightness on HDBOX*/
+	int     (* SetLight)       (Context_t* context, int on);
+	int     (* Exit)           (Context_t* context);
+	int     (* GetWakeupReason)(Context_t* context, eWakeupReason* reason);
+    void* private;
 } Model_t;
 
-extern	Model_t Ufs910_1W_model;
-extern	Model_t Ufs910_14W_model;
-extern	Model_t UFS912_model;
-extern	Model_t UFS922_model;
-extern	Model_t UFC960_model;
-extern	Model_t Fortis_model;
-extern	Model_t HL101_model;
-extern	Model_t VIP2_model;
-extern	Model_t Hs5101_model;
 extern	Model_t Spark_model;
-extern	Model_t Adb_Box_model;
-extern	Model_t Cuberevo_model;
-extern	Model_t CNBOX_model;
+
+static Model_t * AvailableModels[] = {
+	&Spark_model,
+	NULL
+};
 
 double	modJulianDate(struct tm *theTime);
-int	get_GMT_offset(struct tm theTime);
 time_t	read_timers_utc(time_t curTime);
 time_t	read_fake_timer_utc(time_t curTime);
-int	searchModel(Context_t *context, eBoxType type);
-int	checkConfig(int *display, int *display_custom, char **timeFormat, int *wakeup);
+int searchModel(Context_t  *context, eBoxType type);
+int checkConfig(int* display, int* display_custom, char** timeFormat, int* wakeup);
 
 int getWakeupReasonPseudo(eWakeupReason *reason);
 int syncWasTimerWakeup(eWakeupReason reason);
 
-int	disp; //controls screen output
-int	Vdisplay;
-int	Vdisplay_custom;
-char	*VtimeFormat;
-int	Vwakeup;
-
 #endif
diff -Naur sh4-apps/tools/fp_control/Hl101.c taapat-apps/tools/fp_control/Hl101.c
--- sh4-apps/tools/fp_control/Hl101.c	2019-02-20 16:00:47.074955573 +0100
+++ taapat-apps/tools/fp_control/Hl101.c	1970-01-01 01:00:00.000000000 +0100
@@ -1,438 +0,0 @@
-/*
- * Hl101.c
- *
- * (c) 2010 duckbox project
- *
- * This program is free software; you can redistribute it and/or modify
- * it under the terms of the GNU General Public License as published by
- * the Free Software Foundation; either version 2 of the License, or
- * (at your option) any later version.
- *
- * This program is distributed in the hope that it will be useful,
- * but WITHOUT ANY WARRANTY; without even the implied warranty of
- * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the
- * GNU General Public License for more details.
- *
- * You should have received a copy of the GNU General Public License
- * along with this program; if not, write to the Free Software
- * Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA 02111-1307 USA
- *
- */
-
-/* ******************* includes ************************ */
-#include <stdio.h>
-#include <stdlib.h>
-#include <string.h>
-#include <time.h>
-#include <sys/types.h>
-#include <sys/stat.h>
-#include <fcntl.h>
-#include <unistd.h>
-#include <limits.h>
-#include <sys/ioctl.h>
-
-#include "global.h"
-#include "Hl101.h"
-
-static int setText(Context_t *context, char *theText);
-
-/* ******************* constants ************************ */
-
-#define cVFD_DEVICE "/dev/vfd"
-
-#define cMAXCharsHL101 16
-
-typedef struct
-{
-	int display;
-	int display_custom;
-	char *timeFormat;
-
-	time_t wakeupTime;
-	int wakeupDecrement;
-} tHL101Private;
-
-/* ******************* helper/misc functions ****************** */
-
-/* Calculate the time value which we can pass to
- * the proton fp. its a mjd time (mjd=modified
- * julian date). mjd is relativ to gmt so theGMTTime
- * must be in GMT/UTC.
- */
-void setProtonTime(time_t theGMTTime, char *destString)
-{
-	/* from u-boot proton */
-	struct tm *now_tm;
-	now_tm = gmtime(&theGMTTime);
-	printf("Set Time (UTC): %02d:%02d:%02d %02d-%02d-%04d\n",
-		   now_tm->tm_hour, now_tm->tm_min, now_tm->tm_sec, now_tm->tm_mday, now_tm->tm_mon + 1, now_tm->tm_year + 1900);
-	double mjd = modJulianDate(now_tm);
-	int mjd_int = mjd;
-	destString[0] = (mjd_int >> 8);
-	destString[1] = (mjd_int & 0xff);
-	destString[2] = now_tm->tm_hour;
-	destString[3] = now_tm->tm_min;
-	destString[4] = now_tm->tm_sec;
-}
-
-unsigned long getProtonTime(char *protonTimeString)
-{
-	unsigned int    mjd     = ((protonTimeString[1] & 0xFF) * 256) + (protonTimeString[2] & 0xFF);
-	unsigned long   epoch   = ((mjd - 40587) * 86400);
-	unsigned int    hour    = protonTimeString[3] & 0xFF;
-	unsigned int    min     = protonTimeString[4] & 0xFF;
-	unsigned int    sec     = protonTimeString[5] & 0xFF;
-	epoch += (hour * 3600 + min * 60 + sec);
-	printf("MJD = %d epoch = %ld, time = %02d:%02d:%02d\n", mjd,
-		   epoch, hour, min, sec);
-	return epoch;
-}
-
-/* ******************* driver functions ****************** */
-
-static int init(Context_t *context)
-{
-	tHL101Private *private = malloc(sizeof(tHL101Private));
-	int vFd;
-//	printf("%s\n", __func__);
-	vFd = open(cVFD_DEVICE, O_RDWR);
-	if (vFd < 0)
-	{
-		fprintf(stderr, "cannot open %s\n", cVFD_DEVICE);
-		perror("");
-	}
-	((Model_t *)context->m)->private = private;
-	memset(private, 0, sizeof(tHL101Private));
-	checkConfig(&private->display, &private->display_custom, &private->timeFormat, &private->wakeupDecrement);
-	return vFd;
-}
-
-static int usage(Context_t *context, char *prg_name, char *cmd_name)
-{
-	fprintf(stderr, "%s: not implemented\n", __func__);
-	return -1;
-}
-
-static int setTime(Context_t *context, time_t *theGMTTime)
-{
-	struct proton_ioctl_data vData;
-//	printf("%s\n", __func__);
-	setProtonTime(*theGMTTime, vData.u.time.time);
-	if (ioctl(context->fd, VFDSETTIME, &vData) < 0)
-	{
-		perror("settime: ");
-		return -1;
-	}
-	return 0;
-}
-
-static int getTime(Context_t *context, time_t *theGMTTime)
-{
-	char fp_time[8];
-	fprintf(stderr, "Waiting for current time from fp...\n");
-	/* front controller time */
-	if (ioctl(context->fd, VFDGETTIME, &fp_time) < 0)
-	{
-		perror("gettime: ");
-		return -1;
-	}
-	/* if we get the fp time */
-	if (fp_time[0] != '\0')
-	{
-//		fprintf(stderr, "Success reading time from fp\n");
-		/* current front controller time */
-		*theGMTTime = (time_t) getProtonTime(fp_time);
-	}
-	else
-	{
-		fprintf(stderr, "Error reading time from fp\n");
-		*theGMTTime = 0;
-	}
-	return 0;
-}
-
-static int setTimer(Context_t *context, time_t *theGMTTime)
-{
-	struct proton_ioctl_data vData;
-	time_t curTime;
-	time_t wakeupTime;
-	struct tm *ts;
-	time(&curTime);
-	ts = localtime(&curTime);
-	fprintf(stderr, "Current Time: %02d:%02d:%02d %02d-%02d-%04d\n",
-			ts->tm_hour, ts->tm_min, ts->tm_sec, ts->tm_mday, ts->tm_mon + 1, ts->tm_year + 1900);
-	if (theGMTTime == NULL)
-	{
-		wakeupTime = read_timers_utc(curTime);
-	}
-	else
-	{
-		wakeupTime = *theGMTTime;
-	}
-	if ((wakeupTime <= 0) || (wakeupTime == LONG_MAX))
-	{
-		/* nothing to do for e2 */
-		fprintf(stderr, "no e2 timer found clearing fp wakeup time. Goodbye...\n");
-		vData.u.standby.time[0] = '\0';
-		if (ioctl(context->fd, VFDSTANDBY, &vData) < 0)
-		{
-			perror("standby: ");
-			return -1;
-		}
-	}
-	else
-	{
-		unsigned long diff;
-		char fp_time[8];
-		fprintf(stderr, "Waiting for current time from fp...\n");
-		/* front controller time */
-		if (ioctl(context->fd, VFDGETTIME, &fp_time) < 0)
-		{
-			perror("gettime: ");
-			return -1;
-		}
-		/* difference from now to wake up */
-		diff = (unsigned long int) wakeupTime - curTime;
-		/* if we get the fp time */
-		if (fp_time[0] != '\0')
-		{
-//			fprintf(stderr, "Success reading time from fp\n");
-			/* current front controller time */
-			curTime = (time_t) getProtonTime(fp_time);
-		}
-		else
-		{
-			fprintf(stderr, "Error reading time, assuming localtime.\n");
-			/* noop current time already set */
-		}
-		wakeupTime = curTime + diff;
-		setProtonTime(wakeupTime, vData.u.standby.time);
-		if (ioctl(context->fd, VFDSTANDBY, &vData) < 0)
-		{
-			perror("standby: ");
-			return -1;
-		}
-	}
-	return 0;
-}
-
-static int getWTime(Context_t *context, time_t *theGMTTime)
-{
-	fprintf(stderr, "%s: not implemented\n", __func__);
-	return -1;
-}
-
-static int shutdown(Context_t *context, time_t *shutdownTimeGMT)
-{
-	time_t curTime;
-	/* shutdown immediately */
-	if (*shutdownTimeGMT == -1)
-	{
-		return (setTimer(context, NULL));
-	}
-	while (1)
-	{
-		time(&curTime);
-		/*printf("curTime = %d, shutdown %d\n", curTime, *shutdownTimeGMT);*/
-		if (curTime >= *shutdownTimeGMT)
-		{
-			/* set most recent e2 timer and bye bye */
-			return (setTimer(context, NULL));
-		}
-		usleep(100000);
-	}
-	return -1;
-}
-
-static int reboot(Context_t *context, time_t *rebootTimeGMT)
-{
-	time_t curTime;
-	struct proton_ioctl_data vData;
-	while (1)
-	{
-		time(&curTime);
-		if (curTime >= *rebootTimeGMT)
-		{
-			if (ioctl(context->fd, VFDREBOOT, &vData) < 0)
-			{
-				perror("reboot: ");
-				return -1;
-			}
-		}
-		usleep(100000);
-	}
-	return 0;
-}
-
-static int Sleep(Context_t *context, time_t *wakeUpGMT)
-{
-#if 0
-	time_t     curTime;
-	int        sleep = 1;
-	int        vFd;
-	fd_set     rfds;
-	struct     timeval tv;
-	int        retval;
-	struct tm  *ts;
-	char       output[cMAXCharsHL101 + 1];
-	tHL101Private *private = (tHL101Private *)((Model_t *)context->m)->private;
-	printf("%s\n", __func__);
-	vFd = open(cRC_DEVICE, O_RDWR);
-	if (vFd < 0)
-	{
-		fprintf(stderr, "cannot open %s\n", cRC_DEVICE);
-		perror("");
-		return -1;
-	}
-	printf("%s 1\n", __func__);
-	while (sleep)
-	{
-		time(&curTime);
-		ts = localtime(&curTime);
-		if (curTime >= *wakeUpGMT)
-		{
-			sleep = 0;
-		}
-		else
-		{
-			FD_ZERO(&rfds);
-			FD_SET(vFd, &rfds);
-			tv.tv_sec = 0;
-			tv.tv_usec = 100000;
-			retval = select(vFd + 1, &rfds, NULL, NULL, &tv);
-			if (retval > 0)
-			{
-				sleep = 0;
-			}
-		}
-		if (private->display)
-		{
-			strftime(output, cMAXCharsHL101 + 1, private->timeFormat, ts);
-			setText(context, output);
-		}
-	}
-#endif
-	return 0;
-}
-
-static int setText(Context_t *context, char *theText)
-{
-	char vHelp[128];
-	strncpy(vHelp, theText, cMAXCharsHL101);
-	vHelp[cMAXCharsHL101] = '\0';
-	/* printf("%s, %d\n", vHelp, strlen(vHelp));*/
-	write(context->fd, vHelp, strlen(vHelp));
-	return 0;
-}
-
-static int setLed(Context_t *context, int which, int on)
-{
-	struct proton_ioctl_data vData;
-	vData.u.led.led_nr = which;
-	vData.u.led.on = on;
-	if (ioctl(context->fd, VFDSETLED, &vData) < 0)
-	{
-		perror("setLed: ");
-		return -1;
-	}
-	return 0;
-}
-
-static int setIcon(Context_t *context, int which, int on)
-{
-	struct proton_ioctl_data vData;
-	vData.u.icon.icon_nr = which;
-	vData.u.icon.on = on;
-	if (ioctl(context->fd, VFDICONDISPLAYONOFF, &vData) < 0)
-	{
-		perror("setIcon: ");
-		return -1;
-	}
-	return 0;
-}
-
-static int setBrightness(Context_t *context, int brightness)
-{
-	struct proton_ioctl_data vData;
-	if (brightness < 0 || brightness > 7)
-	{
-		return -1;
-	}
-	vData.u.brightness.level = brightness;
-	printf("%d\n", context->fd);
-	if (ioctl(context->fd, VFDBRIGHTNESS, &vData) < 0)
-	{
-		perror("setBrightness: ");
-		return -1;
-	}
-	return 0;
-}
-
-static int setLight(Context_t *context, int on)
-{
-	if (on)
-	{
-		setBrightness(context, 7);
-	}
-	else
-	{
-		setBrightness(context, 0);
-	}
-	return 0;
-}
-
-static int Exit(Context_t *context)
-{
-	tHL101Private *private = (tHL101Private *)((Model_t *)context->m)->private;
-	if (context->fd > 0)
-	{
-		close(context->fd);
-	}
-	free(private);
-	exit(1);
-}
-
-static int Clear(Context_t *context)
-{
-	struct proton_ioctl_data vData;
-	if (ioctl(context->fd, VFDDISPLAYCLR, &vData) < 0)
-	{
-		perror("clear: ");
-		return -1;
-	}
-	return 0;
-}
-
-Model_t HL101_model =
-{
-	.Name             = "Spider HL101 frontpanel control utility",
-	.Type             = Hl101,
-	.Init             = init,
-	.Clear            = Clear,
-	.Usage            = usage,
-	.SetTime          = setTime,
-	.GetTime          = getTime,
-	.SetTimer         = setTimer,
-	.GetWTime         = getWTime,
-	.SetWTime         = NULL,
-	.Shutdown         = shutdown,
-	.Reboot           = reboot,
-	.Sleep            = Sleep,
-	.SetText          = setText,
-	.SetLed           = setLed,
-	.SetIcon          = setIcon,
-	.SetBrightness    = setBrightness,
-	.GetWakeupReason  = NULL,
-	.SetLight         = setLight,
-	.SetLedBrightness = NULL,
-	.GetVersion       = NULL,
-	.SetRF            = NULL,
-	.SetFan           = NULL,
-	.GetWakeupTime    = NULL,
-	.SetDisplayTime   = NULL,
-	.SetTimeMode      = NULL,
-#if defined MODEL_SPECIFIC
-	.ModelSpecific    = NULL,
-#endif
-	.Exit             = Exit
-};
diff -Naur sh4-apps/tools/fp_control/Hl101.h taapat-apps/tools/fp_control/Hl101.h
--- sh4-apps/tools/fp_control/Hl101.h	2019-02-20 16:00:47.074955573 +0100
+++ taapat-apps/tools/fp_control/Hl101.h	1970-01-01 01:00:00.000000000 +0100
@@ -1,59 +0,0 @@
-#ifndef __hl101__
-#define __hl101__
-
-/* this setups the mode temporarily (for one ioctl)
- * to the desired mode. currently the "normal" mode
- * is the compatible vfd mode
- */
-struct set_mode_s
-{
-	int compat; /* 0 = compatibility mode to vfd driver; 1 = nuvoton mode */
-};
-
-struct set_brightness_s
-{
-	int level;
-};
-
-struct set_icon_s
-{
-	int icon_nr;
-	int on;
-};
-
-struct set_led_s
-{
-	int led_nr;
-	int on;
-};
-
-/* time must be given as follows:
- * time[0] & time[1] = mjd ???
- * time[2] = hour
- * time[3] = min
- * time[4] = sec
- */
-struct set_standby_s
-{
-	char time[5];
-};
-
-struct set_time_s
-{
-	char time[5];
-};
-
-struct proton_ioctl_data
-{
-	union
-	{
-		struct set_icon_s icon;
-		struct set_led_s led;
-		struct set_brightness_s brightness;
-		struct set_mode_s mode;
-		struct set_standby_s standby;
-		struct set_time_s time;
-	} u;
-};
-
-#endif
diff -Naur sh4-apps/tools/fp_control/Homecast5101.c taapat-apps/tools/fp_control/Homecast5101.c
--- sh4-apps/tools/fp_control/Homecast5101.c	2019-02-20 16:00:47.074955573 +0100
+++ taapat-apps/tools/fp_control/Homecast5101.c	1970-01-01 01:00:00.000000000 +0100
@@ -1,535 +0,0 @@
-/*
- * Homecast5101.c
- *
- * (c) 2009 corev
- *
- * This program is free software; you can redistribute it and/or modify
- * it under the terms of the GNU General Public License as published by
- * the Free Software Foundation; either version 2 of the License, or
- * (at your option) any later version.
- *
- * This program is distributed in the hope that it will be useful,
- * but WITHOUT ANY WARRANTY; without even the implied warranty of
- * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the
- * GNU General Public License for more details.
- *
- * You should have received a copy of the GNU General Public License
- * along with this program; if not, write to the Free Software
- * Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA 02111-1307 USA
- *
- */
-
-/* ******************* includes ************************ */
-#include <stdio.h>
-#include <stdlib.h>
-#include <string.h>
-#include <time.h>
-#include <sys/types.h>
-#include <sys/stat.h>
-#include <fcntl.h>
-#include <unistd.h>
-#include <limits.h>
-#include <sys/ioctl.h>
-#include <termios.h>
-#include <linux/fb.h>
-#include <linux/stmfb.h>
-#include <linux/input.h>
-
-#include "global.h"
-
-static int setText(Context_t *context, char *theText);
-static int setIcon(Context_t *context, int which, int on);
-static int setLed(Context_t *context, int which, int on);
-static int Sleep(Context_t *context, time_t *wakeUpGMT);
-static int setLight(Context_t *context, int on);
-
-/* ******************* constants ************************ */
-//#define cmdReboot "/sbin/reboot" /* does not currently work */
-#define cmdReboot "init 6"
-#define cmdHalt "/sbin/halt"
-
-#define cVFD_DEVICE "/dev/vfd"
-#define cCMDLINE "/proc/cmdline"
-
-#define cMAXCharsHS5101 12
-
-typedef struct
-{
-	int vfd;
-	int fd_green;
-	int fd_red;
-	int fd_yellow;
-
-	int nfs;
-
-	int display;
-	int display_custom;
-	char *timeFormat;
-
-	time_t wakeupTime;
-	int wakeupDecrement;
-} tHS5101Private;
-
-/* ----------------------------------------------------- */
-void hs5101_avs_standby(int fd_avs, unsigned int mode)
-{
-	printf("%s %d\n", __func__, mode);
-	if (!mode)
-	{
-		write(fd_avs, "on", 2);
-	}
-	else
-	{
-		write(fd_avs, "off", 3);
-	}
-}
-
-/* ----------------------------------------------------- */
-void hs5101_hdmi_standby(int fd_hdmi, int mode)
-{
-	struct stmfbio_output_configuration outputConfig = {0};
-	printf("%s %d\n", __func__, mode);
-	outputConfig.outputid = 1;
-	if (ioctl(fd_hdmi, STMFBIO_GET_OUTPUT_CONFIG, &outputConfig) < 0)
-	{
-		perror("Getting current output configuration failed");
-	}
-	outputConfig.caps = 0;
-	outputConfig.activate = STMFBIO_ACTIVATE_IMMEDIATE;
-	outputConfig.analogue_config = 0;
-	outputConfig.caps |= STMFBIO_OUTPUT_CAPS_HDMI_CONFIG;
-	if (!mode)
-	{
-		outputConfig.hdmi_config |= STMFBIO_OUTPUT_HDMI_DISABLED;
-	}
-	else
-	{
-		outputConfig.hdmi_config &= ~STMFBIO_OUTPUT_HDMI_DISABLED;
-	}
-	if (outputConfig.caps != STMFBIO_OUTPUT_CAPS_NONE)
-	{
-		if (ioctl(fd_hdmi, STMFBIO_SET_OUTPUT_CONFIG, &outputConfig) < 0)
-		{
-			perror("setting output configuration failed");
-		}
-	}
-}
-
-/* ----------------------------------------------------- */
-
-void hs5101_startPseudoStandby(Context_t *context, tHS5101Private *private)
-{
-	int id;
-	int fd_avs = open("/proc/stb/avs/0/standby", O_RDWR);
-	int fd_hdmi = open("/dev/fb0", O_RDWR);
-	printf("%s\n", __func__);
-	setLed(context, 1, 0);
-	setLed(context, 2, 0);
-	setLed(context, 3, 0);
-	hs5101_avs_standby(fd_avs, 0);
-	hs5101_hdmi_standby(fd_hdmi, 0);
-	setText(context, "                ");
-	for (id = 0x10; id < 0x20; id++)
-	{
-		setIcon(context, id, 0);
-	}
-	if (private->display == 0)
-	{
-		setLight(context, 0);
-	}
-	close(fd_hdmi);
-	close(fd_avs);
-}
-
-void hs5101_stopPseudoStandby(Context_t *context, tHS5101Private *private)
-{
-	int fd_avs = open("/proc/stb/avs/0/standby", O_RDWR);
-	int fd_hdmi = open("/dev/fb0", O_RDWR);
-	int id;
-	printf("%s\n", __func__);
-	if (private->display == 0)
-	{
-		setLight(context, 1);
-	}
-	setText(context, "                ");
-	for (id = 0x10; id < 0x20; id++)
-	{
-		setIcon(context, id, 0);
-	}
-	hs5101_hdmi_standby(fd_hdmi, 1);
-	hs5101_avs_standby(fd_avs, 1);
-	setLed(context, 1, 0);
-	setLed(context, 2, 0);
-	setLed(context, 3, 0);
-	close(fd_hdmi);
-	close(fd_avs);
-}
-
-/* ******************* driver functions ****************** */
-
-static int init(Context_t *context)
-{
-	char	cmdLine[512];
-	int	vFd;
-	tHS5101Private *private = malloc(sizeof(tHS5101Private));
-//	printf("%s\n", __func__);
-	((Model_t *)context->m)->private = private;
-	memset(private, 0, sizeof(tHS5101Private));
-	vFd = open(cCMDLINE, O_RDWR);
-	private->nfs = 0;
-	if (read(vFd, cmdLine, 512) > 0)
-	{
-		if (strstr("nfsroot", cmdLine) != NULL)
-		{
-			private->nfs = 1;
-		}
-	}
-	close(vFd);
-	if (private->nfs)
-	{
-		printf("mode = nfs\n");
-	}
-	else
-	{
-		printf("mode = none nfs\n");
-	}
-	vFd = open(cVFD_DEVICE, O_RDWR);
-	if (vFd < 0)
-	{
-		fprintf(stderr, "cannot open %s\n", cVFD_DEVICE);
-		perror("");
-	}
-	//    private->fd_green = open("/sys/class/leds/ufs910\\:green/brightness", O_WRONLY);
-	//    private->fd_red = open("/sys/class/leds/ufs910\\:red/brightness", O_WRONLY);
-	//    private->fd_yellow = open("/sys/class/leds/ufs910\\:yellow/brightness", O_WRONLY);
-	private->vfd = open(cVFD_DEVICE, O_RDWR);
-	if (private->vfd < 0)
-	{
-		fprintf(stderr, "cannot open %s\n", cVFD_DEVICE);
-		perror("");
-	}
-	checkConfig(&private->display, &private->display_custom, &private->timeFormat, &private->wakeupDecrement);
-	return vFd;
-}
-
-static int usage(Context_t *context, char *prg_name, char *cmd_name)
-{
-	fprintf(stderr, "%s: not implemented\n", __func__);
-	return -1;
-}
-
-static int setTime(Context_t *context, time_t *theGMTTime)
-{
-	fprintf(stderr, "%s: not implemented\n", __func__);
-	return -1;
-}
-
-static int getTime(Context_t *context, time_t *theGMTTime)
-{
-	fprintf(stderr, "%s: not implemented\n", __func__);
-	return -1;
-}
-
-static int setTimer(Context_t *context, time_t *theGMTTime)
-{
-	time_t curTime;
-	struct tm *ts;
-	tHS5101Private *private = (tHS5101Private *)((Model_t *)context->m)->private;
-	printf("%s\n", __func__);
-	time(&curTime);
-	ts = localtime(&curTime);
-	fprintf(stderr, "Current Time: %02d:%02d:%02d %02d-%02d-%04d\n",
-			ts->tm_hour, ts->tm_min, ts->tm_sec, ts->tm_mday, ts->tm_mon + 1, ts->tm_year + 1900);
-	hs5101_startPseudoStandby(context, private);
-	if (theGMTTime == NULL)
-	{
-		private->wakeupTime = read_timers_utc(curTime);
-	}
-	else
-	{
-		private->wakeupTime = *theGMTTime;
-	}
-	Sleep(context, &private->wakeupTime);
-	hs5101_stopPseudoStandby(context, private);
-	return 0;
-}
-
-static int getWTime(Context_t *context, time_t *theGMTTime)
-{
-	fprintf(stderr, "%s: not implemented\n", __func__);
-	return -1;
-}
-
-static int shutdown(Context_t *context, time_t *shutdownTimeGMT)
-{
-	time_t curTime;
-	printf("%s\n", __func__);
-	/* shutdown immediately */
-	if (*shutdownTimeGMT == -1)
-	{
-		system(cmdHalt);
-	}
-	while (1)
-	{
-		time(&curTime);
-		if (curTime >= *shutdownTimeGMT)
-		{
-			system(cmdHalt);
-		}
-		usleep(100000);
-	}
-	return -1;
-}
-
-static int reboot(Context_t *context, time_t *rebootTimeGMT)
-{
-	time_t	curTime;
-
-	printf("%s\n", __func__);
-	while (1)
-	{
-		time(&curTime);
-		if (curTime >= *rebootTimeGMT)
-		{
-			system(cmdReboot);
-		}
-		usleep(100000);
-	}
-	return 0;
-}
-
-static int Sleep(Context_t *context, time_t *wakeUpGMT)
-{
-	time_t curTime;
-	int sleep = 1;
-	int vFd;
-	fd_set rfds;
-	struct timeval tv;
-	int retval, len, i;
-	struct tm *ts;
-	char output[cMAXCharsHS5101 + 1];
-	struct input_event data[64];
-	tHS5101Private *private = (tHS5101Private *)((Model_t *)context->m)->private;
-	printf("%s\n", __func__);
-	output[cMAXCharsHS5101] = '\0';
-	vFd = open("/dev/input/event0", O_RDONLY);
-	if (vFd < 0)
-	{
-		perror("event0");
-		return -1;
-	}
-	while (sleep)
-	{
-		time(&curTime);
-		ts = localtime(&curTime);
-		if (curTime >= *wakeUpGMT)
-		{
-			sleep = 0;
-		}
-		else
-		{
-			FD_ZERO(&rfds);
-			FD_SET(vFd, &rfds);
-			tv.tv_sec = 0;
-			tv.tv_usec = 100000;
-			retval = select(vFd + 1, &rfds, NULL, NULL, &tv);
-			if (retval > 0)
-			{
-				len = read(vFd, data, sizeof(struct input_event) * 64);
-				for (i = 0; i < len / sizeof(struct input_event); i++)
-				{
-					if (data[i].type == EV_SYN)
-					{
-						/* noop */
-					}
-					else if (data[i].type == EV_MSC && (data[i].code == MSC_RAW || data[i].code == MSC_SCAN))
-					{
-						/* noop */
-					}
-					else
-					{
-						if (data[i].code == 116)
-						{
-							sleep = 0;
-						}
-					}
-				}
-			}
-		}
-		if (private->display)
-		{
-			strftime(output, cMAXCharsHS5101 + 1, private->timeFormat, ts);
-			write(private->vfd, &output, sizeof(output));
-		}
-	}
-	return 0;
-}
-
-static int setText(Context_t *context, char *theText)
-{
-	struct vfd_ioctl_data vData;
-	printf("%s\n", __func__);
-	strncpy((char *) vData.data, theText, cMAXCharsHS5101);
-	vData.data[cMAXCharsHS5101] = '\0';
-	vData.length = strlen((char *) vData.data);
-	if (ioctl(context->fd, VFDSTANDBY, &vData) < 0) //VFDSTANDBY????
-	{
-		perror("setText: ");
-		return -1;
-	}
-	return 0;
-}
-
-static int setLed(Context_t *context, int which, int on)
-{
-	tHS5101Private *private = (tHS5101Private *)((Model_t *)context->m)->private;
-	printf("%s\n", __func__);
-	return 0;
-	if (which == 1)
-	{
-		write(private->fd_green, on == 0 ? "0" : "1", 1);
-	}
-	else if (which == 2)
-	{
-		write(private->fd_red, on == 0 ? "0" : "1", 1);
-	}
-	else if (which == 3)
-	{
-		write(private->fd_red, on == 0 ? "0" : "1", 1);
-	}
-	else
-	{
-		return -1;
-	}
-	return 0;
-}
-
-static int setIcon(Context_t *context, int which, int on)
-{
-	struct vfd_ioctl_data data;
-	tHS5101Private *private = (tHS5101Private *)((Model_t *)context->m)->private;
-	printf("%s\n", __func__);
-	memset(data.data, ' ', 63);
-	data.start = 0;
-	data.length = 5;
-	data.data[0] = which & 0x0f;
-	data.data[4] = on;
-	if (ioctl(private->vfd, VFDICONDISPLAYONOFF, &data) < 0)
-	{
-		perror("setIcon: ");
-		return -1;
-	}
-	return 0;
-}
-
-static int setBrightness(Context_t *context, int brightness)
-{
-	struct vfd_ioctl_data data;
-	tHS5101Private *private = (tHS5101Private *)((Model_t *)context->m)->private;
-	printf("%s\n", __func__);
-	if (brightness < 0 || brightness > 7)
-	{
-		return -1;
-	}
-	memset(data.data, ' ', 63);
-	data.start = brightness & 0x07;
-	data.length = 0;
-	if (ioctl(private->vfd, VFDBRIGHTNESS, &data) < 0)
-	{
-		perror("setbrightness: ");
-		return -1;
-	}
-	return 0;
-}
-
-static int setLight(Context_t *context, int on)
-{
-	struct vfd_ioctl_data data;
-	tHS5101Private *private = (tHS5101Private *)((Model_t *)context->m)->private;
-	printf("%s\n", __func__);
-	memset(&data, 0, sizeof(struct vfd_ioctl_data));
-	if (on)
-	{
-		data.start = 0x01;
-	}
-	else
-	{
-		data.start = 0x00;
-	}
-	data.length = 0;
-	if (ioctl(private->vfd, VFDDISPLAYWRITEONOFF, &data) < 0)
-	{
-		perror("setLight: ");
-		return -1;
-	}
-	return 0;
-}
-
-static int Exit(Context_t *context)
-{
-	tHS5101Private *private = (tHS5101Private *)((Model_t *)context->m)->private;
-	printf("%s\n", __func__);
-	if (context->fd > 0)
-	{
-		close(context->fd);
-	}
-	if (private->vfd > 0)
-	{
-		close(private->vfd);
-	}
-	//    close(private->fd_green);
-	//    close(private->fd_red);
-	//    close(private->fd_yellow);
-	free(private);
-	exit(1);
-}
-
-static int Clear(Context_t *context)
-{
-	int i;
-	setText(context, "                ");
-	setBrightness(context, 7);
-	for (i = 1; i <= 3 ; i++)
-	{
-		setLed(context, i, 0);
-	}
-	for (i = 1; i <= 16 ; i++)
-	{
-		setIcon(context, i, 0);
-	}
-	return 0;
-}
-
-Model_t Hs5101_model =
-{
-	.Name             = "Homecast 5101 frontpanel control utility",
-	.Type             = Hs5101,
-	.Init             = init,
-	.Clear            = Clear,
-	.Usage            = usage,
-	.SetTime          = setTime,
-	.GetTime          = getTime,
-	.SetTimer         = setTimer,
-	.GetWTime         = getWTime,
-	.SetWTime         = NULL,
-	.Shutdown         = shutdown,
-	.Reboot           = reboot,
-	.Sleep            = Sleep,
-	.SetText          = setText,
-	.SetLed           = setLed,
-	.SetIcon          = setIcon,
-	.SetBrightness    = setBrightness,
-	.GetWakeupReason  = NULL,
-	.SetLight         = setLight,
-	.SetLedBrightness = NULL,
-	.GetVersion       = NULL,
-	.SetRF            = NULL,
-	.SetFan           = NULL,
-	.GetWakeupTime    = NULL,
-	.SetDisplayTime   = NULL,
-	.SetTimeMode      = NULL,
-#if defined MODEL_SPECIFIC
-	.ModelSpecific    = NULL,
-#endif
-	.Exit             = Exit
-};
diff -Naur sh4-apps/tools/fp_control/Makefile.am taapat-apps/tools/fp_control/Makefile.am
--- sh4-apps/tools/fp_control/Makefile.am	2019-02-20 16:00:47.074955573 +0100
+++ taapat-apps/tools/fp_control/Makefile.am	2019-02-20 15:59:37.637646158 +0100
@@ -1,23 +1,5 @@
 bin_PROGRAMS = fp_control
 
-fp_control_SOURCES = \
-	fp_control.c \
-	global.c \
-	Ufs910_1W.c \
-	Ufs910_14W.c \
-	Ufs912.c \
-	Ufs922.c \
-	Ufc960.c \
-	Fortis.c \
-	Hl101.c \
-	Vip2.c \
-	Homecast5101.c \
-	Spark.c \
-	Cuberevo.c \
-	Adb_Box.c \
-	Cnbox.c
-
+fp_control_SOURCES = fp_control.c global.c Spark.c
 AM_CFLAGS = -Wall
 AM_LDFLAGS = -lrt
-ACLOCAL_AMFLAGS = -I m4
-
diff -Naur sh4-apps/tools/fp_control/Spark.c taapat-apps/tools/fp_control/Spark.c
--- sh4-apps/tools/fp_control/Spark.c	2019-02-20 16:00:47.074955573 +0100
+++ taapat-apps/tools/fp_control/Spark.c	2019-02-20 15:59:37.637646158 +0100
@@ -10,30 +10,16 @@
  *
  * This program is distributed in the hope that it will be useful,
  * but WITHOUT ANY WARRANTY; without even the implied warranty of
- * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
  * GNU General Public License for more details.
  *
  * You should have received a copy of the GNU General Public License
  * along with this program; if not, write to the Free Software
  * Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA 02111-1307 USA
  *
- ****************************************************************************
- *
- * Changes
- *
- * Date     By              Description
- * --------------------------------------------------------------------------
- * 20130909 Audioniek       Get wake up reason made functional.
- * 20130910 Audioniek       Set timer polished.
- * 20130911 Audioniek       Shutdown polished.
- * 20130911 Audioniek       Reboot built.
- * 20150404 Audioniek       -tm added for DVFD models.
- * 20150410 Audioniek       Awareness of VFD or DVFD front panel versions
- *                          added, including time mode on DVFD.
- *
- ****************************************************************************/
+ */
 
-/* ******************* includes ************************ */
+/******************** includes ************************ */
 #include <stdio.h>
 #include <stdlib.h>
 #include <string.h>
@@ -48,867 +34,496 @@
 #include "global.h"
 #include "Spark.h"
 
-static int Spark_setText(Context_t *context, char *theText);
-int res;
-unsigned int fp_type;
-unsigned int time_mode;
+static int Spark_setText(Context_t* context, char* theText);
 
-/* ******************* constants ************************ */
+/******************** constants ************************ */
 
 #define cVFD_DEVICE "/dev/vfd"
-#define cRTC_OFFSET_FILE "/proc/stb/fp/rtc_offset"
-#define cMAXCharsSpark 8
 
-typedef struct
-{
-	char    *arg;
-	char    *arg_long;
-	char    *arg_description;
-} tArgs;
-
-tArgs vHArgs[] =
-{
-	{ "-e", "  --setTimer           ", "Args: [time date] (format: HH:MM:SS dd-mm-YYYY)" },
-	{ "", "                         ", "      No arg:     Set the most recent timer from e2 or neutrino" },
-	{ "", "                         ", "                  to the frontcontroller and shutdown" },
-	{ "", "                         ", "      Arg time date: Set frontcontroller wake-up time to" },
-	{ "", "                         ", "                  time, shutdown, and wake up at given time" },
-	{ "-d", "  --shutdown           ", "Args: [time date] (format: HH:MM:SS dd-mm-YYYY)" },
-	{ "", "                         ", "      No arg:     Shut down immediately" },
-	{ "", "                         ", "      Arg time date: Shut down at given time/date" },
-	{ "-r", "  --reboot             ", "Args: [time date] (format: HH:MM:SS dd-mm-YYYY)" },
-	{ "", "                         ", "      No arg:     Reboot immediately (= -e current time+5 date today)" },
-	{ "", "                         ", "      Arg time date: Reboot at given time/date (= -e time date)" },
-	{ "-g", "  --getTime            ", "Args: None        Display currently set frontprocessor time" },
-	{ "-gs", " --getTimeAndSet      ", "Args: None        Set system time to current frontprocessor time" },
-	{ "-gt", " --getWTime           ", "Args: None        Get the current frontcontroller wake up time" },
-	{ "-s", "  --setTime            ", "Args: time date   Format: HH:MM:SS dd-mm-YYYY" },
-	{ "", "                         ", "                  Set the frontprocessor time (date ignored)" },
-	{ "", "                         ", "      WARNING:    front panel date will be 01-01-1970!" },
-	{ "-st", " --setWTime           ", "Args: time date   Format: HH:MM:SS dd-mm-YYYY" },
-	{ "", "                         ", "                  Set the frontprocessor wake up time" },
-	{ "-sst", "--setSystemTime      ", "Args: None        Set frontprocessor time to current system time" },
-//	{ "-p", "  --sleep              ", "Args: time date   Format: HH:MM:SS dd-mm-YYYY\n\t\tReboot receiver via fp at given time" },
-	{ "-t", "  --settext            ", "Arg : text        Show text in front panel display" },
-	{ "-l", "  --setLed             ", "Args: LED# 0|1|2  LED#: off, on or blink" },
-	{ "-i", "  --setIcon            ", "Args: icon# 0|1   Set an icon off or on" },
-	{ "-b", "  --setBrightness      ", "Arg : 0..7        Set display brightness (VFD/DVFD only)" },
-	{ "-w", "  --getWakeupReason    ", "Args: None        Get the wake up reason" },
-	{ "-tm", " --time_mode          ", "Arg : 0|1         Clock display off|on (DVFD only)" },
-	{ "-L", "  --setLight           ", "Arg : 0|1         Set display off|on" },
-	{ "-c", "  --clear              ", "Args: None        Clear display, all icons and LEDs off" },
-	{ "-v", "  --version            ", "Args: None        Get version info from frontprocessor" },
-	{ "-V", "  --verbose            ", "Args: None        Verbose operation" },
-#if defined MODEL_SPECIFIC
-	{ "-ms ", "--set_model_specific ", "Args: long long   Model specific set function" },
-#endif
-	{ NULL, NULL, NULL }
-};
+#define cMAXCharsVIP2 16
 
 typedef struct
 {
-	int display;
-	int display_custom;
-	char *timeFormat;
+    int    display;
+    int    display_custom;
+    char*  timeFormat;
 
-	time_t wakeupTime;
-	int wakeupDecrement;
+    time_t wakeupTime;
+    int    wakeupDecrement;
 } tSparkPrivate;
 
 /* ******************* helper/misc functions ****************** */
 
-/* Calculate the time value which we can pass to
-    * the aotom fp. it is a mjd time (mjd=modified
-    * julian date). mjd is relative to gmt so theGMTTime
-    * must be in GMT/UTC.
-    */
-void Spark_calcAotomTime(time_t theGMTTime, char *destString)
+/* calculate the time value which we can pass to
+ * the aotom fp. its a mjd time (mjd=modified
+ * julian date). mjd is relativ to gmt so theGMTTime
+ * must be in GMT/UTC.
+ */
+void Spark_setAotomTime(time_t theGMTTime, char* destString)
 {
 	/* from u-boot aotom */
-	struct tm *now_tm;
-	now_tm = localtime(&theGMTTime);
+	struct tm* now_tm;
+	now_tm = localtime (&theGMTTime);
+
+	printf("Set Time (UTC): %02d:%02d:%02d %02d-%02d-%04d\n",
+		now_tm->tm_hour, now_tm->tm_min, now_tm->tm_sec, now_tm->tm_mday, now_tm->tm_mon+1, now_tm->tm_year+1900);
 
 	double mjd = modJulianDate(now_tm);
 	int mjd_int = mjd;
 
-	printf(" mjd %d\n", mjd_int);
-
-	destString[0] = ((mjd_int & 0xff00) >> 8);
-	destString[1] = (mjd_int & 0xff);
+	destString[0] = ( mjd_int >> 8 );
+	destString[1] = ( mjd_int & 0xff );
 	destString[2] = now_tm->tm_hour;
 	destString[3] = now_tm->tm_min;
 	destString[4] = now_tm->tm_sec;
 }
 
-#if 0 //not used anywhere
-unsigned long Spark_getAotomTime(char *aotomTimeString)
+unsigned long Spark_getAotomTime(char* aotomTimeString)
 {
-	unsigned int  mjd   = ((aotomTimeString[1] & 0xff) * 256) + (aotomTimeString[2] & 0xff);
-	unsigned long epoch = ((mjd - 40587) * 86400); //01-01-1970
-	unsigned int  hour  = aotomTimeString[3] & 0xff;
-	unsigned int  min   = aotomTimeString[4] & 0xff;
-	unsigned int  sec   = aotomTimeString[5] & 0xff;
-	epoch += (hour * 3600 + min * 60 + sec);
-//	printf("MJD = %d epoch = %ld, time = %02d:%02d:%02d\n", mjd, epoch, hour, min, sec);
+	unsigned int 	mjd 	= ((aotomTimeString[1] & 0xFF) * 256) + (aotomTimeString[2] & 0xFF);
+	unsigned long 	epoch 	= ((mjd - 40587)*86400);
+
+	unsigned int 	hour 	= aotomTimeString[3] & 0xFF;
+	unsigned int 	min 	= aotomTimeString[4] & 0xFF;
+	unsigned int 	sec 	= aotomTimeString[5] & 0xFF;
+
+	epoch += ( hour * 3600 + min * 60 + sec );
+
+	printf( "MJD = %d epoch = %ld, time = %02d:%02d:%02d\n", mjd,
+		epoch, hour, min, sec );
+
 	return epoch;
 }
-#endif
+
 /* ******************* driver functions ****************** */
 
-static int Spark_init(Context_t *context)
+static int Spark_init(Context_t* context)
 {
-	tSparkPrivate *private = malloc(sizeof(tSparkPrivate));
-	int vFd;
-	int t_mode;
-	unsigned char strVersion[20];
-	const char *dp_type[9] = { "Unknown", "VFD", "LCD", "DVFD", "LED", "?", "?", "?", "LBD" };
-	const char *tm_type[2] = { "off", "on" };
-
-	vFd = open(cVFD_DEVICE, O_RDWR);
-	if (vFd < 0)
-	{
-		fprintf(stderr, "Cannot open %s\n", cVFD_DEVICE);
-		perror("");
-	}
+    tSparkPrivate* private = malloc(sizeof(tSparkPrivate));
+    int vFd;
 
-	((Model_t *)context->m)->private = private;
-	memset(private, 0, sizeof(tSparkPrivate));
-	checkConfig(&private->display, &private->display_custom, &private->timeFormat, &private->wakeupDecrement);
-
-	if (ioctl(vFd, VFDGETVERSION, &strVersion) < 0) // get version info (1x u32 4x u8)
-	{
-		perror("Get version info");
-		return -1;
-	}
-	if (strVersion[0] != '\0')  /* if the version info is OK */
-	{
-		fp_type = strVersion[4];
-	}
-	else
-	{
-		fprintf(stderr, "Error reading version from fp\n");
-	}
+    printf("%s\n", __func__);
 
-	if (ioctl(vFd, VFDGETDISPLAYTIME, &t_mode) < 0)
-	{
-		time_mode = 1; //if no support from aotom, assume clock on
-	}
-	else
-	{
-		time_mode = t_mode;
-	}
-	if (disp)
-	{
-		printf("FP type is   : %s", dp_type[fp_type]);
-		if (fp_type == 3)
-		{
-			printf(", time mode %s\n\n", tm_type[time_mode]);
-		}
-		else
-		{
-			printf("\n\n");
-		}
+    vFd = open(cVFD_DEVICE, O_RDWR);
 
-	}
-	return vFd;
-}
+    if (vFd < 0)
+    {
+       fprintf(stderr, "cannot open %s\n", cVFD_DEVICE);
+       perror("");
+    }
 
-static int Spark_usage(Context_t *context, char *prg_name, char *cmd_name)
-{
-	int i;
+    ((Model_t*)context->m)->private = private;
+    memset(private, 0, sizeof(tSparkPrivate));
 
-	fprintf(stderr, "Usage:\n\n");
-	fprintf(stderr, "%s argument [optarg1] [optarg2]\n", prg_name);
+    checkConfig(&private->display, &private->display_custom, &private->timeFormat, &private->wakeupDecrement);
 
-	for (i = 0; ; i++)
-	{
-		if (vHArgs[i].arg == NULL)
-		{
-			break;
-		}
-		if ((cmd_name == NULL) || (strcmp(cmd_name, vHArgs[i].arg) == 0) || (strstr(vHArgs[i].arg_long, cmd_name) != NULL))
-		{
-			fprintf(stderr, "%s   %s   %s\n", vHArgs[i].arg, vHArgs[i].arg_long, vHArgs[i].arg_description);
-		}
-	}
-	return 0;
+    return vFd;
 }
 
-static int Spark_setTimer(Context_t *context, time_t *timerTime)
+static int Spark_usage(Context_t* context, char* prg_name)
 {
-	//-e command, rewritten, tested on Spark7162
-	struct aotom_ioctl_data vData;
-	time_t curTime;
-	time_t iTime;
-	time_t wakeupTime;
-	struct tm *ts;
-	struct tm *tss;
-	unsigned long diff;
-	int sday, smonth, syear;
-
-	time(&curTime);  //get system time (UTC)
-	tss = localtime(&curTime); //save it for the date
-	sday = tss->tm_mday;
-	smonth = tss->tm_mon + 1;
-	syear = tss->tm_year + 1900;
-	printf("Current system time: %02d:%02d:%02d %02d-%02d-%04d\n", tss->tm_hour, tss->tm_min, tss->tm_sec, tss->tm_mday, tss->tm_mon + 1, tss->tm_year + 1900);
-	if (timerTime == NULL) // -e no argument = shutdown on next e2/neutrino timer
-	{
-		wakeupTime = read_timers_utc(curTime); //get current 1st timer
-	}
-	else
-	{
-		wakeupTime = *timerTime; //get specified time
-	}
-	if ((wakeupTime == LONG_MAX) || (wakeupTime == -1)) // if no timers set
-	{
-		return 0;
-	}
-	else
-	{
-		/* get front controller time */
-		if (ioctl(context->fd, VFDGETTIME, &iTime) < 0)
-		{
-			perror("Get current fp time");
-			return -1;
-		}
-		/* difference from now to wake up */
-		diff = (unsigned long int) wakeupTime - curTime;
-		if (iTime != '\0')
-		{
-			/* use current front controller time */
-			curTime = iTime;
-			ts = gmtime(&curTime);
-			printf("Current fp");
-		}
-		else
-		{
-			printf("Error reading current fp time... assuming local system time\n");
-			ts = localtime(&curTime);
-			printf("Current system");
-		}
-		wakeupTime = curTime + diff;
-		printf(" time: %02d:%02d:%02d %02d-%02d-%04d\n", ts->tm_hour, ts->tm_min, ts->tm_sec, sday, smonth, syear);
-		if (curTime > wakeupTime)
-		{
-			printf("Wake up time in the past!\n");
-			return 0;
-		}
-		ts = gmtime(&wakeupTime);
-		printf("Wake up time: %02d:%02d:%02d", ts->tm_hour, ts->tm_min, ts->tm_sec);
-//		if (diff > 86399)
-		if ((tss->tm_mday == ts->tm_mday)
-		&& (tss->tm_mon == ts->tm_mon)
-		&& (tss->tm_year == ts->tm_year)) //today
-		{
-			printf(" (today)\n");
-		}
-		else
-		{
-			printf("\non          : %02d-%02d-%04d\n", sday, smonth, syear);
-		}
-//		if (tss->tm_mday > 1)
-//		{
-//			printf(" in %d day(s)", tss->tm_mday - 1);
-//		}
-//		if (tss->tm_mon != 0)
-//		{
-//			printf(", %d month(s)", tss->tm_mon);
-//		}
-//		if (tss->tm_year != 70)
-//		{
-//			printf(", %d year(s)", tss->tm_year - 70);
-//		}
-//		printf("\n");
-		Spark_calcAotomTime(wakeupTime, vData.u.standby.time);
-		if (ioctl(context->fd, VFDSTANDBY, &wakeupTime) < 0)
-		{
-			perror("Shut down until wake up time");
-			return -1;
-		}
-	}
-	return 0;
+   fprintf(stderr, "%s: not implemented\n", __func__);
+   return -1;
 }
 
-static int Spark_shutdown(Context_t *context, time_t *shutdownTimeGMT)
+static int Spark_setTime(Context_t* context, time_t* theGMTTime)
 {
-	//-d command, partially rewritten
-	struct aotom_ioctl_data vData;
-	time_t curTime;
-	time_t wakeupTime;
-	struct tm *ts;
-
-	/* shutdown immediately */
-	if (*shutdownTimeGMT == -1)
-	{
-		if (ioctl(context->fd, VFDPOWEROFF, &vData) < 0)
-		{
-			perror("Shut down immediately");
-			return -1;
-		}
-		return 0;
-	}
-	/* shutdown at given time */
-	wakeupTime = *shutdownTimeGMT;
-	ts = localtime(&wakeupTime);
-	printf("Shut down time: %02d:%02d:%02d %02d-%02d-%04d\n",
-		   ts->tm_hour, ts->tm_min, ts->tm_sec, ts->tm_mday, ts->tm_mon + 1, ts->tm_year + 1900);
-	time(&curTime);
-	ts = localtime(&curTime);
-	if (curTime > *shutdownTimeGMT)
-	{
-		printf("Shut down time in the past!\n");
-		return 0;
-	}
-	while (curTime < *shutdownTimeGMT)
-	{
-		time(&curTime);
-		ts = localtime(&curTime);
-		printf("Current time  : %02d:%02d:%02d %02d-%02d-%04d\r",
-			   ts->tm_hour, ts->tm_min, ts->tm_sec, ts->tm_mday, ts->tm_mon + 1, ts->tm_year + 1900);
-		usleep(20000);
-	}
-	printf("\n\n");
-	/* shut down */
-	if (ioctl(context->fd, VFDPOWEROFF, &vData) < 0)
-	{
-		perror("Shutdown at given time");
-		return -1;
-	}
-	return 0;
-}
+   struct aotom_ioctl_data vData;
 
-static int Spark_reboot(Context_t *context, time_t *rebootTimeGMT)
-{
-	//-r command, partially rewritten
-	// Note: aotom does not have a particular reboot command
-	time_t curTime;
-
-	/* reboot at a given time */
-	if (*rebootTimeGMT != -1)
-	{
-		return (Spark_setTimer(context, rebootTimeGMT));
-	}
-	/* reboot immediately */
-	time(&curTime);
-	*rebootTimeGMT = curTime + 5;
-	return (Spark_setTimer(context, rebootTimeGMT));
-}
-
-static int Spark_getTime(Context_t *context, time_t *theGMTTime)
-{
-	// -g and -gs commands, adapted for spark
-	struct tm *g_tm;
-	time_t iTime;
-
-	/* get front controller time */
-	if (ioctl(context->fd, VFDGETTIME, &iTime) < 0)
-	{
-		perror("Get time");
-		return -1;
-	}
-	/* if we get the fp time */
-	if (iTime != '\0')
-	{
-		/* current frontcontroller time */
-		*theGMTTime = iTime;
-		g_tm = gmtime(&iTime);
-		printf("Frontprocessor time: %02d:%02d:%02d %02d-%02d-%04d\n", g_tm->tm_hour,
-			g_tm->tm_min, g_tm->tm_sec, g_tm->tm_mday, g_tm->tm_mon + 1, g_tm->tm_year + 1900);
-	}
-	else
-	{
-		fprintf(stderr, "Error reading time from frontprocessor\n");
-		*theGMTTime = 0;
-		return -1;
-	}
-	return 1;
-}
+   printf("%s\n", __func__);
 
-static int Spark_getWTime(Context_t *context, time_t *theGMTTime)
-{
-	//-gt command, note: VFDGETWAKEUPTIME not supported by older aotoms
-	time_t iTime;
+   Spark_setAotomTime(*theGMTTime, vData.u.time.time);
 
-	/* front controller wake up time */
-	if (ioctl(context->fd, VFDGETWAKEUPTIME, &iTime) < 0)
-	{
-		perror("Get wakeup time");
-		return -1;
-	}
-	/* if we get the fp time */
-	if (iTime != '\0')
-	{
-		/* current frontcontroller wake up time */
-		*theGMTTime = iTime;
-	}
-	else
-	{
-		fprintf(stderr, "Error reading wake up time from frontprocessor\n");
-		*theGMTTime = 0;
-		return -1;
-	}
-	return 1;
+   if (ioctl(context->fd, VFDSETTIME, &vData) < 0)
+   {
+      perror("settime: ");
+      return -1;
+   }
+   return 0;
 }
 
-static int Spark_setTime(Context_t *context, time_t *theGMTTime)
+static int Spark_getTime(Context_t* context, time_t* theGMTTime)
 {
-	//-s command
-	time_t sTime;
-	struct tm *s_tm;
+   time_t iTime;
+   fprintf(stderr, "waiting on current time from fp ...\n");
 
-	sTime = *theGMTTime;
-	s_tm = localtime(&sTime); //get the time the user put in and the matching GMT offset
+   /* front controller time */
+   if (ioctl(context->fd, VFDGETTIME, &iTime) < 0)
+   {
+      perror("gettime: ");
+      return -1;
+   }
 
-	sTime += s_tm->tm_gmtoff;
-	if (ioctl(context->fd, VFDSETTIME2, &sTime) < 0)
-	{
-		perror("Set time");
-		return -1;
-	}
-	fprintf(stderr, "Frontprocessor time set to: %02d:%02d:%02d %02d-%02d-%04d (local)\n", s_tm->tm_hour,
-		s_tm->tm_min, s_tm->tm_sec, s_tm->tm_mday, s_tm->tm_mon + 1, s_tm->tm_year + 1900);
-	return 1;
-}
-
-static int Spark_setWTime(Context_t *context, time_t *theGMTTime)
-{
-	//-st command
-	struct tm *swtm;
-	time_t iTime;
-	int proc_fs;
-	FILE *proc_fs_file;
-
-	iTime = *theGMTTime;
-	swtm = localtime(&iTime);
-	fprintf(stderr, "Setting wake up time to %02d:%02d:%02d %02d-%02d-%04d\n", swtm->tm_hour,
-		swtm->tm_min, swtm->tm_sec, swtm->tm_mday, swtm->tm_mon + 1, swtm->tm_year + 1900);
-
-	iTime += swtm->tm_gmtoff;
-	if (ioctl(context->fd, VFDSETPOWERONTIME, &iTime) < 0)
-	{
-		perror("Set wake up time");
-		return -1;
-
-		// write UTC offset to /proc/stb/fp/rtc_offset
-		proc_fs_file = fopen(cRTC_OFFSET_FILE, "w");
-		if (proc_fs_file == NULL)
-		{
-			perror("Open rtc_offset");
-			return -1;
-		}
-		proc_fs = fprintf(proc_fs_file, "%d", (int)swtm->tm_gmtoff);
-		if (proc_fs < 0)
-		{
-			perror("Write rtc_offset");
-			return -1;
-		}
-		fclose(proc_fs_file);
-		fprintf(stderr, "/proc/stb/fp/rtc_offset set to: %+d seconds\n", (int)swtm->tm_gmtoff);
-	}
-	return 0;
+   /* if we get the fp time */
+   if (iTime != '\0')
+   {
+      fprintf(stderr, "success reading time from fp\n");
+
+      /* current front controller time */
+      *theGMTTime = iTime;
+   } else
+   {
+      fprintf(stderr, "error reading time from fp\n");
+      *theGMTTime = 0;
+   }
+   return 0;
 }
 
-static int Spark_setSTime(Context_t *context, time_t *theGMTTime)
+static int Spark_setTimer(Context_t* context, time_t* theGMTTime)
 {
-	//-sst command
-	time_t systemTime = time(NULL);
-	struct tm *sst;
-	int proc_fs;
-	FILE *proc_fs_file;
-
-	sst = localtime(&systemTime);
-	if (sst->tm_year == 100)
-	{
-		fprintf(stderr, "Problem: system time not set.\n");
-	}
-	else
-	{
-		systemTime += sst->tm_gmtoff;
-		// set front panel clock to local time
-		if (ioctl(context->fd, VFDSETTIME2, &systemTime) < 0)
-		{
-			perror("Set FP time to system time");
-			return -1;
-		}
-		fprintf(stderr, "Frontprocessor time set to: %02d:%02d:%02d %02d-%02d-%04d\n", sst->tm_hour,
-			 sst->tm_min, sst->tm_sec, sst->tm_mday, sst->tm_mon + 1, sst->tm_year + 1900);
+   struct aotom_ioctl_data vData;
+   time_t                  curTime;
+   time_t                  wakeupTime;
+   struct tm               *ts;
+   tSparkPrivate* private = (tSparkPrivate*)
+        ((Model_t*)context->m)->private;
 
-		// write UTC offset to /proc/stb/fp/rtc_offset
-		proc_fs_file = fopen(cRTC_OFFSET_FILE, "w");
-		if (proc_fs_file == NULL)
-		{
-			perror("Open rtc_offset");
-			return -1;
-		}
-		proc_fs = fprintf(proc_fs_file, "%d", (int)sst->tm_gmtoff);
-		if (proc_fs < 0)
-		{
-			perror("Write rtc_offset");
-			return -1;
-		}
-		fclose(proc_fs_file);
-		fprintf(stderr, "/proc/stb/fp/rtc_offset set to: %+d seconds\n", (int)sst->tm_gmtoff);
-	}
-	return 0;
+   time(&curTime);
+   ts = localtime (&curTime);
+
+   fprintf(stderr, "Current Time: %02d:%02d:%02d %02d-%02d-%04d\n",
+	   ts->tm_hour, ts->tm_min, ts->tm_sec, ts->tm_mday, ts->tm_mon+1, ts->tm_year+1900);
+
+   if (theGMTTime == NULL)
+      wakeupTime = read_timers_utc(curTime);
+   else
+      wakeupTime = *theGMTTime;
+
+   if ((wakeupTime <= 0) || (wakeupTime == LONG_MAX))
+   {
+       /* nothing to do for e2 */
+       fprintf(stderr, "no e2 timer found clearing fp wakeup time ... good bye ...\n");
+
+       vData.u.standby.time[0] = '\0';
+       if (ioctl(context->fd, VFDSTANDBY, &vData) < 0)
+       {
+	  perror("standby: ");
+          return -1;
+       }
+
+   } else
+   {
+      unsigned long diff;
+   	  time_t iTime;
+      fprintf(stderr, "waiting on current time from fp ...\n");
+
+      /* front controller time */
+       if (ioctl(context->fd, VFDGETTIME, &iTime) < 0)
+       {
+	  	  perror("gettime: ");
+          return -1;
+       }
+
+      /* difference from now to wake up */
+      diff = (unsigned long int) wakeupTime - curTime;
+
+      /* if we get the fp time */
+      if (iTime != '\0')
+      {
+         fprintf(stderr, "success reading time from fp\n");
+
+         /* current front controller time */
+		 curTime = iTime;
+      } else
+      {
+          fprintf(stderr, "error reading time ... assuming localtime\n");
+          /* noop current time already set */
+      }
+
+      wakeupTime = curTime + diff;
+
+      Spark_setAotomTime(wakeupTime, vData.u.standby.time);
+
+       if (ioctl(context->fd, VFDSTANDBY, &wakeupTime) < 0)
+       {
+	  perror("standby: ");
+          return -1;
+       }
+   }
+   return 0;
 }
 
-static int Spark_setText(Context_t *context, char *theText)
+static int Spark_getTimer(Context_t* context, time_t* theGMTTime)
 {
-	//-t command
-	char text[cMAXCharsSpark + 1];
-	int disp_size;
-
-	switch (fp_type)
-	{
-		case 3: //DVFD
-		{
-			disp_size = (time_mode ? 10 : 16);
-			break;
-		}
-		case 4: //LED
-		{
-			if (strlen(theText) > 2 //handle period, comma and colon
-			&& (theText[2] == 0x2e || theText[2] == 0x2c || theText[2] == 0x3a))
-			{
-				disp_size = 5;
-			}
-			else
-			{
-				disp_size = 4;
-			}
-			break;
-		}
-		default: //VFD and others
-		{
-			disp_size = 8;
-			break;
-		}
-	}
-	strncpy(text, theText, disp_size);
-	text[disp_size] = 0;
-	write(context->fd, text, strlen(text));
-	return 0;
+   fprintf(stderr, "%s: not implemented\n", __func__);
+   return -1;
 }
 
-static int Spark_setLed(Context_t *context, int which, int on)
+static int Spark_shutdown(Context_t* context, time_t* shutdownTimeGMT)
 {
-	//-l command
-	struct aotom_ioctl_data vData;
+   time_t     curTime;
 
-	if (on < 0 || on > 255)
-	{
-		printf("Illegal LED action %d (valid is 0..255)\n", on);
-		return 0;
-	}
-	vData.u.led.led_nr = which;
-	vData.u.led.on = on;
-	res = (ioctl(context->fd, VFDSETLED, &vData));
-	if (res < 0)
-	{
-		perror("Setled");
-		return -1;
-	}
-	return 0;
+   /* shutdown immediate */
+   if (*shutdownTimeGMT == -1)
+      return (Spark_setTimer(context, NULL));
+
+   while (1)
+   {
+      time(&curTime);
+
+      /*printf("curTime = %d, shutdown %d\n", curTime, *shutdownTimeGMT);*/
+
+      if (curTime >= *shutdownTimeGMT)
+      {
+          /* set most recent e2 timer and bye bye */
+          return (Spark_setTimer(context, NULL));
+      }
+
+      usleep(100000);
+   }
+
+   return -1;
 }
 
-static int Spark_setIcon(Context_t *context, int which, int on)
+static int Spark_reboot(Context_t* context, time_t* rebootTimeGMT)
 {
-	//-i command
-	int first, last;
-	struct aotom_ioctl_data vData;
-
-	if (fp_type == 3)
-	{
-		first = 48;
-		last = 63;
-	}
-	else
-	{
-		first = 1;
-		last = 47;
-	}
-	if ((which < first || which > last) 
-	&& which != 46 //icons present on both VFD and DVFD
-	&& which != 8
-	&& which != 10
-	&& which != 11
-	&& which != 12
-	&& which != 13
-	&& which != 14
-	&& which != 26)
-	{
-		return 0;
-	}
-	vData.u.icon.icon_nr = which;
-	vData.u.icon.on = on;
-	if (ioctl(context->fd, VFDICONDISPLAYONOFF, &vData) < 0)
-	{
-		perror("Set icon");
-		return -1;
-	}
-	return 0;
+   time_t                  curTime;
+   struct aotom_ioctl_data vData;
+
+   while (1)
+   {
+      time(&curTime);
+
+      if (curTime >= *rebootTimeGMT)
+      {
+	 if (ioctl(context->fd, VFDREBOOT, &vData) < 0)
+         {
+	    perror("reboot: ");
+            return -1;
+         }
+      }
+
+      usleep(100000);
+   }
+   return 0;
 }
 
-static int Spark_setBrightness(Context_t *context, int brightness)
+static int Spark_Sleep(Context_t* context, time_t* wakeUpGMT)
 {
-	//-b command
-	struct aotom_ioctl_data vData;
+#if 0
+   time_t     curTime;
+   int        sleep = 1;
+   int        vFd;
+   fd_set     rfds;
+   struct     timeval tv;
+   int        retval;
+   struct tm  *ts;
+   char       output[cMAXCharsVIP2 + 1];
+   tSparkPrivate* private = (tSparkPrivate*)
+        ((Model_t*)context->m)->private;
+   printf("%s\n", __func__);
 
-	if (brightness < 0 || brightness > 7)
-	{
-		printf("Illegal brightness level %d (valid is 0..7)\n", brightness);
-		return 0;
-	}
-	vData.u.brightness.level = brightness;
-	if (ioctl(context->fd, VFDBRIGHTNESS, &vData) < 0)
-	{
-		perror("Set brightness");
-		return -1;
-	}
-	return 0;
+   vFd = open(cRC_DEVICE, O_RDWR);
+
+   if (vFd < 0)
+   {
+      fprintf(stderr, "cannot open %s\n", cRC_DEVICE);
+      perror("");
+      return -1;
+   }
+
+   printf("%s 1\n", __func__);
+
+   while (sleep)
+   {
+      time(&curTime);
+      ts = localtime (&curTime);
+
+      if (curTime >= *wakeUpGMT)
+      {
+         sleep = 0;
+      } else
+      {
+	 FD_ZERO(&rfds);
+	 FD_SET(vFd, &rfds);
+
+	 tv.tv_sec = 0;
+	 tv.tv_usec = 100000;
+
+	 retval = select(vFd + 1, &rfds, NULL, NULL, &tv);
+
+	 if (retval > 0)
+	 {
+            sleep = 0;
+	 }
+      }
+
+      if (private->display)
+      {
+         strftime(output, cMAXCharsVIP2 + 1, private->timeFormat, ts);
+         Spark_setText(context, output);
+      }
+   }
+#endif
+
+   return 0;
 }
 
-static int Spark_setLight(Context_t *context, int on)
+static int Spark_setText(Context_t* context, char* theText)
 {
-	//-L command
-	struct aotom_ioctl_data vData;
-	if (on < 0 || on > 1)
-	{
-		printf("Illegal light value %d (valid is 0 | 1)\n", on);
-		return 0;
-	}
-	vData.u.light.onoff = on;
-	if (ioctl(context->fd, VFDDISPLAYWRITEONOFF, &vData) < 0)
-	{
-		perror("Set light");
-		return -1;
-	}
-	return 0;
+   char vHelp[128];
+
+   strncpy(vHelp, theText, cMAXCharsVIP2);
+   vHelp[cMAXCharsVIP2] = '\0';
+
+   /* printf("%s, %d\n", vHelp, strlen(vHelp));*/
+
+   write(context->fd, vHelp, strlen(vHelp));
+
+   return 0;
 }
 
-static int Spark_setDisplayTime(Context_t *context, int on)
+static int Spark_setLed(Context_t* context, int which, int on)
 {
-	// -dt command
-	time_t systemTime = time(NULL);
-	struct tm *gmt;
-
-	gmt = localtime(&systemTime); //get system time
-
-	if ((gmt->tm_year + 1900) > 2016)
-	{
-		fprintf(stderr, "Option -dt is not supported on this receiver.\n");
-		return -1;
-	}
+   struct aotom_ioctl_data vData;
 
-	fprintf(stderr, "Option -dt is deprecated in this receiver,\nplease use -sst or -s option in future.\n");
+   vData.u.led.led_nr = which;
+   vData.u.led.on = on;
 
-	if (gmt->tm_year == 100)
-	{
-		fprintf(stderr, "Problem: system time not set.\n");
-	}
-	else
-	{
-		fprintf(stderr, "Setting front panel clock to\ncurrent system time: %02d:%02d:%02d %02d-%02d-%04d\n",
-				gmt->tm_hour, gmt->tm_min, gmt->tm_sec, gmt->tm_mday, gmt->tm_mon + 1, gmt->tm_year + 1900);
-		systemTime += gmt->tm_gmtoff;
-		if (ioctl(context->fd, VFDSETTIME2, &systemTime) < 0)
-		{
-			perror("Set FP time to system time");
-			return -1;
-		}
-	}
-	return 0;
+   if (ioctl(context->fd, VFDSETLED, &vData) < 0)
+   {
+      perror("setled: ");
+      return -1;
+   }
+   return 0;
 }
 
-static int Spark_setFan(Context_t *context, int on)
+static int Spark_setIcon (Context_t* context, int which, int on)
 {
-	// -sf command
-	fprintf(stderr, "Set fan: not implemented,\nSparks do not have a fan!\n");
-	return -1;
+   struct aotom_ioctl_data vData;
+
+   vData.u.icon.icon_nr = which;
+   vData.u.icon.on = on;
+
+   if (ioctl(context->fd, VFDICONDISPLAYONOFF, &vData) < 0)
+   {
+      perror("seticon: ");
+      return -1;
+   }
+   return 0;
 }
 
-static int Spark_setRF(Context_t *context, int on)
+static int Spark_setBrightness(Context_t* context, int brightness)
 {
-	// -sr command
-	fprintf(stderr, "Set RF: not implemented,\nSparks do not have an RF modulator!\n");
-	return -1;
+   struct aotom_ioctl_data vData;
+
+   if (brightness < 0 || brightness > 7)
+      return -1;
+
+   vData.u.brightness.level = brightness;
+
+   printf("%d\n", context->fd);
+   if (ioctl(context->fd, VFDBRIGHTNESS, &vData) < 0)
+   {
+      perror("setbrightness: ");
+      return -1;
+   }
+   return 0;
 }
 
-static int Spark_setLEDb(Context_t *context, int brightness)
+static int Spark_setPwrLed(Context_t* context, int brightness)
 {
-	// -lb command
-	fprintf(stderr, "Set LED brightness: not implemented,\nSparks cannot control LED brightness!\n");
+	fprintf(stderr, "%s: not implemented\n", __func__);
 	return -1;
 }
 
-static int Spark_clear(Context_t *context)
+
+static int Spark_setLight(Context_t* context, int on)
 {
-	//-c command
-	struct aotom_ioctl_data vData;
 
-	if (ioctl(context->fd, VFDDISPLAYCLR, &vData) < 0)
-	{
-		perror("Clear");
-		return -1;
-	}
-	if (fp_type == 1 || fp_type == 3)
-	{
-		vData.u.icon.icon_nr = 46;
-		vData.u.icon.on = 0;
-		if (ioctl(context->fd, VFDICONDISPLAYONOFF, &vData) < 0)
-		{
-			perror("Set icon");
-			return -1;
-		}
-	}
-	vData.u.led.led_nr = 0;
-	vData.u.led.on = 0;
-	res = (ioctl(context->fd, VFDSETLED, &vData));
-	if (res < 0)
-	{
-		perror("Setled (red)");
-		return -1;
-	}
-	if (fp_type != 1)
-	{
-		vData.u.led.led_nr = 1;
-		vData.u.led.on = 0;
-		res = (ioctl(context->fd, VFDSETLED, &vData));
-		if (res < 0)
-		{
-			perror("Setled (green)");
-			return -1;
-		}
-	}
-	return 0;
+    if (on)
+       Spark_setBrightness(context, 7);
+    else
+       Spark_setBrightness(context, 0);
+
+    return 0;
 }
 
-static int Spark_getWakeupReason(Context_t *context, eWakeupReason *reason)
+static int Spark_Exit(Context_t* context)
 {
-	//-w command
-	char mode[8];
+   tSparkPrivate* private = (tSparkPrivate*)
+        ((Model_t*)context->m)->private;
 
-	if (ioctl(context->fd, VFDGETSTARTUPSTATE, mode) < 0)
-	{
-		perror("Get wakeup reason");
-		return -1;
-	}
-	if (mode[0] != '\0')  /* if we get the fp wake up reason */
-	{
-		*reason = mode[0] & 0xff; //get first byte
-	}
-	else
-	{
-		fprintf(stderr, "Error reading wakeup mode from frontprocessor\n");
-		*reason = 0;  //echo unknown
-	}
-	return 0;
-}
+    if (context->fd > 0)
+       close(context->fd);
 
-static int Spark_getVersion(Context_t *context, int *version)
-{
-	//-v command
-	unsigned char strVersion[20];
-	const char *CPU_type[3] = { "Unknown", "ATTING48", "ATTING88" };
-	const char *Display_type[9] = { "Unknown", "VFD", "LCD", "DVFD", "LED", "?", "?", "?", "LBD" };
-
-	if (ioctl(context->fd, VFDGETVERSION, &strVersion) < 0) // get version info (1x u32 4x u8)
-	{
-		perror("Get version info");
-		return -1;
-	}
-	if (strVersion[0] != '\0')  /* if the version info is OK */
-	{
-		printf("Front processor version info:\n");
-		printf("FP CPU type is   : %d (%s)\n", strVersion[0], CPU_type[strVersion[0]]);
-		printf("Display type is  : %d (%s)\n", strVersion[4], Display_type[strVersion[4]]);
-		printf("# of keys        : %d\n", strVersion[5]);
-		printf("FP SW version is : %d.%d\n", strVersion[6], strVersion[7]);
-		*version = strVersion[6] * 100 + strVersion[7];
-	}
-	else
-	{
-		fprintf(stderr, "Error reading version from fp\n");
-		*version = -1;
-	}
-	return 0;
+    free(private);
+
+    exit(1);
 }
 
-static int Spark_setTimeMode(Context_t *context, int on)
+static int Spark_Clear(Context_t* context)
 {
-	// -tm command
-	const char *timeMode_type[2] = { "off", "on" };
-	struct aotom_ioctl_data vData;
-
-	if (fp_type == 3)
-	{
-		if (on != 0)
-		{
-			on = 1;
-		}
-		vData.u.display_time.on = on;
-		if (ioctl(context->fd, VFDSETDISPLAYTIME, &vData) < 0)
-		{
-			perror("Set time mode");
-			return -1;
-		}
-		time_mode = on;
-		if (disp)
-		{
-			printf("FP time mode is now %s.\n", timeMode_type[time_mode]);
-		}
-	}
-	else
-	{
-		printf("Set time mode is only supported on DVFD displays.\n");
-	}
-	return 0;
+   struct aotom_ioctl_data vData;
+
+   if (ioctl(context->fd, VFDDISPLAYCLR, &vData) < 0)
+   {
+      perror("clear: ");
+      return -1;
+   }
+	 return 0;
 }
 
-static int Spark_exit(Context_t *context)
+static int Spark_getWakeupReason(Context_t* context, int *reason)
 {
-	tSparkPrivate *private = (tSparkPrivate *)((Model_t *)context->m)->private;
-
-	if (context->fd > 0)
-	{
-		close(context->fd);
+    if (ioctl(context->fd, VFDGETSTARTUPSTATE, reason) < 0)
+    {
+	perror("Spark_getWakeupReason: ");
+    
+	return -1;
+    }
+    
+    return 0;
+}
+
+static int Spark_setDisplayTime(Context_t* context, int on)
+{
+    if (on ==1) {
+	    time_t theGMTTime = time(NULL);
+	    struct tm *gmt;
+	    gmt = localtime(&theGMTTime);
+	    
+	    if (gmt->tm_year == 100) {
+		fprintf(stderr, "RTC Time not set.\n");
+	    } else {
+		fprintf(stderr, "Setting Clock to current time: %02d:%02d:%02d %02d-%02d-%04d\n",
+			gmt->tm_hour, gmt->tm_min, gmt->tm_sec, gmt->tm_mday, gmt->tm_mon+1, gmt->tm_year+1900);
+			
+		theGMTTime += gmt->tm_gmtoff;
+		
+		if (ioctl(context->fd, VFDREBOOT, &theGMTTime) < 0)
+		{
+		    perror("settime: ");
+		    return -1;
+		}
+	     }
+	} else {
+		Spark_Clear(context);
 	}
-	free(private);
-	return 1;
+	return 0;
 }
 
-Model_t Spark_model =
-{
-	.Name             = "Edision/Spark frontpanel control utility",
-	.Type             = Spark,
-	.Init             = Spark_init,
-	.Clear            = Spark_clear,
-	.Usage            = Spark_usage,
-	.SetTime          = Spark_setTime,
-	.SetSTime         = Spark_setSTime,
-	.SetTimer         = Spark_setTimer,
-	.GetTime          = Spark_getTime,
-	.GetWTime         = Spark_getWTime,
-	.SetWTime         = Spark_setWTime,
-	.Shutdown         = Spark_shutdown,
-	.Reboot           = Spark_reboot,
-	.Sleep            = NULL,
-	.SetText          = Spark_setText,
-	.SetLed           = Spark_setLed,
-	.SetIcon          = Spark_setIcon,
-	.SetBrightness    = Spark_setBrightness,
-	.GetWakeupReason  = Spark_getWakeupReason,
-	.SetLight         = Spark_setLight,
-	.SetLedBrightness = Spark_setLEDb,
-	.GetVersion       = Spark_getVersion,
-	.SetRF            = Spark_setRF,
-	.SetFan           = Spark_setFan,
-	.GetWakeupTime    = NULL,
-	.SetDisplayTime   = Spark_setDisplayTime,
-	.SetTimeMode      = Spark_setTimeMode,
-#if defined MODEL_SPECIFIC
-	.ModelSpecific    = NULL,
-#endif
-	.Exit             = Spark_exit
+Model_t Spark_model = {
+	.Name			= "Edision Spark frontpanel control utility",
+	.Type			= Spark,
+	.Init			= Spark_init,
+	.Clear			= Spark_Clear,
+	.Usage			= Spark_usage,
+	.SetTime		= Spark_setTime,
+	.GetTime		= Spark_getTime,
+	.SetTimer		= Spark_setTimer,
+	.GetTimer		= Spark_getTimer,
+	.SetDisplayTime		= Spark_setDisplayTime,
+	.Shutdown		= Spark_shutdown,
+	.Reboot			= Spark_reboot,
+	.Sleep			= Spark_Sleep,
+	.SetText		= Spark_setText,
+	.SetLed			= Spark_setLed,
+	.SetIcon		= Spark_setIcon,
+	.SetBrightness		= Spark_setBrightness,
+	.SetPwrLed		= Spark_setPwrLed,
+	.SetLight		= Spark_setLight,
+	.Exit			= Spark_Exit,
+	.GetWakeupReason	= Spark_getWakeupReason,
+	.private		= NULL,
 };
diff -Naur sh4-apps/tools/fp_control/Spark.h taapat-apps/tools/fp_control/Spark.h
--- sh4-apps/tools/fp_control/Spark.h	2019-02-20 16:00:47.074955573 +0100
+++ taapat-apps/tools/fp_control/Spark.h	2019-02-20 15:59:37.637646158 +0100
@@ -1,107 +1,51 @@
 #ifndef __Spark__
 #define __Spark__
 
-#define VFDGETVERSION     0xc0425af7
-#define VFDSETTIME2       0xc0425afd
-#define VFDGETWAKEUPTIME  0xc0425b03
-#define VFDSETDISPLAYTIME 0xc0425b04 // added by Audioniek (Cuberevo uses 0xc0425b02)
-#define VFDGETDISPLAYTIME 0xc0425b05 /* Spark specific */
-
 /* this setups the mode temporarily (for one ioctl)
  * to the desired mode. currently the "normal" mode
  * is the compatible vfd mode
  */
-struct set_mode_s
-{
+struct set_mode_s {
 	int compat; /* 0 = compatibility mode to vfd driver; 1 = nuvoton mode */
 };
 
-struct set_brightness_s
-{
+struct set_brightness_s {
 	int level;
 };
 
-struct set_icon_s
-{
+struct set_icon_s {
 	int icon_nr;
 	int on;
 };
 
-struct set_led_s
-{
+struct set_led_s {
 	int led_nr;
 	int on;
 };
 
-struct set_light_s
-{
-	int onoff;
-};
-
-struct set_display_time_s
-{
-	int on;
-};
-
 /* time must be given as follows:
  * time[0] & time[1] = mjd ???
  * time[2] = hour
  * time[3] = min
  * time[4] = sec
  */
-struct set_standby_s
-{
+struct set_standby_s {
 	char time[5];
 };
 
-struct set_time_s
-{
+struct set_time_s {
 	char time[5];
 };
 
-struct get_version_s
-{
-	unsigned char CpuType;
-	unsigned char DisplayInfo;
-	unsigned char scankeyNum;
-	unsigned char swMajorVersion;
-	unsigned char swSubVersion;
-};
-
-/* YYMMDDhhmmss */
-struct get_wakeuptime
-{
-	char time[12];
-};
-
-struct set_modelspecific_s
-{
-	long one;
-	long two;
-};
-
-struct get_modelspecific_s
-{
-	long key_nr;
-	long key_data;
-};
-
-struct aotom_ioctl_data
-{
+struct aotom_ioctl_data {
 	union
 	{
 		struct set_icon_s icon;
 		struct set_led_s led;
-		struct set_light_s light;
 		struct set_brightness_s brightness;
-		struct set_display_time_s display_time;
 		struct set_mode_s mode;
 		struct set_standby_s standby;
 		struct set_time_s time;
-		struct get_version_s versionp;
-		struct get_wakeuptime wakeup_time;
-		struct get_modelspecific_s getmodelspecific;
-		struct set_modelspecific_s setmodelspecific;
 	} u;
 };
 
diff -Naur sh4-apps/tools/fp_control/Ufc960.c taapat-apps/tools/fp_control/Ufc960.c
--- sh4-apps/tools/fp_control/Ufc960.c	2019-02-20 16:00:47.074955573 +0100
+++ taapat-apps/tools/fp_control/Ufc960.c	1970-01-01 01:00:00.000000000 +0100
@@ -1,550 +0,0 @@
-/*
- * Ufc960.c
- *
- * (c) 2009 dagobert@teamducktales
- *
- * This program is free software; you can redistribute it and/or modify
- * it under the terms of the GNU General Public License as published by
- * the Free Software Foundation; either version 2 of the License, or
- * (at your option) any later version.
- *
- * This program is distributed in the hope that it will be useful,
- * but WITHOUT ANY WARRANTY; without even the implied warranty of
- * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the
- * GNU General Public License for more details.
- *
- * You should have received a copy of the GNU General Public License
- * along with this program; if not, write to the Free Software
- * Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA 02111-1307 USA
- *
- */
-
-/******************** includes ************************ */
-#include <stdio.h>
-#include <stdlib.h>
-#include <string.h>
-#include <time.h>
-#include <sys/types.h>
-#include <sys/stat.h>
-#include <fcntl.h>
-#include <unistd.h>
-#include <limits.h>
-#include <sys/ioctl.h>
-#include <linux/input.h>
-
-#include "global.h"
-#include "Ufc960.h"
-
-static int setText(Context_t *context, char *theText);
-static int Clear(Context_t *context);
-static int setIcon(Context_t *context, int which, int on);
-
-/* ****************** constants ************************ */
-
-#define cVFD_DEVICE "/dev/vfd"
-#define cEVENT_DEVICE "/dev/input/event0"
-
-#define WAKEUPFILE "/var/wakeup"
-#define WAS_TIMER_WAKEUP "/proc/stb/fp/was_timer_wakeup"
-
-#define cMAXCharsUFC960 16
-
-typedef struct
-{
-	int display;
-	int display_custom;
-	char *timeFormat;
-
-	time_t wakeupTime;
-	int wakeupDecrement;
-} tUFC960Private;
-
-/* ******************* helper/misc functions ****************** */
-
-static void setMode(int fd)
-{
-	struct micom_ioctl_data micom;
-	micom.u.mode.compat = 1;
-	if (ioctl(fd, VFDSETMODE, &micom) < 0)
-	{
-		perror("setMode: ");
-	}
-}
-
-/* Calculate the time value which we can pass to
- * the micom fp. its a mjd time (mjd=modified
- * julian date). mjd is relativ to gmt so theGMTTime
- * must be in GMT/UTC.
- */
-static void setMicomTime(time_t theGMTTime, char* destString)
-{
-	/* from u-boot micom */
-	struct tm *now_tm;
-	now_tm = gmtime(&theGMTTime);
-	printf("Set Time (UTC): %02d:%02d:%02d %02d-%02d-%04d\n",
-		   now_tm->tm_hour, now_tm->tm_min, now_tm->tm_sec, now_tm->tm_mday, now_tm->tm_mon + 1, now_tm->tm_year + 1900);
-	double mjd = modJulianDate(now_tm);
-	int mjd_int = mjd;
-	destString[0] = (mjd_int >> 8);
-	destString[1] = (mjd_int & 0xff);
-	destString[2] = now_tm->tm_hour;
-	destString[3] = now_tm->tm_min;
-	destString[4] = now_tm->tm_sec;
-}
-
-static unsigned long getMicomTime(char *micomTimeString)
-{
-	unsigned int    mjd     = ((micomTimeString[1] & 0xFF) * 256) + (micomTimeString[2] & 0xFF);
-	unsigned long   epoch   = ((mjd - 40587) * 86400);
-	unsigned int    hour    = micomTimeString[3] & 0xFF;
-	unsigned int    min     = micomTimeString[4] & 0xFF;
-	unsigned int    sec     = micomTimeString[5] & 0xFF;
-	epoch += (hour * 3600 + min * 60 + sec);
-	printf("MJD = %d epoch = %ld, time = %02d:%02d:%02d\n", mjd, epoch, hour, min, sec);
-	return epoch;
-}
-
-/* ******************* driver functions ****************** */
-
-static int init(Context_t *context)
-{
-	tUFC960Private *private = malloc(sizeof(tUFC960Private));
-	int vFd;
-	printf("%s\n", __func__);
-	vFd = open(cVFD_DEVICE, O_RDWR);
-	if (vFd < 0)
-	{
-		fprintf(stderr, "cannot open %s\n", cVFD_DEVICE);
-		perror("");
-	}
-	((Model_t *)context->m)->private = private;
-	memset(private, 0, sizeof(tUFC960Private));
-	checkConfig(&private->display, &private->display_custom, &private->timeFormat, &private->wakeupDecrement);
-	return vFd;
-}
-
-static int usage(Context_t *context, char *prg_name, char *cmd_name)
-{
-	fprintf(stderr, "%s: not implemented\n", __func__);
-	return -1;
-}
-
-static int setTime(Context_t *context, time_t *theGMTTime)
-{
-	struct micom_ioctl_data vData;
-//	printf("%s\n", __func__);
-	setMicomTime(*theGMTTime, vData.u.time.time);
-	if (ioctl(context->fd, VFDSETTIME, &vData) < 0)
-	{
-		perror("settime: ");
-		return -1;
-	}
-	return 0;
-}
-
-static int getTime(Context_t *context, time_t *theGMTTime)
-{
-	char fp_time[8];
-	fprintf(stderr, "Waiting on current time from fp...\n");
-	/* front controller time */
-	if (ioctl(context->fd, VFDGETTIME, &fp_time) < 0)
-	{
-		perror("gettime: ");
-		return -1;
-	}
-	/* if we get the fp time */
-	if (fp_time[0] != '\0')
-	{
-		fprintf(stderr, "success reading time from fp\n");
-		/* current front controller time */
-		*theGMTTime = (time_t) getMicomTime(fp_time);
-	}
-	else
-	{
-		fprintf(stderr, "error reading time from fp\n");
-		*theGMTTime = 0;
-	}
-	return 0;
-}
-
-static int setTimer(Context_t *context, time_t *theGMTTime)
-{
-	struct micom_ioctl_data vData;
-	time_t curTime    = 0;
-	time_t curTimeFp  = 0;
-	time_t wakeupTime = 0;
-	struct tm *ts;
-	struct tm *tsFp;
-	struct tm *tsWakeupTime;
-//	printf("%s ->\n", __func__);
-	// Get current Frontpanel time
-	getTime(context, &curTimeFp);
-	tsFp = gmtime(&curTimeFp);
-	fprintf(stderr, "Current Fp Time:     %02d:%02d:%02d %02d-%02d-%04d (UTC)\n",
-			tsFp->tm_hour, tsFp->tm_min, tsFp->tm_sec,
-			tsFp->tm_mday, tsFp->tm_mon + 1, tsFp->tm_year + 1900);
-	// Get current Linux time
-	time(&curTime);
-	ts = gmtime(&curTime);
-	fprintf(stderr, "Current Linux Time:  %02d:%02d:%02d %02d-%02d-%04d (UTC)\n",
-			ts->tm_hour, ts->tm_min, ts->tm_sec,
-			ts->tm_mday, ts->tm_mon + 1, ts->tm_year + 1900);
-	// Set current Linux time as new current Frontpanel time
-	setTime(context, &curTime);
-	if (theGMTTime == NULL)
-	{
-		wakeupTime = read_timers_utc(curTime);
-	}
-	else
-	{
-		wakeupTime = *theGMTTime;
-	}
-	if ((wakeupTime <= 0) || (wakeupTime == LONG_MAX))
-	{
-		/* clear timer */
-		vData.u.standby.time[0] = '\0';
-	}
-	else
-	{
-		// Print wakeup time
-		tsWakeupTime = gmtime(&wakeupTime);
-		fprintf(stderr, "Planned Wakeup Time: %02d:%02d:%02d %02d-%02d-%04d (UTC)\n",
-				tsWakeupTime->tm_hour, tsWakeupTime->tm_min, tsWakeupTime->tm_sec,
-				tsWakeupTime->tm_mday, tsWakeupTime->tm_mon + 1, tsWakeupTime->tm_year + 1900);
-		setMicomTime(wakeupTime, vData.u.standby.time);
-		fprintf(stderr, "Setting Planned Fp Wakeup Time to = %02X%02X %d %d %d (mtime)\n",
-			vData.u.standby.time[0], vData.u.standby.time[1], vData.u.standby.time[2],
-			vData.u.standby.time[3], vData.u.standby.time[4]);
-	}
-	fprintf(stderr, "Entering DeepStandby. Goodbye...\n");
-	fflush(stdout);
-	fflush(stderr);
-	sleep(2);
-	if (ioctl(context->fd, VFDSTANDBY, &vData) < 0)
-	{
-		perror("standby: ");
-		return -1;
-	}
-	return 0;
-}
-
-static int getWTime(Context_t *context, time_t *theGMTTime)
-{
-	fprintf(stderr, "%s: not implemented\n", __func__);
-	return -1;
-}
-
-static int shutdown(Context_t *context, time_t *shutdownTimeGMT)
-{
-	time_t  curTime;
-	/* shutdown immediately */
-	if (*shutdownTimeGMT == -1)
-	{
-		return (setTimer(context, NULL));
-	}
-	while (1)
-	{
-		time(&curTime);
-		/*printf("curTime = %d, shutdown %d\n", curTime, *shutdownTimeGMT);*/
-		if (curTime >= *shutdownTimeGMT)
-		{
-			/* set most recent e2 timer and bye bye */
-			return (setTimer(context, NULL));
-		}
-		usleep(100000);
-	}
-	return -1;
-}
-
-static int reboot(Context_t *context, time_t *rebootTimeGMT)
-{
-	time_t curTime;
-	struct micom_ioctl_data vData;
-	while (1)
-	{
-		time(&curTime);
-		if (curTime >= *rebootTimeGMT)
-		{
-			if (ioctl(context->fd, VFDREBOOT, &vData) < 0)
-			{
-				perror("reboot: ");
-				return -1;
-			}
-		}
-		usleep(100000);
-	}
-	return 0;
-}
-
-static int Sleep(Context_t *context, time_t *wakeUpGMT)
-{
-	time_t curTime;
-	int sleep = 1;
-	int vFd;
-	fd_set rfds;
-	struct timeval tv;
-	int retval, i, rd;
-	struct tm *ts;
-	char output[cMAXCharsUFC960 + 1];
-	struct input_event ev[64];
-	tUFC960Private *private = (tUFC960Private *)((Model_t *)context->m)->private;
-	printf("%s\n", __func__);
-	vFd = open(cEVENT_DEVICE, O_RDWR);
-	if (vFd < 0)
-	{
-		fprintf(stderr, "Cannot open %s\n", cEVENT_DEVICE);
-		perror("");
-		return -1;
-	}
-//	printf("%s 1\n", __func__);
-	while (sleep)
-	{
-		time(&curTime);
-		ts = localtime(&curTime);
-		if (curTime >= *wakeUpGMT)
-		{
-			sleep = 0;
-		}
-		else
-		{
-			FD_ZERO(&rfds);
-			FD_SET(vFd, &rfds);
-			tv.tv_sec = 0;
-			tv.tv_usec = 100000;
-			retval = select(vFd + 1, &rfds, NULL, NULL, &tv);
-			if (retval > 0)
-			{
-				rd = read(vFd, ev, sizeof(struct input_event) * 64);
-				if (rd < (int) sizeof(struct input_event))
-				{
-					continue;
-				}
-				for (i = 0; i < rd / sizeof(struct input_event); i++)
-				{
-					if (ev[i].type == EV_SYN)
-					{
-					}
-					else if (ev[i].type == EV_MSC && (ev[i].code == MSC_RAW || ev[i].code == MSC_SCAN))
-					{
-					}
-					else
-					{
-						if (ev[i].code == 116)
-						{
-							sleep = 0;
-						}
-					}
-				}
-			}
-		}
-		if (private->display)
-		{
-			strftime(output, cMAXCharsUFC960 + 1, private->timeFormat, ts);
-			setText(context, output);
-		}
-	}
-	return 0;
-}
-
-static int setText(Context_t *context, char *theText)
-{
-	char vHelp[128];
-	strncpy(vHelp, theText, cMAXCharsUFC960);
-	vHelp[cMAXCharsUFC960] = '\0';
-	/* printf("%s, %d\n", vHelp, strlen(vHelp));*/
-	write(context->fd, vHelp, strlen(vHelp));
-	return 0;
-}
-
-static int setLed(Context_t *context, int which, int on)
-{
-	struct micom_ioctl_data vData;
-	vData.u.led.led_nr = which;
-	vData.u.led.on = on;
-	setMode(context->fd);
-	if (ioctl(context->fd, VFDSETLED, &vData) < 0)
-	{
-		perror("setLed: ");
-		return -1;
-	}
-	return 0;
-}
-
-static int setIcon(Context_t *context, int which, int on)
-{
-	struct micom_ioctl_data vData;
-	vData.u.icon.icon_nr = which;
-	vData.u.icon.on = on;
-	setMode(context->fd);
-	if (ioctl(context->fd, VFDICONDISPLAYONOFF, &vData) < 0)
-	{
-		perror("setIcon: ");
-		return -1;
-	}
-	return 0;
-}
-
-static int setBrightness(Context_t *context, int brightness)
-{
-	struct micom_ioctl_data vData;
-	if (brightness < 0 || brightness > 5)
-	{
-		return -1;
-	}
-	vData.u.brightness.level = brightness;
-	printf("%d\n", context->fd);
-	setMode(context->fd);
-	if (ioctl(context->fd, VFDBRIGHTNESS, &vData) < 0)
-	{
-		perror("setBrightness: ");
-		return -1;
-	}
-	return 0;
-}
-
-static int setLight(Context_t *context, int on)
-{
-	if (on)
-	{
-		setBrightness(context, 5);
-	}
-	else
-	{
-		setBrightness(context, 0);
-	}
-	return 0;
-}
-
-#if 0
-/* FIXME: not sure if this really works for ufc960 ->must be checked */
-static int getWakeupReason(Context_t *context, int *reason)
-{
-	char mode[8];
-	fprintf(stderr, "waiting on wakeupmode from fp ...\n");
-	/* front controller time */
-	if (ioctl(context->fd, VFDGETWAKEUPMODE, &mode) < 0)
-	{
-		perror("getWakeupReason: ");
-		return -1;
-	}
-	/* if we get the fp time */
-	if (mode[0] != '\0')
-	{
-		fprintf(stderr, "success reading wakeupdmode from fp\n");
-		*reason = mode[1] && 0xff;
-		printf("reason = 0x%x\n", *reason);
-	}
-	else
-	{
-		fprintf(stderr, "error reading wakeupmode from fp\n");
-		*reason = 0;
-	}
-	return 0;
-}
-#endif
-
-/* FIXME: not sure if this really works for ufc960 ->must be checked */
-static int getVersion(Context_t *context, int *version)
-{
-	char strVersion[8];
-	fprintf(stderr, "Waiting on version from fp ...\n");
-	/* front controller time */
-	if (ioctl(context->fd, VFDGETVERSION, &strVersion) < 0)
-	{
-		perror("getVersion: ");
-		return -1;
-	}
-	/* if we get the version info */
-	if (strVersion[0] != '\0')
-	{
-		fprintf(stderr, "Success reading version from fp\n");
-		*version = strVersion[1] * 10 | strVersion[2];
-		printf("Version = %d\n", *version);
-	}
-	else
-	{
-		fprintf(stderr, "error reading version from fp\n");
-		*version = 0;
-	}
-	return 0;
-}
-
-static int Exit(Context_t *context)
-{
-	tUFC960Private *private = (tUFC960Private *)((Model_t *)context->m)->private;
-	if (context->fd > 0)
-	{
-		close(context->fd);
-	}
-	free(private);
-	exit(1);
-}
-
-static int Clear(Context_t *context)
-{
-	int i;
-	setText(context, "                ");
-	setBrightness(context, 5);
-	for (i = 1; i <= 6 ; i++)
-	{
-		setLed(context, i, 0);
-	}
-	for (i = 1; i <= 16 ; i++)
-	{
-		setIcon(context, i, 0);
-	}
-	return 0;
-}
-
-static int setLedBrightness(Context_t *context, int brightness)
-{
-	struct micom_ioctl_data vData;
-	if (brightness < 0 || brightness > 0xff)
-	{
-		return -1;
-	}
-	vData.u.brightness.level = brightness;
-	setMode(context->fd);
-	printf("%d\n", context->fd);
-	if (ioctl(context->fd, VFDLEDBRIGHTNESS, &vData) < 0)
-	{
-		perror("setLedBrightness: ");
-		return -1;
-	}
-	return 0;
-}
-
-Model_t UFC960_model =
-{
-	.Name             = "Kathrein UFC960 frontpanel control utility",
-	.Type             = Ufc960,
-	.Init             = init,
-	.Clear            = Clear,
-	.Usage            = usage,
-	.SetTime          = setTime,
-	.GetTime          = getTime,
-	.SetTimer         = setTimer,
-	.GetWTime         = getWTime,
-	.SetWTime         = NULL,
-	.Shutdown         = shutdown,
-	.Reboot           = reboot,
-	.Sleep            = Sleep,
-	.SetText          = setText,
-	.SetLed           = setLed,
-	.SetIcon          = setIcon,
-	.SetBrightness    = setBrightness,
-	.GetWakeupReason  = NULL,
-//	.GetWakeupReason  = NULL,getWakeupReason,  //TODO: CHECK IF WORKING
-	.SetLight         = setLight,
-	.SetLedBrightness = setLedBrightness,
-	.GetVersion       = getVersion,
-	.SetRF            = NULL,
-	.SetFan           = NULL,
-	.GetWakeupTime    = NULL,
-	.SetDisplayTime   = NULL,
-	.SetTimeMode      = NULL,
-#if defined MODEL_SPECIFIC
-	.ModelSpecific    = NULL,
-#endif
-	.Exit             = Exit
-};
diff -Naur sh4-apps/tools/fp_control/Ufc960.h taapat-apps/tools/fp_control/Ufc960.h
--- sh4-apps/tools/fp_control/Ufc960.h	2019-02-20 16:00:47.074955573 +0100
+++ taapat-apps/tools/fp_control/Ufc960.h	1970-01-01 01:00:00.000000000 +0100
@@ -1,63 +0,0 @@
-#ifndef __ufc960__
-#define __ufc960__
-
-#define VFDGETVERSION 0xc0425af7
-
-/* this setups the mode temporarily (for one ioctl)
- * to the desired mode. currently the "normal" mode
- * is the compatible vfd mode
- */
-struct set_mode_s
-{
-	int compat; /* 0 = compatibility mode to vfd driver; 1 = micom mode */
-};
-
-struct set_brightness_s
-{
-	int level;
-};
-
-struct set_icon_s
-{
-	int icon_nr;
-	int on;
-};
-
-struct set_led_s
-{
-	int led_nr;
-	int on;
-};
-
-/* time must be given as follows:
- * time[0] & time[1] = mjd ???
- * time[2] = hour
- * time[3] = min
- * time[4] = sec
- */
-struct set_standby_s
-{
-	char time[5];
-};
-
-struct set_time_s
-{
-	char time[5];
-};
-
-
-struct micom_ioctl_data
-{
-	union
-	{
-		struct set_icon_s icon;
-		struct set_led_s led;
-		struct set_brightness_s brightness;
-		struct set_mode_s mode;
-		struct set_standby_s standby;
-		struct set_time_s time;
-	} u;
-};
-
-
-#endif
diff -Naur sh4-apps/tools/fp_control/Ufs910_14W.c taapat-apps/tools/fp_control/Ufs910_14W.c
--- sh4-apps/tools/fp_control/Ufs910_14W.c	2019-02-20 16:00:47.074955573 +0100
+++ taapat-apps/tools/fp_control/Ufs910_14W.c	1970-01-01 01:00:00.000000000 +0100
@@ -1,611 +0,0 @@
-/*
- * Ufs910_14W.c
- *
- * (c) 2009 dagobert@teamducktales
- *
- * This program is free software; you can redistribute it and/or modify
- * it under the terms of the GNU General Public License as published by
- * the Free Software Foundation; either version 2 of the License, or
- * (at your option) any later version.
- *
- * This program is distributed in the hope that it will be useful,
- * but WITHOUT ANY WARRANTY; without even the implied warranty of
- * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the
- * GNU General Public License for more details.
- *
- * You should have received a copy of the GNU General Public License
- * along with this program; if not, write to the Free Software
- * Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA 02111-1307 USA
- *
- */
-
-/******************** includes ************************ */
-#include <stdio.h>
-#include <stdlib.h>
-#include <string.h>
-#include <time.h>
-#include <sys/types.h>
-#include <sys/stat.h>
-#include <fcntl.h>
-#include <unistd.h>
-#include <limits.h>
-#include <sys/ioctl.h>
-#include <termios.h>
-#include <linux/fb.h>
-#include <linux/stmfb.h>
-#include <linux/input.h>
-
-#include "global.h"
-
-static int setText(Context_t *context, char *theText);
-static int setIcon(Context_t *context, int which, int on);
-static int setLed(Context_t *context, int which, int on);
-static int Sleep(Context_t *context, time_t *wakeUpGMT);
-static int setLight(Context_t *context, int on);
-
-/* ****************** constants ************************ */
-//#define cmdReboot "/sbin/reboot" /* does not currently work */
-#define cmdReboot "init 6"
-#define cmdHalt "/sbin/halt"
-
-#define cVFD_DEVICE "/dev/vfd"
-#define cCMDLINE "/proc/cmdline"
-
-#define cMAXCharsUFS910 16
-
-typedef struct
-{
-	int vfd;
-	int fd_green;
-	int fd_red;
-	int fd_yellow;
-
-	int nfs;
-	int display;
-	int display_custom;
-	char *timeFormat;
-
-	time_t wakeupTime;
-	int wakeupDecrement;
-} tUFS910Private;
-
-/* ******************* helper/misc functions ****************** */
-/* donalds helper functions */
-
-/* ----------------------------------------------------- */
-struct termios old_io;
-struct termios new_io;
-
-int destroySerial()
-{
-	printf("%s\n", __func__);
-	int fd = open("/dev/ttyAS0", O_RDWR);
-	if ((tcgetattr(fd, &old_io)) == 0)
-	{
-		new_io = old_io;
-		printf("Setting new flags\n");
-		/* c_iflags ->input flags */
-		new_io.c_iflag &= ~(IMAXBEL | BRKINT | ICRNL);
-		/* c_lflags ->local flags*/
-		new_io.c_lflag &= ~(ECHO | IEXTEN);
-		/* c_oflags ->output flags*/
-		new_io.c_oflag &= ~(ONLCR);
-		/* c_cflags ->constant flags*/
-		new_io.c_cflag = B19200;
-		tcsetattr(fd, TCSANOW, &new_io);
-	}
-	else
-	{
-		printf("Error setting raw mode.\n");
-	}
-	close(fd);
-	return 0;
-}
-
-/* ----------------------------------------------------- */
-void avs_standby(int fd_avs, unsigned int mode)
-{
-	printf("%s %d\n", __func__, mode);
-	if (!mode)
-	{
-		write(fd_avs, "on", 2);
-	}
-	else
-	{
-		write(fd_avs, "off", 3);
-	}
-}
-
-/* ----------------------------------------------------- */
-void net_standby(int mode)
-{
-	printf("%s\n", __func__);
-	if (!mode)
-	{
-		system("/sbin/ifconfig eth0 down");
-	}
-	else
-	{
-		system("/sbin/ifconfig eth0 up");
-	}
-}
-
-/* ----------------------------------------------------- */
-void hdmi_standby(int fd_hdmi, int mode)
-{
-	struct stmfbio_output_configuration outputConfig = {0};
-	printf("%s %d\n", __func__, mode);
-	outputConfig.outputid = 1;
-	if (ioctl(fd_hdmi, STMFBIO_GET_OUTPUT_CONFIG, &outputConfig) < 0)
-	{
-		perror("Getting current output configuration failed");
-	}
-	outputConfig.caps = 0;
-	outputConfig.activate = STMFBIO_ACTIVATE_IMMEDIATE;
-	outputConfig.analogue_config = 0;
-	outputConfig.caps |= STMFBIO_OUTPUT_CAPS_HDMI_CONFIG;
-	if (!mode)
-	{
-		outputConfig.hdmi_config |= STMFBIO_OUTPUT_HDMI_DISABLED;
-	}
-	else
-	{
-		outputConfig.hdmi_config &= ~STMFBIO_OUTPUT_HDMI_DISABLED;
-	}
-	if (outputConfig.caps != STMFBIO_OUTPUT_CAPS_NONE)
-	{
-		if (ioctl(fd_hdmi, STMFBIO_SET_OUTPUT_CONFIG, &outputConfig) < 0)
-		{
-			perror("setting output configuration failed");
-		}
-	}
-}
-
-/* ----------------------------------------------------- */
-int helloSerial()
-{
-	int fd = open("/dev/ttyAS0", O_RDWR);
-	printf("%s\n", __func__);
-	tcsetattr(fd, TCSANOW, &old_io);
-	close(fd);
-	return 0;
-}
-/* ----------------------------------------------------- */
-
-void startPseudoStandby(Context_t *context, tUFS910Private *private)
-{
-	int id;
-	int fd_avs = open("/proc/stb/avs/0/standby", O_RDWR);
-	int fd_hdmi = open("/dev/fb0", O_RDWR);
-	printf("%s\n", __func__);
-	setLed(context, 1, 0);
-	setLed(context, 2, 1);
-	setLed(context, 3, 0);
-	if (private->nfs == 0)
-	{
-		destroySerial();
-		net_standby(0);
-	}
-	avs_standby(fd_avs, 0);
-	hdmi_standby(fd_hdmi, 0);
-	setText(context, "                ");
-	for (id = 0x10; id < 0x20; id++)
-	{
-		setIcon(context, id, 0);
-	}
-	if (private->display == 0)
-	{
-		setLight(context, 0);
-	}
-	close(fd_hdmi);
-	close(fd_avs);
-}
-
-void stopPseudoStandby(Context_t *context, tUFS910Private *private)
-{
-	int id;
-	if (private->display == 0)
-	{
-		setLight(context, 1);
-	}
-	setText(context, "                ");
-	for (id = 0x10; id < 0x20; id++)
-	{
-		setIcon(context, id, 0);
-	}
-	setLed(context, 1, 0);
-	setLed(context, 2, 0);
-	setLed(context, 3, 0);
-	system(cmdReboot);
-	/* deactivated, because box will hang and remote control not longer works */
-#if 0
-	int fd_avs = open("/proc/stb/avs/0/standby", O_RDWR);
-	int fd_hdmi = open("/dev/fb0", O_RDWR);
-	int id;
-	printf("%s\n", __func__);
-	if (private->display == 0)
-	{
-		setLight(context, 1);
-	}
-	setText(context, "                ");
-	for (id = 0x10; id < 0x20; id++)
-	{
-		setIcon(context, id, 0);
-	}
-	hdmi_standby(fd_hdmi, 1);
-	avs_standby(fd_avs, 1);
-	if (private->nfs == 0)
-	{
-		net_standby(1);
-		helloSerial();
-	}
-	setLed(context, 1, 0);
-	setLed(context, 2, 0);
-	setLed(context, 3, 0);
-	close(fd_hdmi);
-	close(fd_avs);
-#endif
-}
-
-/* ******************* driver functions ****************** */
-
-static int init(Context_t *context)
-{
-	char cmdLine[512];
-	int vFd;
-	tUFS910Private *private = malloc(sizeof(tUFS910Private));
-//	printf("%s\n", __func__);
-	((Model_t *)context->m)->private = private;
-	memset(private, 0, sizeof(tUFS910Private));
-	vFd = open(cCMDLINE, O_RDWR);
-	private->nfs = 0;
-	if (read(vFd, cmdLine, 512) > 0)
-	{
-		if (strstr("nfsroot", cmdLine) != NULL)
-		{
-			private->nfs = 1;
-		}
-	}
-	close(vFd);
-	if (private->nfs)
-	{
-		printf("mode = nfs\n");
-	}
-	else
-	{
-		printf("mode = non-nfs\n");
-	}
-	vFd = open(cVFD_DEVICE, O_RDWR);
-	if (vFd < 0)
-	{
-		fprintf(stderr, "Cannot open %s\n", cVFD_DEVICE);
-		perror("");
-	}
-	private->fd_green = open("/sys/class/leds/ufs910:green/brightness", O_WRONLY);
-	private->fd_red = open("/sys/class/leds/ufs910:red/brightness", O_WRONLY);
-	private->fd_yellow = open("/sys/class/leds/ufs910:orange/brightness", O_WRONLY);
-	private->vfd = vFd;
-	checkConfig(&private->display, &private->display_custom, &private->timeFormat, &private->wakeupDecrement);
-	return vFd;
-}
-
-static int usage(Context_t *context, char *prg_name, char *cmd_name)
-{
-	fprintf(stderr, "%s: not implemented\n", __func__);
-	return -1;
-}
-
-static int setTime(Context_t *context, time_t *theGMTTime)
-{
-	fprintf(stderr, "%s: not implemented\n", __func__);
-	return -1;
-}
-
-static int getTime(Context_t *context, time_t *theGMTTime)
-{
-	fprintf(stderr, "%s: not implemented\n", __func__);
-	return -1;
-}
-
-static int setTimer(Context_t *context, time_t *theGMTTime)
-{
-	time_t curTime;
-	struct tm *ts;
-	tUFS910Private *private = (tUFS910Private *)((Model_t *)context->m)->private;
-	printf("%s\n", __func__);
-	time(&curTime);
-	ts = localtime(&curTime);
-	fprintf(stderr, "Current Time: %02d:%02d:%02d %02d-%02d-%04d\n",
-			ts->tm_hour, ts->tm_min, ts->tm_sec, ts->tm_mday, ts->tm_mon + 1, ts->tm_year + 1900);
-	startPseudoStandby(context, private);
-	if (theGMTTime == NULL)
-	{
-		private->wakeupTime = read_timers_utc(curTime);
-	}
-	else
-	{
-		private->wakeupTime = *theGMTTime;
-	}
-	Sleep(context, &private->wakeupTime);
-	stopPseudoStandby(context, private);
-	return 0;
-}
-
-static int getWTime(Context_t *context, time_t *theGMTTime)
-{
-	fprintf(stderr, "%s: not implemented\n", __func__);
-	return -1;
-}
-
-static int shutdown(Context_t *context, time_t *shutdownTimeGMT)
-{
-	time_t curTime;
-	printf("%s\n", __func__);
-	/* shutdown immediately */
-	if (*shutdownTimeGMT == -1)
-	{
-		system(cmdHalt);
-	}
-	while (1)
-	{
-		time(&curTime);
-		if (curTime >= *shutdownTimeGMT)
-		{
-			system(cmdHalt);
-		}
-		usleep(100000);
-	}
-	return -1;
-}
-
-static int reboot(Context_t *context, time_t *rebootTimeGMT)
-{
-	time_t curTime;
-//	printf("%s\n", __func__);
-	while (1)
-	{
-		time(&curTime);
-		if (curTime >= *rebootTimeGMT)
-		{
-			system(cmdReboot);
-		}
-		usleep(100000);
-	}
-	return 0;
-}
-
-static int Sleep(Context_t *context, time_t *wakeUpGMT)
-{
-	time_t curTime;
-	int sleep = 1;
-	int vFd;
-	fd_set rfds;
-	struct timeval tv;
-	int retval, len, i;
-	struct tm *ts;
-	char output[cMAXCharsUFS910 + 1];
-	struct input_event data[64];
-	tUFS910Private *private = (tUFS910Private *)((Model_t *)context->m)->private;
-	printf("%s\n", __func__);
-	output[cMAXCharsUFS910] = '\0';
-	vFd = open("/dev/input/event0", O_RDONLY);
-	if (vFd < 0)
-	{
-		perror("event0");
-		return -1;
-	}
-	while (sleep)
-	{
-		time(&curTime);
-		ts = localtime(&curTime);
-		if (curTime >= *wakeUpGMT)
-		{
-			sleep = 0;
-		}
-		else
-		{
-			FD_ZERO(&rfds);
-			FD_SET(vFd, &rfds);
-			tv.tv_sec = 0;
-			tv.tv_usec = 100000;
-			retval = select(vFd + 1, &rfds, NULL, NULL, &tv);
-			if (retval > 0)
-			{
-				len = read(vFd, data, sizeof(struct input_event) * 64);
-				for (i = 0; i < len / sizeof(struct input_event); i++)
-				{
-					if (data[i].type == EV_SYN)
-					{
-						/* noop */
-					}
-					else if (data[i].type == EV_MSC && (data[i].code == MSC_RAW || data[i].code == MSC_SCAN))
-					{
-						/* noop */
-					}
-					else
-					{
-						if (data[i].code == 116)
-						{
-							sleep = 0;
-						}
-					}
-				}
-			}
-		}
-		if (private->display)
-		{
-			strftime(output, cMAXCharsUFS910 + 1, private->timeFormat, ts);
-			write(private->vfd, &output, sizeof(output));
-		}
-	}
-	return 0;
-}
-
-static int setText(Context_t *context, char *theText)
-{
-	struct vfd_ioctl_data data;
-	tUFS910Private *private = (tUFS910Private *)((Model_t *)context->m)->private;
-	memset(data.data, ' ', 63);
-	memcpy(data.data, theText, strlen(theText));
-	data.start = 0;
-	data.length = strlen(theText);
-	if (ioctl(private->vfd, VFDDISPLAYCHARS, &data) < 0)
-	{
-		perror("setText: ");
-		return -1;
-	}
-	return 0;
-}
-
-static int setLed(Context_t *context, int which, int on)
-{
-	tUFS910Private *private = (tUFS910Private *)((Model_t *)context->m)->private;
-	printf("%s\n", __func__);
-	if (which == 1)
-	{
-		write(private->fd_green, on == 0 ? "0" : "1", 1);
-	}
-	else if (which == 2)
-	{
-		write(private->fd_red, on == 0 ? "0" : "1", 1);
-	}
-	else if (which == 3)
-	{
-		write(private->fd_yellow, on == 0 ? "0" : "1", 1);
-	}
-	else
-	{
-		return -1;
-	}
-	return 0;
-}
-
-static int setIcon(Context_t *context, int which, int on)
-{
-	struct vfd_ioctl_data data;
-	tUFS910Private *private = (tUFS910Private *)((Model_t *)context->m)->private;
-	printf("%s\n", __func__);
-	memset(data.data, ' ', 63);
-	data.start = 0;
-	data.length = 5;
-	data.data[0] = which & 0x0f;
-	data.data[4] = on;
-	if (ioctl(private->vfd, VFDICONDISPLAYONOFF, &data) < 0)
-	{
-		perror("setIcon: ");
-		return -1;
-	}
-	return 0;
-}
-
-static int setBrightness(Context_t *context, int brightness)
-{
-	struct vfd_ioctl_data data;
-	tUFS910Private *private = (tUFS910Private *)((Model_t *)context->m)->private;
-	printf("%s\n", __func__);
-	if (brightness < 0 || brightness > 7)
-	{
-		return -1;
-	}
-	memset(data.data, ' ', 63);
-	data.start = brightness & 0x07;
-	data.length = 0;
-	if (ioctl(private->vfd, VFDBRIGHTNESS, &data) < 0)
-	{
-		perror("setBrightness: ");
-		return -1;
-	}
-	return 0;
-}
-
-static int setLight(Context_t *context, int on)
-{
-	struct vfd_ioctl_data data;
-	tUFS910Private *private = (tUFS910Private *)((Model_t *)context->m)->private;
-	printf("%s\n", __func__);
-	memset(&data, 0, sizeof(struct vfd_ioctl_data));
-	if (on)
-	{
-		data.start = 0x01;
-	}
-	else
-	{
-		data.start = 0x00;
-	}
-	data.length = 0;
-	if (ioctl(private->vfd, VFDDISPLAYWRITEONOFF, &data) < 0)
-	{
-		perror("setLight: ");
-		return -1;
-	}
-	return 0;
-}
-
-static int Exit(Context_t *context)
-{
-	tUFS910Private *private = (tUFS910Private *)((Model_t *)context->m)->private;
-	printf("%s\n", __func__);
-	if (context->fd > 0)
-	{
-		close(context->fd);
-	}
-	if (private->vfd > 0)
-	{
-		close(private->vfd);
-	}
-	close(private->fd_green);
-	close(private->fd_red);
-	close(private->fd_yellow);
-	free(private);
-	return 1;
-}
-
-static int Clear(Context_t *context)
-{
-	int i;
-	setText(context, "                ");
-	setBrightness(context, 7);
-	for (i = 1; i <= 3 ; i++)
-	{
-		setLed(context, i, 0);
-	}
-	for (i = 1; i <= 16 ; i++)
-	{
-		setIcon(context, i, 0);
-	}
-	return 0;
-}
-
-Model_t Ufs910_14W_model =
-{
-	.Name             = "Kathrein UFS910 14W frontpanel control utility",
-	.Type             = Ufs910_14W,
-	.Init             = init,
-	.Clear            = Clear,
-	.Usage            = usage,
-	.SetTime          = setTime,
-	.GetTime          = getTime,
-	.SetTimer         = setTimer,
-	.GetWTime         = getWTime,
-	.SetWTime         = NULL,
-	.Shutdown         = shutdown,
-	.Reboot           = reboot,
-	.Sleep            = Sleep,
-	.SetText          = setText,
-	.SetLed           = setLed,
-	.SetIcon          = setIcon,
-	.SetBrightness    = setBrightness,
-	.GetWakeupReason  = NULL,
-	.SetLight         = setLight,
-	.SetLedBrightness = NULL,
-	.GetVersion       = NULL,
-	.SetRF            = NULL,
-	.SetFan           = NULL,
-	.GetWakeupTime    = NULL,
-	.SetDisplayTime   = NULL,
-	.SetTimeMode      = NULL,
-#if defined MODEL_SPECIFIC
-	.ModelSpecific    = NULL,
-#endif
-	.Exit             = Exit
-};
diff -Naur sh4-apps/tools/fp_control/Ufs910_1W.c taapat-apps/tools/fp_control/Ufs910_1W.c
--- sh4-apps/tools/fp_control/Ufs910_1W.c	2019-02-20 16:00:47.074955573 +0100
+++ taapat-apps/tools/fp_control/Ufs910_1W.c	1970-01-01 01:00:00.000000000 +0100
@@ -1,445 +0,0 @@
-/*
- * Ufs910_1W.c
- *
- * (c) 2009 dagobert@teamducktales
- *
- * This program is free software; you can redistribute it and/or modify
- * it under the terms of the GNU General Public License as published by
- * the Free Software Foundation; either version 2 of the License, or
- * (at your option) any later version.
- *
- * This program is distributed in the hope that it will be useful,
- * but WITHOUT ANY WARRANTY; without even the implied warranty of
- * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the
- * GNU General Public License for more details.
- *
- * You should have received a copy of the GNU General Public License
- * along with this program; if not, write to the Free Software
- * Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA 02111-1307 USA
- *
- */
-
-/******************** includes ************************ */
-#include <stdio.h>
-#include <stdlib.h>
-#include <string.h>
-#include <time.h>
-#include <sys/types.h>
-#include <sys/stat.h>
-#include <fcntl.h>
-#include <unistd.h>
-#include <termios.h>
-#include <limits.h>
-#include <sys/ioctl.h>
-
-#include "global.h"
-
-static int setText(Context_t *context, char *theText);
-
-/******************** constants ************************ */
-#define cTTY_DEVICE "/dev/ttyAS1"
-#define cVFD_DEVICE "/dev/vfd"
-
-#define cMAXCharsUFS910 16
-
-//#define cmdReboot "/sbin/reboot" /* does not currently work */
-#define cmdReboot "init 6"
-
-typedef struct
-{
-	int vfd;
-
-	int display;
-	int display_custom;
-	char *timeFormat;
-	time_t wakeupTime;
-	int wakeupDecrement;
-} tUFS910Private;
-
-typedef struct
-{
-	char *ledOn;
-	char *ledOff;
-} tUFS910Leds;
-
-#define cGreen  1
-#define cRed    2
-#define cYellow 3
-
-tUFS910Leds led[] =
-{
-	{/* cGreen ,*/ "1", "A" },
-	{/* cRed   ,*/ "2", "B" },
-	{/* cYellow,*/ "3", "C" }
-};
-
-/* ******************* helper/misc functions ****************** */
-
-static int setTemFlagsKathrein(int fd)
-{
-	struct termios old_io;
-	struct termios new_io;
-	if ((tcgetattr(fd, &old_io)) == 0)
-	{
-		new_io = old_io;
-		printf("Setting new flags\n");
-		/* c_iflags ->input flags */
-		new_io.c_iflag &= ~(IMAXBEL | BRKINT | ICRNL);
-		/* c_lflags ->local flags*/
-		new_io.c_lflag &= ~(ECHO | IEXTEN);
-		/* c_oflags ->output flags*/
-		new_io.c_oflag &= ~(ONLCR);
-		/* c_cflags ->constant flags*/
-		new_io.c_cflag = B19200;
-		tcsetattr(fd, TCSANOW, &new_io);
-	}
-	else
-	{
-		printf("Error setting raw mode.\n");
-	}
-	return 0;
-}
-
-/* ******************* driver functions ****************** */
-
-static int init(Context_t *context)
-{
-	int vFd;
-	tUFS910Private *private = malloc(sizeof(tUFS910Private));
-	((Model_t *)context->m)->private = private;
-	memset(private, 0, sizeof(tUFS910Private));
-	vFd = open(cTTY_DEVICE, O_RDWR);
-	if (vFd < 0)
-	{
-		fprintf(stderr, "cannot open %s\n", cTTY_DEVICE);
-		perror("");
-	}
-	setTemFlagsKathrein(vFd);
-	private->vfd = open(cVFD_DEVICE, O_RDWR);
-	if (private->vfd < 0)
-	{
-		fprintf(stderr, "Cannot open %s\n", cVFD_DEVICE);
-		perror("");
-	}
-	checkConfig(&private->display, &private->display_custom, &private->timeFormat, &private->wakeupDecrement);
-	return vFd;
-}
-
-static int usage(Context_t *context, char *prg_name, char *cmd_name)
-{
-	fprintf(stderr, "%s: not implemented\n", __func__);
-	return -1;
-}
-
-static int setTime(Context_t *context, time_t *theGMTTime)
-{
-	fprintf(stderr, "%s: not implemented\n", __func__);
-	return -1;
-}
-
-static int getTime(Context_t *context, time_t *theGMTTime)
-{
-	fprintf(stderr, "%s: not implemented\n", __func__);
-	return -1;
-}
-
-static int setTimer(Context_t *context, time_t *theGMTTime)
-{
-	time_t curTime;
-	time_t wakeupTime;
-	struct tm *ts;
-	unsigned long int diffTm;
-	unsigned char uTime0, uTime1, uTime2, uTime3;
-	char cTime[6];
-	time(&curTime);
-	ts = localtime(&curTime);
-	fprintf(stderr, "Current Time: %02d:%02d:%02d %02d-%02d-%04d\n",
-			ts->tm_hour, ts->tm_min, ts->tm_sec, ts->tm_mday, ts->tm_mon + 1, ts->tm_year + 1900);
-	if (theGMTTime == NULL)
-	{
-		wakeupTime = read_timers_utc(curTime);
-	}
-	else
-	{
-		wakeupTime = *theGMTTime;
-	}
-	if ((wakeupTime <= 0) || (wakeupTime == LONG_MAX))
-	{
-		wakeupTime = read_fake_timer_utc(curTime);
-	}
-	if (curTime > wakeupTime)
-	{
-		printf("System time wrong -> Reboot\n");
-		diffTm = 5;
-	}
-	else
-	{
-		diffTm = (unsigned long int) wakeupTime - curTime;
-	}
-	printf("Time difference: %ld\n", diffTm);
-	uTime0 = diffTm % 256;
-	uTime1 = (diffTm / 256) % 256;
-	uTime2 = ((diffTm / 256) / 256) % 256;
-	uTime3 = (((diffTm / 256) / 256) / 256) % 256;
-	printf("%03d %03d %03d %03d\n", uTime3, uTime2, uTime1, uTime0);
-	cTime[0] = 'Q';
-	cTime[1] = uTime3;
-	cTime[2] = uTime2;
-	cTime[3] = uTime1;
-	cTime[4] = uTime0;
-	printf("Goodbye\n");
-	sleep(1);
-	/* SWITCH ON RED LED */
-	write(context->fd, "2" ,1);
-	usleep(1000);
-	write(context->fd, &cTime[0], 1);
-	usleep(1000);
-	write(context->fd, &cTime[1], 1);
-	usleep(1000);
-	write(context->fd, &cTime[2], 1);
-	usleep(1000);
-	write(context->fd, &cTime[3], 1);
-	usleep(1000);
-	write(context->fd, &cTime[4], 1);
-	return 0;
-}
-
-static int getWTime(Context_t *context, time_t *theGMTTime)
-{
-	fprintf(stderr, "%s: not implemented\n", __func__);
-	return -1;
-}
-
-static int shutdown(Context_t *context, time_t *shutdownTimeGMT)
-{
-	time_t curTime;
-	/* shutdown immediately */
-	if (*shutdownTimeGMT == -1)
-	{
-		return (setTimer(context, NULL));
-	}
-	while (1)
-	{
-		time(&curTime);
-		if (curTime >= *shutdownTimeGMT)
-		{
-			/* set most recent e2 timer and bye bye */
- 			return (setTimer(context, NULL));
-		}
-		usleep(100000);
-	}
-	return -1;
-}
-
-static int reboot(Context_t *context, time_t *rebootTimeGMT)
-{
-	time_t curTime;
-	while (1)
-	{
-		time(&curTime);
-		if (curTime >= *rebootTimeGMT)
-		{
-			system(cmdReboot);
-		}
-		usleep(100000);
-	}
-	return 0;
-}
-
-static int Sleep(Context_t *context, time_t *wakeUpGMT)
-{
-	time_t curTime;
-	int sleep = 1;
-	fd_set rfds;
-	struct timeval tv;
-	int retval;
-	struct tm *ts;
-	char output[cMAXCharsUFS910 + 1];
-	tUFS910Private *private = (tUFS910Private *)((Model_t *)context->m)->private;
-	while (sleep)
-	{
-		time(&curTime);
-		ts = localtime(&curTime);
-		if (curTime >= *wakeUpGMT)
-		{
-			sleep = 0;
-		}
-		else
-		{
-			FD_ZERO(&rfds);
-			FD_SET(context->fd, &rfds);
-			tv.tv_sec = 0;
-			tv.tv_usec = 100000;
-			retval = select(context->fd + 1, &rfds, NULL, NULL, &tv);
-			if (retval > 0)
-			{
-				sleep = 0;
-			} 
-		}
-		if (private->display)
-		{
-			strftime(output, cMAXCharsUFS910 + 1, private->timeFormat, ts);
-			setText(context, output);
-		}
-	}
-	return 0;
-}
-
-static int setText(Context_t *context, char *theText)
-{
-	struct vfd_ioctl_data data;
-	tUFS910Private *private = (tUFS910Private *)
-							  ((Model_t *)context->m)->private;
-	memset(data.data, ' ', 63);
-	memcpy(data.data, theText, strlen(theText));
-	data.start = 0;
-	data.length = strlen(theText);
-	if (ioctl(private->vfd, VFDDISPLAYCHARS, &data) < 0)
-	{
-		perror("setText: ");
-		return -1;
-	}
-	return 0;
-}
-
-static int setLed(Context_t *context, int which, int on)
-{
-	if (which < cGreen || which > cYellow)
-	{
-		return -1;
-	}
-	if (on)
-	{
-		write(context->fd, led[which - 1].ledOn, 1);
-	}
-	else
-	{
-		write(context->fd, led[which - 1].ledOff, 1);
-	}
-	return 0;
-}
-	
-static int setIcon (Context_t *context, int which, int on)
-{
-	struct vfd_ioctl_data data;
-	tUFS910Private *private = (tUFS910Private *)((Model_t *)context->m)->private;
-	memset(data.data, ' ', 63);
-	data.start = 0;
-	data.length = 5;
-	data.data[0] = which & 0x0f;
-	data.data[4] = on;
-	if (ioctl(private->vfd, VFDICONDISPLAYONOFF, &data) < 0)
-	{
-		perror("setIcon: ");
-		return -1;
-	}
-	return 0;
-}
-
-static int setBrightness(Context_t *context, int brightness)
-{
-	struct vfd_ioctl_data data;
-	tUFS910Private *private = (tUFS910Private *)((Model_t *)context->m)->private;
-	if (brightness < 0 || brightness > 7)
-	{
-		return -1;
-	}
-	memset(data.data, ' ', 63);
-	data.start = brightness & 0x07;
-	data.length = 0;
-	if (ioctl(private->vfd, VFDBRIGHTNESS, &data) < 0)
-	{
-		perror("setBrightness: ");
-		return -1;
-	}
-	return 0;
-}
-
-static int setLight(Context_t *context, int on)
-{
-	struct vfd_ioctl_data data;
-	tUFS910Private *private = (tUFS910Private *)((Model_t *)context->m)->private;
-	memset(&data, 0, sizeof(struct vfd_ioctl_data));
-	if (on)
-	{
-		data.start = 0x01;
-	}
-	else
-	{
-		data.start = 0x00;
-	}
-	data.length = 0;
-	if (ioctl(private->vfd, VFDDISPLAYWRITEONOFF, &data) < 0)
-	{
-		perror("setLight: ");
-		return -1;
-	}
-	return 0;
-}
-
-static int Exit(Context_t *context)
-{
-	tUFS910Private *private = (tUFS910Private *)
-							  ((Model_t *)context->m)->private;
-	if (private->vfd > 0)
-	{
-		close(private->vfd);
-	}
-	if (context->fd > 0)
-	{
-		close(context->fd);
-	}
-	free(private);
-	return 1;
-}
-
-static int Clear(Context_t *context)
-{
-	int i;
-	setText(context, "                ");
-	setBrightness(context, 7);
-	for (i = 1; i <= 3 ; i++)
-	{
-		setLed(context, i, 0);
-	}
-	for (i = 1; i <= 16 ; i++)
-	{
-		setIcon(context, i, 0);
-	}
-	return 0;
-}
-
-Model_t Ufs910_1W_model =
-{
-	.Name             = "Kathrein UFS910 1W frontpanel control utility",
-	.Type             = Ufs910_1W,
-	.Init             = init,
-	.Clear            = Clear,
-	.Usage            = usage,
-	.SetTime          = setTime,
-	.GetTime          = getTime,
-	.SetTimer         = setTimer,
-	.GetWTime         = getWTime,
-	.SetWTime         = NULL,
-	.Shutdown         = shutdown,
-	.Reboot           = reboot,
-	.Sleep            = Sleep,
-	.SetText          = setText,
-	.SetLed           = setLed,
-	.SetIcon          = setIcon,
-	.SetBrightness    = setBrightness,
-	.GetWakeupReason  = NULL,
-	.SetLight         = setLight,
-	.SetLedBrightness = NULL,
-	.GetVersion       = NULL,
-	.SetRF            = NULL,
-	.SetFan           = NULL,
-	.GetWakeupTime    = NULL,
-	.SetDisplayTime   = NULL,
-	.SetTimeMode      = NULL,
-#if defined MODEL_SPECIFIC
-	.ModelSpecific    = NULL,
-#endif
-	.Exit             = Exit
-};
-
diff -Naur sh4-apps/tools/fp_control/Ufs912.c taapat-apps/tools/fp_control/Ufs912.c
--- sh4-apps/tools/fp_control/Ufs912.c	2019-02-20 16:00:47.074955573 +0100
+++ taapat-apps/tools/fp_control/Ufs912.c	1970-01-01 01:00:00.000000000 +0100
@@ -1,643 +0,0 @@
-/*
- * Ufs912.c
- *
- * (c) 2009 dagobert@teamducktales
- *
- * This program is free software; you can redistribute it and/or modify
- * it under the terms of the GNU General Public License as published by
- * the Free Software Foundation; either version 2 of the License, or
- * (at your option) any later version.
- *
- * This program is distributed in the hope that it will be useful,
- * but WITHOUT ANY WARRANTY; without even the implied warranty of
- * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the
- * GNU General Public License for more details.
- *
- * You should have received a copy of the GNU General Public License
- * along with this program; if not, write to the Free Software
- * Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA 02111-1307 USA
- *
- */
-
-/******************** includes ************************ */
-#include <stdio.h>
-#include <stdlib.h>
-#include <string.h>
-#include <time.h>
-#include <sys/types.h>
-#include <sys/stat.h>
-#include <fcntl.h>
-#include <unistd.h>
-#include <limits.h>
-#include <sys/ioctl.h>
-#include <linux/input.h>
-
-#include "global.h"
-#include "Ufs912.h"
-
-static int setText(Context_t *context, char *theText);
-static int Clear(Context_t *context);
-static int setIcon(Context_t *context, int which, int on);
-
-/******************** constants ************************ */
-
-#define cVFD_DEVICE "/dev/vfd"
-#define cEVENT_DEVICE "/dev/input/event0"
-
-#define cMAXCharsUFS912 16
-
-typedef struct
-{
-	char *arg;
-	char *arg_long;
-	char *arg_description;
-} tArgs;
-
-tArgs vKArgs[] =
-{
-	{ "-e", "  --setTimer           ", "Args: [time date]  Format: HH:MM:SS dd-mm-YYYY" },
-	{ "", "                         ", "      No arg: Set the most recent timer from e2 or neutrino" },
-	{ "", "                         ", "      to the frontcontroller and shutdown" },
-	{ "", "                         ", "      Arg time date: Set frontcontroller wake up time to" },
-	{ "", "                         ", "      time, shutdown, and wake up at given time" },
-	{ "-d", "  --shutdown           ", "Args: None or [time date]  Format: HH:MM:SS dd-mm-YYYY" },
-	{ "", "                         ", "      No arg: Shut down immediately" },
-	{ "", "                         ", "      Arg time date: Shut down at given time/date" },
-	{ "-r", "  --reboot             ", "Args: None" },
-	{ "", "                         ", "      No arg: Reboot immediately" },
-	{ "", "                         ", "      Arg time date: Reboot at given time/date" },
-	{ "-g", "  --getTime            ", "Args: None        Display currently set frontprocessor time" },
-//	{ "-gs", " --getTimeAndSet      ", "Args: None" },
-//	{ "", "                         ", "      Set system time to current frontprocessor time" },
-//	{ "", "                         ", "      WARNING: system date will be 01-01-1970!" },
-//	{ "-gt", " --getWTime           ", "Args: None        Get the current frontcontroller wake up time" },
-//	{ "-st", " --setWakeTime        ", "Args: time date   Format: HH:MM:SS dd-mm-YYYY" },
-//	{ "", "                         ", "      Set the frontcontroller wake up time" },
-	{ "-s", "  --setTime            ", "Args: time date   Format: HH:MM:SS dd-mm-YYYY" },
-	{ "", "                         ", "      Set the frontprocessor time" },
-//	{ "-sst", "--setSystemTime      ", "Args: None        Set front processor time to system time" },
-	{ "-p", "  --sleep              ", "Args: time date   Format: HH:MM:SS dd-mm-YYYY" },
-	{ "", "                         ", "      Reboot receiver via fp at given time" },
-	{ "-t", "  --settext            ", "Args: text        Set text to frontpanel" },
-	{ "-l", "  --setLed             ", "Args: LED# 1|0    Set an LED on or off" },
-	{ "-led", "--setLedBrightness   ", "Args: int         int=brightness (0..255)" },
-	{ "-i", "  --setIcon            ", "Args: icon# 1|0   Set an icon on or off" },
-	{ "-b", "  --setBrightness      ", "Arg : 0..7        Set display brightness" },
-	{ "-w", "  --getWakeupReason    ", "Args: None        Get the wake up reason" },
-	{ "-L", "  --setLight           ", "Arg : 0|1         Set display on/off" },
-	{ "-c", "  --clear              ", "Args: None        Clear display, all icons and LEDs off" },
-	{ "-v", "  --version            ", "Args: None        Get version info from frontprocessor" },
-//	{ "-tm", " --time_mode          ", "Args: 0/1         Set time mode" },
-#if defined MODEL_SPECIFIC
-//	{ "-ms", " --model_specific     ", "Args: int1 [int2] [int3] ... [int16]   (note: input in hex)" },
-//	{ "", "                         ", "                  Model specific test function" },
-#endif
-	{ NULL, NULL, NULL }
-};
-
-typedef struct
-{
-	int display;
-	int display_custom;
-	char *timeFormat;
-
-	time_t wakeupTime;
-	int wakeupDecrement;
-} tUFS912Private;
-
-/* ******************* helper/misc functions ****************** */
-
-static void setMode(int fd)
-{
-	struct micom_ioctl_data micom;
-	micom.u.mode.compat = 1;
-	if (ioctl(fd, VFDSETMODE, &micom) < 0)
-	{
-		perror("setMode: ");
-	}
-}
-
-/* calculate the time value which we can pass to
- * the micom fp. its a mjd time (mjd=modified
- * julian date). mjd is relativ to gmt so theGMTTime
- * must be in GMT/UTC.
- */
-static void setMicomTime(time_t theGMTTime, char *destString)
-{
-	/* from u-boot micom */
-	struct tm *now_tm;
-
-	now_tm = gmtime(&theGMTTime);
-	//printf("Set Time (UTC): %02d:%02d:%02d %02d-%02d-%04d\n",
-	// now_tm->tm_hour, now_tm->tm_min, now_tm->tm_sec, now_tm->tm_mday, now_tm->tm_mon+1, now_tm->tm_year+1900);
-	double mjd = modJulianDate(now_tm);
-	int mjd_int = mjd;
-	destString[0] = (mjd_int >> 8);
-	destString[1] = (mjd_int & 0xff);
-	destString[2] = now_tm->tm_hour;
-	destString[3] = now_tm->tm_min;
-	destString[4] = now_tm->tm_sec;
-}
-
-static unsigned long getMicomTime(char *micomTimeString)
-{
-	unsigned int    mjd     = ((micomTimeString[1] & 0xFF) * 256) + (micomTimeString[2] & 0xFF);
-	unsigned long   epoch   = ((mjd - 40587) * 86400);
-	unsigned int    hour    = micomTimeString[3] & 0xFF;
-	unsigned int    min     = micomTimeString[4] & 0xFF;
-	unsigned int    sec     = micomTimeString[5] & 0xFF;
-	epoch += (hour * 3600 + min * 60 + sec);
-	//printf( "MJD = %d epoch = %ld, time = %02d:%02d:%02d\n", mjd,
-	//  epoch, hour, min, sec );
-	return epoch;
-}
-
-/* ******************* driver functions ****************** */
-
-static int init(Context_t *context)
-{
-	tUFS912Private *private = malloc(sizeof(tUFS912Private));
-	int vFd;
-//	printf("%s\n", __func__);
-	vFd = open(cVFD_DEVICE, O_RDWR);
-	if (vFd < 0)
-	{
-		fprintf(stderr, "Cannot open %s\n", cVFD_DEVICE);
-		perror("");
-	}
-	((Model_t *)context->m)->private = private;
-	memset(private, 0, sizeof(tUFS912Private));
-	checkConfig(&private->display, &private->display_custom, &private->timeFormat, &private->wakeupDecrement);
-	return vFd;
-}
-
-static int usage(Context_t *context, char *prg_name, char *cmd_name)
-{
-	int i;
-
-	fprintf(stderr, "Usage:\n\n");
-	fprintf(stderr, "%s argument [optarg1] [optarg2]\n", prg_name);
-	for (i = 0; ; i++)
-	{
-		if (vKArgs[i].arg == NULL)
-		{
-			break;
-		}
-		if ((cmd_name == NULL) || (strcmp(cmd_name, vKArgs[i].arg) == 0) || (strstr(vKArgs[i].arg_long, cmd_name) != NULL))
-		{
-			fprintf(stderr, "%s   %s   %s\n", vKArgs[i].arg, vKArgs[i].arg_long, vKArgs[i].arg_description);
-		}
-	}
-	return 0;
-}
-
-static int setTime(Context_t *context, time_t *theGMTTime)
-{  // -s command
-	struct micom_ioctl_data vData;
-
-	setMicomTime(*theGMTTime, vData.u.time.time);
-	fprintf(stderr, "Setting Current FP Time to %d (MJD) %02d:%02d:%02d\n",
-			vData.u.standby.time[0] & 0xff, ((vData.u.standby.time[1] & 0xff) * 256+ vData.u.standby.time[2]) & 0xff,
-			vData.u.standby.time[3] & 0xff, vData.u.standby.time[4] & 0xff);
-	if (ioctl(context->fd, VFDSETTIME, &vData) < 0)
-	{
-		perror("settime: ");
-		return -1;
-	}
-	return 0;
-}
-
-static int getTime(Context_t *context, time_t *theGMTTime)
-{  // -g command
-	char fp_time[8];
-
-	/* front controller time */
-	if (ioctl(context->fd, VFDGETTIME, &fp_time) < 0)
-	{
-		perror("gettime: ");
-		return -1;
-	}
-	/* if we get the fp time */
-	if (fp_time[0] != '\0')
-	{
-		/* current front controller time */
-		*theGMTTime = (time_t) getMicomTime(fp_time);
-//		fprintf(stderr, "Current Fp Time:     %02d:%02d:%02d MJD=%d (UTC)\n",
-//			fp_time[3], fp_time[4], fp_time[5], (fp_time[1] * 256) + fp_time[2]);
-	}
-	else
-	{
-		fprintf(stderr, "error reading time from fp\n");
-		*theGMTTime = 0;
-	}
-	return 0;
-}
-
-static int setTimer(Context_t *context, time_t *theGMTTime)
-{  // -e command
-	struct micom_ioctl_data vData;
-	time_t curTime    = 0;
-	time_t curTimeFp  = 0;
-	time_t wakeupTime = 0;
-	struct tm *ts;
-	struct tm *tsFp;
-	struct tm *tsWakeupTime;
-
-//	printf("%s ->\n", __func__);
-	// Get current Frontpanel time
-	getTime(context, &curTimeFp);
-	tsFp = gmtime(&curTimeFp);
-	fprintf(stderr, "Current Fp Time   : %02d:%02d:%02d %02d-%02d-%04d (UTC)\n",
-			tsFp->tm_hour, tsFp->tm_min, tsFp->tm_sec, tsFp->tm_mday, tsFp->tm_mon + 1, tsFp->tm_year + 1900);
-	// Get current Linux time
-	time(&curTime);
-	ts = gmtime(&curTime);
-	fprintf(stderr, "Current Linux Time: %02d:%02d:%02d %02d-%02d-%04d (UTC), offset = %d\n",
-			ts->tm_hour, ts->tm_min, ts->tm_sec, ts->tm_mday, ts->tm_mon + 1, ts->tm_year + 1900, 0);
-	// Set current Linux time as new current Frontpanel time
-	setTime(context, &curTime);
-	if (theGMTTime == NULL)
-	{
-		wakeupTime = read_timers_utc(curTime);
-	}
-	else
-	{
-		wakeupTime = *theGMTTime;
-	}
-	if ((wakeupTime <= 0) || (wakeupTime == LONG_MAX))
-	{
-		/* clear timer */
-		vData.u.standby.time[0] = '\0';
-	}
-	else
-	{
-		// Print wakeup time
-		tsWakeupTime = gmtime(&wakeupTime);
-		fprintf(stderr, "Planned Wakeup Time: %02d:%02d:%02d %02d-%02d-%04d (UTC)\n",
-				tsWakeupTime->tm_hour, tsWakeupTime->tm_min, tsWakeupTime->tm_sec, tsWakeupTime->tm_mday, tsWakeupTime->tm_mon + 1, tsWakeupTime->tm_year + 1900);
-		setMicomTime(wakeupTime, vData.u.standby.time);
-		fprintf(stderr, "Setting Planned Fp Wakeup Time to = %02X%02X %d %d %d (mtime)\n",
-			vData.u.standby.time[0], vData.u.standby.time[1], vData.u.standby.time[2], 
-			vData.u.standby.time[3], vData.u.standby.time[4]);
-	}
-	fprintf(stderr, "Entering Deep Standby. ... good bye ...\n");
-	fflush(stdout);
-	fflush(stderr);
-	sleep(2);
-	if (ioctl(context->fd, VFDSTANDBY, &vData) < 0)
-	{
-		perror("standby: ");
-		return -1;
-	}
-	return 0;
-}
-
-static int getWTime(Context_t *context, time_t *theGMTTime)
-{  // -gw command
-	fprintf(stderr, "%s: not implemented\n", __func__);
-	return -1;
-}
-
-static int shutdown(Context_t *context, time_t *shutdownTimeGMT)
-{  // -d command
-	time_t curTime;
-
-	/* shutdown immediately */
-	if (*shutdownTimeGMT == -1)
-	{
-		return (setTimer(context, NULL));
-	}
-	while (1)
-	{
-		time(&curTime);
-		/*printf("curTime = %d, shutdown %d\n", curTime, *shutdownTimeGMT);*/
-		if (curTime >= *shutdownTimeGMT)
-		{
-			/* set most recent timer and bye bye */
-			return (setTimer(context, NULL));
-		}
-		usleep(100000);
-	}
-	return -1;
-}
-
-static int reboot(Context_t *context, time_t *rebootTimeGMT)
-{  // -r command
-	time_t curTime;
-	struct micom_ioctl_data vData;
-
-	while (1)
-	{
-		time(&curTime);
-		if (curTime >= *rebootTimeGMT)
-		{
-			if (ioctl(context->fd, VFDREBOOT, &vData) < 0)
-			{
-				perror("reboot: ");
-				return -1;
-			}
-		}
-		usleep(100000);
-	}
-	return 0;
-}
-
-static int Sleep(Context_t *context, time_t *wakeUpGMT)
-{  // -p command
-	time_t curTime;
-	int sleep = 1;
-	int vFd;
-	fd_set rfds;
-	struct timeval tv;
-	int retval, i, rd;
-	struct tm *ts;
-	char output[cMAXCharsUFS912 + 1];
-	struct input_event ev[64];
-	tUFS912Private *private = (tUFS912Private *)((Model_t *)context->m)->private;
-
-	vFd = open(cEVENT_DEVICE, O_RDWR);
-	if (vFd < 0)
-	{
-		fprintf(stderr, "cannot open %s\n", cEVENT_DEVICE);
-		perror("");
-		return -1;
-	}
-	printf("%s 1\n", __func__);
-	while (sleep)
-	{
-		time(&curTime);
-		ts = localtime(&curTime);
-		if (curTime >= *wakeUpGMT)
-		{
-			sleep = 0;
-		}
-		else
-		{
-			FD_ZERO(&rfds);
-			FD_SET(vFd, &rfds);
-			tv.tv_sec = 0;
-			tv.tv_usec = 100000;
-			retval = select(vFd + 1, &rfds, NULL, NULL, &tv);
-			if (retval > 0)
-			{
-				rd = read(vFd, ev, sizeof(struct input_event) * 64);
-				if (rd < (int) sizeof(struct input_event))
-				{
-					continue;
-				}
-				for (i = 0; i < rd / sizeof(struct input_event); i++)
-				{
-					if (ev[i].type == EV_SYN)
-					{
-					}
-					else if (ev[i].type == EV_MSC && (ev[i].code == MSC_RAW || ev[i].code == MSC_SCAN))
-					{
-					}
-					else
-					{
-						if (ev[i].code == 116)
-						{
-							sleep = 0;
-						}
-					}
-				}
-			}
-		}
-		if (private->display)
-		{
-			strftime(output, cMAXCharsUFS912 + 1, private->timeFormat, ts);
-			setText(context, output);
-		}
-	}
-	return 0;
-}
-
-static int setText(Context_t *context, char *theText)
-{  // -t command
-	char vHelp[128];
-
-	strncpy(vHelp, theText, cMAXCharsUFS912);
-	vHelp[cMAXCharsUFS912] = '\0';
-	write(context->fd, vHelp, strlen(vHelp));
-	return 0;
-}
-
-static int setLed(Context_t *context, int which, int on)
-{  // -l command
-	struct micom_ioctl_data vData;
-
-	vData.u.led.led_nr = which;
-	vData.u.led.on = on;
-	setMode(context->fd);
-	if (ioctl(context->fd, VFDSETLED, &vData) < 0)
-	{
-		perror("setLed: ");
-		return -1;
-	}
-	return 0;
-}
-
-static int setIcon(Context_t *context, int which, int on)
-{  // -i command
-	struct micom_ioctl_data vData;
-
-	vData.u.icon.icon_nr = which;
-	vData.u.icon.on = on;
-	setMode(context->fd);
-	if (ioctl(context->fd, VFDICONDISPLAYONOFF, &vData) < 0)
-	{
-		perror("setIcon: ");
-		return -1;
-	}
-	return 0;
-}
-
-static int setBrightness(Context_t *context, int brightness)
-{  // -b command
-	struct micom_ioctl_data vData;
-
-	if (brightness < 0 || brightness > 7)
-	{
-		return -1;
-	}
-	vData.u.brightness.level = brightness;
-	setMode(context->fd);
-//	printf("%d\n", context->fd);
-	if (ioctl(context->fd, VFDBRIGHTNESS, &vData) < 0)
-	{
-		perror("setBrightness: ");
-		return -1;
-	}
-	return 0;
-}
-
-static int setLight(Context_t *context, int on)
-{  // -L command
-	struct micom_ioctl_data vData;
-
-	vData.u.light.onoff = on;
-//	setMode(context->fd);
-	if (ioctl(context->fd, VFDDISPLAYWRITEONOFF, &vData) < 0)
-	{
-		perror("Set light");
-		return -1;
-	}
-	return 0;
-}
-
-/* 0xc1 = rcu (from standby)
- * 0xc2 = front (from standby)
- * 0xc3 = time (timer)
- * 0xc4 = ac (power on)
- */
-static int getWakeupReason(Context_t *context, eWakeupReason *reason)
-{
-	unsigned char mode[8];
-	/* front controller time */
-	if (ioctl(context->fd, VFDGETWAKEUPMODE, &mode) < 0)
-	{
-		perror("getWakeupReason: ");
-		return -1;
-	}
-	/* if we get the reason */
-	if (mode[0] != '\0')
-	{
-		switch (mode[1])
-		{
-			case 0xc4:  // power on
-			{
-				*reason = 1;
-				break;
-			}
-			case 0xc1:  // from deep standby, remote
-			case 0xc2:  // from deep standby, front panel
-			{
-				*reason = 2;
-				break;
-			}
-			case 0xc3:  // timer
-			{
-				*reason = 3;
-				break;
-			}
-			default:
-			{
-				*reason = 0;
-				break;
-			}
-		}
-	}
-	else
-	{
-		fprintf(stderr, "Error reading wakeupmode from fp\n");
-		*reason = 0;
-	}
-	return 0;
-}
-
-static int getVersion(Context_t *context, int *version)
-{  // -v command
-	char strVersion[8];
-	/* front controller version */
-	if (ioctl(context->fd, VFDGETVERSION, &strVersion) < 0)
-	{
-		perror("getVersion: ");
-		return -1;
-	}
-	/* if we get the fp time */
-	if (strVersion[0] != '\0')
-	{
-		*version = strVersion[1] * 10 | strVersion[2];
-	}
-	else
-	{
-		fprintf(stderr, "Error reading version info from fp\n");
-		*version = 0;
-	}
-	return 0;
-}
-
-static int Clear(Context_t *context)
-{  // -c command
-	char string[17];
-	struct micom_ioctl_data vData;
-
-	memset(string, 0x20, sizeof(string));
-	string[cMAXCharsUFS912] = '\0';
-	/* printf("%s, %d\n", vHelp, strlen(vHelp));*/
-	write(context->fd, string, strlen(string));
-
-	vData.u.icon.icon_nr = 17;
-	vData.u.icon.on = 0;
-	setMode(context->fd);
-	if (ioctl(context->fd, VFDICONDISPLAYONOFF, &vData) < 0)
-	{
-		perror("Clear: ");
-		return -1;
-	}
-	return 0;
-}
-
-static int setLedBrightness(Context_t *context, int brightness)
-{  // -led command
-	struct micom_ioctl_data vData;
-
-	if (brightness < 0 || brightness > 0xff)
-	{
-		return -1;
-	}
-	vData.u.brightness.level = brightness;
-	setMode(context->fd);
-	if (ioctl(context->fd, VFDLEDBRIGHTNESS, &vData) < 0)
-	{
-		perror("setLedBrightness: ");
-		return -1;
-	}
-	return 0;
-}
-
-static int Exit(Context_t *context)
-{
-	tUFS912Private *private = (tUFS912Private *)((Model_t *)context->m)->private;
-	if (context->fd > 0)
-	{
-		close(context->fd);
-	}
-	free(private);
-	return 1;
-}
-
-Model_t UFS912_model =
-{
-	.Name             = "Kathrein UFS912 frontpanel control utility",
-	.Type             = Ufs912,
-	.Init             = init,
-	.Clear            = Clear,
-	.Usage            = usage,
-	.SetTime          = setTime,
-	.GetTime          = getTime,
-	.SetTimer         = setTimer,
-	.GetWTime         = getWTime,
-	.SetWTime         = NULL,
-	.Shutdown         = shutdown,
-	.Reboot           = reboot,
-	.Sleep            = Sleep,
-	.SetText          = setText,
-	.SetLed           = setLed,
-	.SetIcon          = setIcon,
-	.SetBrightness    = setBrightness,
-	.GetWakeupReason  = getWakeupReason,
-	.SetLight         = setLight,
-	.SetLedBrightness = setLedBrightness,
-	.GetVersion       = getVersion,
-	.SetRF            = NULL,
-	.SetFan           = NULL,
-	.GetWakeupTime    = NULL,
-	.SetDisplayTime   = NULL,
-	.SetTimeMode      = NULL,
-#if defined MODEL_SPECIFIC
-	.ModelSpecific    = NULL,
-#endif
-	.Exit             = Exit
-};
-
diff -Naur sh4-apps/tools/fp_control/Ufs912.h taapat-apps/tools/fp_control/Ufs912.h
--- sh4-apps/tools/fp_control/Ufs912.h	2019-02-20 16:00:47.074955573 +0100
+++ taapat-apps/tools/fp_control/Ufs912.h	1970-01-01 01:00:00.000000000 +0100
@@ -1,69 +0,0 @@
-#ifndef __ufs912__
-#define __ufs912__
-
-#define VFDGETVERSION 0xc0425af7
-
-/* this setups the mode temporarily (for one ioctl)
- * to the desired mode. currently the "normal" mode
- * is the compatible vfd mode
- */
-struct set_mode_s
-{
-	int compat; /* 0 = compatibility mode to vfd driver; 1 = micom mode */
-};
-
-struct set_brightness_s
-{
-	int level;
-};
-
-struct set_icon_s
-{
-	int icon_nr;
-	int on;
-};
-
-struct set_led_s
-{
-	int led_nr;
-	int on;
-};
-
-struct set_light_s
-{
-	int onoff;
-};
-
-/* time must be given as follows:
- * time[0] & time[1] = mjd ???
- * time[2] = hour
- * time[3] = min
- * time[4] = sec
- */
-struct set_standby_s
-{
-	char time[5];
-};
-
-struct set_time_s
-{
-	char time[5];
-};
-
-
-struct micom_ioctl_data
-{
-	union
-	{
-		struct set_icon_s icon;
-		struct set_led_s led;
-		struct set_brightness_s brightness;
-		struct set_light_s light;
-		struct set_mode_s mode;
-		struct set_standby_s standby;
-		struct set_time_s time;
-	} u;
-};
-
-
-#endif
diff -Naur sh4-apps/tools/fp_control/Ufs922.c taapat-apps/tools/fp_control/Ufs922.c
--- sh4-apps/tools/fp_control/Ufs922.c	2019-02-20 16:00:47.075955549 +0100
+++ taapat-apps/tools/fp_control/Ufs922.c	1970-01-01 01:00:00.000000000 +0100
@@ -1,579 +0,0 @@
-/*
- * Ufs922.c
- *
- * (c) 2009 dagobert@teamducktales
- *
- * This program is free software; you can redistribute it and/or modify
- * it under the terms of the GNU General Public License as published by
- * the Free Software Foundation; either version 2 of the License, or
- * (at your option) any later version.
- *
- * This program is distributed in the hope that it will be useful,
- * but WITHOUT ANY WARRANTY; without even the implied warranty of
- * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
- * GNU General Public License for more details.
- *
- * You should have received a copy of the GNU General Public License
- * along with this program; if not, write to the Free Software
- * Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA 02111-1307 USA
- *
- */
-
-/******************** includes ************************ */
-#include <stdio.h>
-#include <stdlib.h>
-#include <string.h>
-#include <time.h>
-#include <sys/types.h>
-#include <sys/stat.h>
-#include <fcntl.h>
-#include <unistd.h>
-#include <limits.h>
-#include <sys/ioctl.h>
-#include <linux/input.h>
-
-#include "global.h"
-#include "Ufs922.h"
-
-static int setText(Context_t *context, char *theText);
-static int Clear(Context_t *context);
-static int setIcon(Context_t *context, int which, int on);
-
-/* ****************** constants ************************ */
-
-#define cVFD_DEVICE "/dev/vfd"
-#define cEVENT_DEVICE "/dev/input/event0"
-
-#define WAKEUPFILE "/var/wakeup"
-#define WAS_TIMER_WAKEUP "/proc/stb/fp/was_timer_wakeup"
-
-#define cMAXCharsUFS922 16
-
-typedef struct
-{
-	int display;
-	int display_custom;
-	char *timeFormat;
-
-	time_t wakeupTime;
-	int wakeupDecrement;
-} tUFS922Private;
-
-/* ******************* helper/misc functions ****************** */
-
-static void setMode(int fd)
-{
-	struct micom_ioctl_data micom;
-	micom.u.mode.compat = 1;
-	if (ioctl(fd, VFDSETMODE, &micom) < 0)
-	{
-		perror("setMode: ");
-	}
-}
-
-/* Calculate the time value which we can pass to
- * the micom fp. its a mjd time (mjd=modified
- * julian date). mjd is relativ to gmt so theGMTTime
- * must be in GMT/UTC.
- */
-void setMicomTime(time_t theGMTTime, char *destString)
-{
-	/* from u-boot micom */
-	struct tm *now_tm;
-
-	now_tm = gmtime(&theGMTTime);
-
-	printf("Set Time (UTC): %02d:%02d:%02d %02d-%02d-%04d\n",
-		now_tm->tm_hour, now_tm->tm_min, now_tm->tm_sec, now_tm->tm_mday, now_tm->tm_mon+1, now_tm->tm_year+1900);
-
-	double mjd = modJulianDate(now_tm);
-	int mjd_int = mjd;
-	destString[0] = (mjd_int >> 8);
-	destString[1] = (mjd_int & 0xff);
-	destString[2] = now_tm->tm_hour;
-	destString[3] = now_tm->tm_min;
-	destString[4] = now_tm->tm_sec;
-}
-
-unsigned long getMicomTime(char *micomTimeString)
-{
-	unsigned int  mjd   = ((micomTimeString[1] & 0xFF) * 256) + (micomTimeString[2] & 0xFF);
-	unsigned long epoch = ((mjd - 40587)*86400);
-
-	unsigned int  hour  = micomTimeString[3] & 0xFF;
-	unsigned int  min   = micomTimeString[4] & 0xFF;
-	unsigned int  sec   = micomTimeString[5] & 0xFF;
-
-	epoch += (hour * 3600 + min * 60 + sec);
-
-	printf("MJD = %d epoch = %ld, time = %02d:%02d:%02d\n", mjd,
-		epoch, hour, min, sec);
-
-	return epoch;
-}
-
-/* ******************* driver functions ****************** */
-
-static int init(Context_t *context)
-{
-	tUFS922Private *private = malloc(sizeof(tUFS922Private));
-	int vFd;
-
-//	printf("%s\n", __func__);
-
-	vFd = open(cVFD_DEVICE, O_RDWR);
-	if (vFd < 0)
-	{
-		fprintf(stderr, "cannot open %s\n", cVFD_DEVICE);
-		perror("");
-	}
-	((Model_t *)context->m)->private = private;
-	memset(private, 0, sizeof(tUFS922Private));
-
-	checkConfig(&private->display, &private->display_custom, &private->timeFormat, &private->wakeupDecrement);
-
-	return vFd;
-}
-
-static int usage(Context_t *context, char *prg_name, char *cmd_name)
-{
-	fprintf(stderr, "%s: not implemented\n", __func__);
-	return -1;
-}
-
-static int setTime(Context_t *context, time_t *theGMTTime)
-{
-	struct micom_ioctl_data vData;
-	printf("%s\n", __func__);
-	setMicomTime(*theGMTTime, vData.u.time.time);
-	if (ioctl(context->fd, VFDSETTIME, &vData) < 0)
-	{
-		perror("settime: ");
-		return -1;
-	}
-	return 0;
-}
-
-static int getTime(Context_t *context, time_t *theGMTTime)
-{
-	char fp_time[8];
-
-	fprintf(stderr, "Waiting on current time from fp...\n");
-
-	/* front controller time */
-	if (ioctl(context->fd, VFDGETTIME, &fp_time) < 0)
-	{
-		perror("gettime: ");
-		return -1;
-	}
-	/* if we get the fp time */
-	if (fp_time[0] != '\0')
-	{
-//		fprintf(stderr, "Success reading time from fp\n");
-
-		/* current front controller time */
-		*theGMTTime = (time_t) getMicomTime(fp_time);
-	}
-	else
-	{
-		fprintf(stderr, "Error reading time from fp\n");
-		*theGMTTime = 0;
-	}
-	return 0;
-}
-
-static int setTimer(Context_t *context, time_t *theGMTTime)
-{
-	struct micom_ioctl_data vData;
-	
-	time_t curTime    = 0;
-	time_t curTimeFp  = 0;
-	time_t wakeupTime = 0;
-	struct tm *ts;
-	struct tm *tsFp;
-	struct tm *tsWakeupTime;
-	printf("%s ->\n", __func__);
-	// Get current Frontpanel time
-	getTime(context, &curTimeFp);
-	tsFp = gmtime(&curTimeFp);
-	fprintf(stderr, "Current Fp Time:     %02d:%02d:%02d %02d-%02d-%04d (UTC)\n",
-			tsFp->tm_hour, tsFp->tm_min, tsFp->tm_sec,
-			tsFp->tm_mday, tsFp->tm_mon + 1, tsFp->tm_year + 1900);
-	// Get current Linux time
-	time(&curTime);
-	ts = gmtime(&curTime);
-	fprintf(stderr, "Current Linux Time:  %02d:%02d:%02d %02d-%02d-%04d (UTC)\n",
-			ts->tm_hour, ts->tm_min, ts->tm_sec,
-			ts->tm_mday, ts->tm_mon + 1, ts->tm_year + 1900);
-	// Set current Linux time as new current Frontpanel time
-	setTime(context, &curTime);
-	if (theGMTTime == NULL)
-	{
-		wakeupTime = read_timers_utc(curTime);
-	}
-	else
-	{
-		wakeupTime = *theGMTTime;
-	}
-
-	if ((wakeupTime <= 0) || (wakeupTime == LONG_MAX))
-	{
-		/* clear timer */
-		vData.u.standby.time[0] = '\0';
-	}
-	else
-	{
-		// Print wakeup time
-		tsWakeupTime = gmtime (&wakeupTime);
-		fprintf(stderr, "Planned Wakeup Time: %02d:%02d:%02d %02d-%02d-%04d (UTC)\n",
-			tsWakeupTime->tm_hour, tsWakeupTime->tm_min, tsWakeupTime->tm_sec,
-			tsWakeupTime->tm_mday, tsWakeupTime->tm_mon + 1, tsWakeupTime->tm_year + 1900);
-
-		setMicomTime(wakeupTime, vData.u.standby.time);
-		fprintf(stderr, "Setting Planned Fp Wakeup Time to = %02X%02X %d %d %d (mtime)\n",
-			vData.u.standby.time[0], vData.u.standby.time[1], vData.u.standby.time[2],
-			vData.u.standby.time[3], vData.u.standby.time[4] );
-	}
-
-	fprintf(stderr, "Entering DeepStandby. Goodbye...\n");
-	fflush(stdout);
-	fflush(stderr);
-	sleep(2);
-	if (ioctl(context->fd, VFDSTANDBY, &vData) < 0)
-	{
-		perror("standby: ");
-		return -1;
-	}
-	return 0;
-}
-
-static int getWTime(Context_t *context, time_t *theGMTTime)
-{
-	fprintf(stderr, "%s: not implemented\n", __func__);
-	return -1;
-}
-
-static int shutdown(Context_t *context, time_t *shutdownTimeGMT)
-{
-	time_t	curTime;
-
-	/* shutdown immediately */
-	if (*shutdownTimeGMT == -1)
-	{
-		return (setTimer(context, NULL));
-
-	}
-	while (1)
-	{
-		time(&curTime);
-		/*printf("curTime = %d, shutdown %d\n", curTime, *shutdownTimeGMT);*/
-	
-		if (curTime >= *shutdownTimeGMT)
-		{
-			/* set most recent e2 timer and bye bye */
-			return (setTimer(context, NULL));
-		}
-		usleep(100000);
-	}
-	return -1;
-}
-
-static int reboot(Context_t *context, time_t *rebootTimeGMT)
-{
-	time_t curTime;
-	struct micom_ioctl_data vData;
-
-	while (1)
-	{
-		time(&curTime);
-		if (curTime >= *rebootTimeGMT)
-		{
-			if (ioctl(context->fd, VFDREBOOT, &vData) < 0)
-			{
-				perror("reboot: ");
-				return -1;
-			}
-		}
-		usleep(100000);
-	}
-	return 0;
-}
-
-static int Sleep(Context_t *context, time_t *wakeUpGMT)
-{
-	time_t curTime;
-	int sleep = 1;
-	int vFd;
-	fd_set rfds;
-	struct timeval tv;
-	int retval, i, rd;
-	struct tm *ts;
-	char output[cMAXCharsUFS922 + 1];
-	struct input_event ev[64];
-	tUFS922Private *private = (tUFS922Private *)((Model_t *)context->m)->private;
-	printf("%s\n", __func__);
-	vFd = open(cEVENT_DEVICE, O_RDWR);
-
-	if (vFd < 0)
-	{
-		fprintf(stderr, "Cannot open %s\n", cEVENT_DEVICE);
-		perror("");
-		return -1;
-	}
-	
-	printf("%s 1\n", __func__);
-	while (sleep)
-	{
-		time(&curTime);
-		ts = localtime(&curTime);
-		if (curTime >= *wakeUpGMT)
-		{
-			sleep = 0;
-		}
-		else
-		{
-			FD_ZERO(&rfds);
-			FD_SET(vFd, &rfds);
-			tv.tv_sec = 0;
-			tv.tv_usec = 100000;
-			retval = select(vFd + 1, &rfds, NULL, NULL, &tv);
-			if (retval > 0)
-			{
-				rd = read(vFd, ev, sizeof(struct input_event) * 64);
-
-				if (rd < (int) sizeof(struct input_event))
-				{
-					continue;
-				}
-				for (i = 0; i < rd / sizeof(struct input_event); i++)
-				{
-					if (ev[i].type == EV_SYN)
-					{
-					}
-					else if (ev[i].type == EV_MSC && (ev[i].code == MSC_RAW || ev[i].code == MSC_SCAN))
-					{
-					}
-					else
-					{
-						if (ev[i].code == 116)
-						{
-							sleep = 0;
-						}
-					}
-				}
-			}
-		}
-		if (private->display)
-		{
-			strftime(output, cMAXCharsUFS922 + 1, private->timeFormat, ts);
-			setText(context, output);
-		}
-	}
-	return 0;
-}
-
-static int setText(Context_t *context, char *theText)
-{
-	char vHelp[128];
-	strncpy(vHelp, theText, cMAXCharsUFS922);
-	vHelp[cMAXCharsUFS922] = '\0';
-	/* printf("%s, %d\n", vHelp, strlen(vHelp));*/
-	write(context->fd, vHelp, strlen(vHelp));
-	return 0;
-}
-
-static int setLed(Context_t *context, int which, int on)
-{
-	struct micom_ioctl_data vData;
-	vData.u.led.led_nr = which;
-	vData.u.led.on = on;
-	setMode(context->fd);
-	if (ioctl(context->fd, VFDSETLED, &vData) < 0)
-	{
-		perror("setLed: ");
-		return -1;
-	}
-	return 0;
-}
-
-static int setIcon(Context_t *context, int which, int on)
-{
-	struct micom_ioctl_data vData;
-	vData.u.icon.icon_nr = which;
-	vData.u.icon.on = on;
-	setMode(context->fd);
-	if (ioctl(context->fd, VFDICONDISPLAYONOFF, &vData) < 0)
-	{
-		perror("setIcon: ");
-		return -1;
-	}
-	return 0;
-}
-
-static int setBrightness(Context_t *context, int brightness)
-{
-	struct micom_ioctl_data vData;
-	if (brightness < 0 || brightness > 7)
-	{
-		return -1;
-	}
-	vData.u.brightness.level = brightness;
-	printf("%d\n", context->fd);
-	setMode(context->fd);
-	if (ioctl(context->fd, VFDBRIGHTNESS, &vData) < 0)
-	{
-		perror("setBrightness: ");
-		return -1;
-	}
-	return 0;
-}
-
-static int setLight(Context_t *context, int on)
-{
-	if (on)
-	{
-		setBrightness(context, 7);
-	}
-	else
-	{
-		setBrightness(context, 0);
-	}
-	return 0;
-}
-
-/* FIXME: not sure if this really works for ufs922 ->must be checked */
-#if 0
-static int getWakeupReason(Context_t *context, int *reason)
-{
-	char mode[8];
-	fprintf(stderr, "Waiting for wakeupmode from fp...\n");
-	/* front controller time */
-	if (ioctl(context->fd, VFDGETWAKEUPMODE, &mode) < 0)
-	{
-		perror("getWakeupReason: ");
-		return -1;
-	}
-	/* if we get the fp time */
-	if (mode[0] != '\0')
-	{
-		fprintf(stderr, "success reading wakeupdmode from fp\n");
-		*reason = mode[1] && 0xff;
-		printf("reason = 0x%x\n", *reason);
-	}
-	else
-	{
-		fprintf(stderr, "error reading wakeupmode from fp\n");
-		*reason = 0;
-	}
-	return 0;
-}
-#endif
-
-/* FIXME: not sure if this really works for ufs922 ->must be checked */
-static int getVersion(Context_t *context, int *version)
-{
-	char    strVersion[8];
-	fprintf(stderr, "Waiting on version from fp...\n");
-	/* front controller version info */
-	if (ioctl(context->fd, VFDGETVERSION, &strVersion) < 0)
-	{
-		perror("getVersion: ");
-		return -1;
-	}
-	/* if we get the fp time */
-	if (strVersion[0] != '\0')
-	{
-		fprintf(stderr, "success reading version from fp\n");
-		*version = strVersion[1] * 10 | strVersion[2];
-		printf("version = %d\n", *version);
-	}
-	else
-	{
-		fprintf(stderr, "error reading version from fp\n");
-		*version = 0;
-	}
-	return 0;
-}
-
-static int Exit(Context_t *context)
-{
-	tUFS922Private *private = (tUFS922Private *)((Model_t *)context->m)->private;
-
-	if (context->fd > 0)
-	{
-		close(context->fd);
-	}
-
-	free(private);
-	exit(1);
-}
-
-static int Clear(Context_t *context)
-{
-	int i;
-	setText(context, "                ");
-	setBrightness(context, 7);
-	for (i = 1; i <= 6 ; i++)
-	{
-		setLed(context, i, 0);
-	}
-	for (i = 1; i <= 16 ; i++)
-	{
-		setIcon(context, i, 0);
-	}
-	return 0;
-}
-
-static int setLedBrightness(Context_t *context, int brightness)
-{
-	struct micom_ioctl_data vData;
-	if (brightness < 0 || brightness > 0xff)
-	{
-		return -1;
-	}
-
-	vData.u.brightness.level = brightness;
-	setMode(context->fd);
-	printf("%d\n", context->fd);
-	if (ioctl(context->fd, VFDLEDBRIGHTNESS, &vData) < 0)
-	{
-		perror("setledbrightness: ");
-		return -1;
-	}
-	return 0;
-}
-
-Model_t UFS922_model =
-{
-	.Name             = "Kathrein UFS922 frontpanel control utility",
-	.Type             = Ufs922,
-	.Init             = init,
-	.Clear            = Clear,
-	.Usage            = usage,
-	.SetTime          = setTime,
-	.GetTime          = getTime,
-	.SetTimer         = setTimer,
-	.GetWTime         = getWTime,
-	.SetWTime         = NULL,
-	.Shutdown         = shutdown,
-	.Reboot           = reboot,
-	.Sleep            = Sleep,
-	.SetText          = setText,
-	.SetLed           = setLed,
-	.SetIcon          = setIcon,
-	.SetBrightness    = setBrightness,
-	.GetWakeupReason  = NULL,
-//	.GetWakeupReason  = getWakeupReason,  //TODO: CHECK IF WORKING
-	.SetLight         = setLight,
-	.SetLedBrightness = setLedBrightness,
-	.GetVersion       = getVersion,
-	.SetRF            = NULL,
-	.SetFan           = NULL,
-	.GetWakeupTime    = NULL,
-	.SetDisplayTime   = NULL,
-	.SetTimeMode      = NULL,
-#if defined MODEL_SPECIFIC
-	.ModelSpecific    = NULL,
-#endif
-	.Exit             = Exit
-};
diff -Naur sh4-apps/tools/fp_control/Ufs922.h taapat-apps/tools/fp_control/Ufs922.h
--- sh4-apps/tools/fp_control/Ufs922.h	2019-02-20 16:00:47.075955549 +0100
+++ taapat-apps/tools/fp_control/Ufs922.h	1970-01-01 01:00:00.000000000 +0100
@@ -1,63 +0,0 @@
-#ifndef __ufs922__
-#define __ufs922__
-
-#define VFDGETVERSION 0xc0425af7
-
-/* this setups the mode temporarily (for one ioctl)
- * to the desired mode. currently the "normal" mode
- * is the compatible vfd mode
- */
-struct set_mode_s
-{
-	int compat; /* 0 = compatibility mode to vfd driver; 1 = micom mode */
-};
-
-struct set_brightness_s
-{
-	int level;
-};
-
-struct set_icon_s
-{
-	int icon_nr;
-	int on;
-};
-
-struct set_led_s
-{
-	int led_nr;
-	int on;
-};
-
-/* time must be given as follows:
- * time[0] & time[1] = mjd ???
- * time[2] = hour
- * time[3] = min
- * time[4] = sec
- */
-struct set_standby_s
-{
-	char time[5];
-};
-
-struct set_time_s
-{
-	char time[5];
-};
-
-
-struct micom_ioctl_data
-{
-	union
-	{
-		struct set_icon_s icon;
-		struct set_led_s led;
-		struct set_brightness_s brightness;
-		struct set_mode_s mode;
-		struct set_standby_s standby;
-		struct set_time_s time;
-	} u;
-};
-
-
-#endif
diff -Naur sh4-apps/tools/fp_control/Vip2.c taapat-apps/tools/fp_control/Vip2.c
--- sh4-apps/tools/fp_control/Vip2.c	2019-02-20 16:00:47.075955549 +0100
+++ taapat-apps/tools/fp_control/Vip2.c	1970-01-01 01:00:00.000000000 +0100
@@ -1,468 +0,0 @@
-/*
- * Vip2.c
- *
- * (c) 2010 duckbox project
- *
- * This program is free software; you can redistribute it and/or modify
- * it under the terms of the GNU General Public License as published by
- * the Free Software Foundation; either version 2 of the License, or
- * (at your option) any later version.
- *
- * This program is distributed in the hope that it will be useful,
- * but WITHOUT ANY WARRANTY; without even the implied warranty of
- * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the
- * GNU General Public License for more details.
- *
- * You should have received a copy of the GNU General Public License
- * along with this program; if not, write to the Free Software
- * Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA 02111-1307 USA
- *
- */
-
-/* ******************* includes ************************ */
-#include <stdio.h>
-#include <stdlib.h>
-#include <string.h>
-#include <time.h>
-#include <sys/types.h>
-#include <sys/stat.h>
-#include <fcntl.h>
-#include <unistd.h>
-#include <limits.h>
-#include <sys/ioctl.h>
-
-#include "global.h"
-#include "Vip2.h"
-
-static int setText(Context_t *context, char *theText);
-
-/* ******************* constants ************************ */
-
-#define cVFD_DEVICE "/dev/vfd"
-
-#define cMAXCharsVIP2 16
-
-typedef struct
-{
-	int display;
-	int display_custom;
-	char *timeFormat;
-
-	time_t wakeupTime;
-	int wakeupDecrement;
-} tVIP2Private;
-
-/* ******************* helper/misc functions ****************** */
-
-/* calculate the time value which we can pass to
- * the aotom fp. its a mjd time (mjd=modified
- * julian date). mjd is relativ to gmt so theGMTTime
- * must be in GMT/UTC.
- */
-void setAotomTime(time_t theGMTTime, char *destString)
-{
-	/* from u-boot aotom */
-	struct tm *now_tm;
-	now_tm = gmtime(&theGMTTime);
-	printf("Set Time (UTC): %02d:%02d:%02d %02d-%02d-%04d\n",
-		now_tm->tm_hour, now_tm->tm_min, now_tm->tm_sec, now_tm->tm_mday, now_tm->tm_mon+1, now_tm->tm_year+1900);
-
-	double mjd = modJulianDate(now_tm);
-	int mjd_int = mjd;
-	destString[0] = (mjd_int >> 8);
-	destString[1] = (mjd_int & 0xff);
-	destString[2] = now_tm->tm_hour;
-	destString[3] = now_tm->tm_min;
-	destString[4] = now_tm->tm_sec;
-}
-
-unsigned long getAotomTime(char *aotomTimeString)
-{
-	unsigned int 	mjd 	= ((aotomTimeString[1] & 0xFF) * 256) + (aotomTimeString[2] & 0xFF);
-	unsigned long 	epoch 	= ((mjd - 40587)*86400);
-
-	unsigned int 	hour 	= aotomTimeString[3] & 0xFF;
-	unsigned int 	min 	= aotomTimeString[4] & 0xFF;
-	unsigned int 	sec 	= aotomTimeString[5] & 0xFF;
-
-	epoch += (hour * 3600 + min * 60 + sec);
-	printf("MJD = %d epoch = %ld, time = %02d:%02d:%02d\n", mjd,
-		epoch, hour, min, sec);
-
-	return epoch;
-}
-
-/* ******************* driver functions ****************** */
-
-static int init(Context_t *context)
-{
-	tVIP2Private *private = malloc(sizeof(tVIP2Private));
-	int vFd;
-
-//	printf("%s\n", __func__);
-
-	vFd = open(cVFD_DEVICE, O_RDWR);
-	if (vFd < 0)
-	{
-		fprintf(stderr, "Cannot open %s\n", cVFD_DEVICE);
-		perror("");
-	}
-	((Model_t *)context->m)->private = private;
-	memset(private, 0, sizeof(tVIP2Private));
-
-	checkConfig(&private->display, &private->display_custom, &private->timeFormat, &private->wakeupDecrement);
-
-	return vFd;
-}
-
-static int usage(Context_t *context, char *prg_name, char *cmd_name)
-{
-	fprintf(stderr, "%s: not implemented\n", __func__);
-	return -1;
-}
-
-static int setTime(Context_t *context, time_t *theGMTTime)
-{
-	struct aotom_ioctl_data vData;
-
-	printf("%s\n", __func__);
-	setAotomTime(*theGMTTime, vData.u.time.time);
-	if (ioctl(context->fd, VFDSETTIME, &vData) < 0)
-	{
-		perror("settime: ");
-		return -1;
-	}
-	return 0;
-}
-
-static int getTime(Context_t *context, time_t *theGMTTime)
-{
-	char fp_time[8];
-
-	fprintf(stderr, "Waiting for current time from fp...\n");
-
-	/* front controller time */
-	if (ioctl(context->fd, VFDGETTIME, &fp_time) < 0)
-	{
-		perror("gettime: ");
-		return -1;
-	}
-	/* if we get the fp time */
-	if (fp_time[0] != '\0')
-	{
-		fprintf(stderr, "success reading time from fp\n");
-		/* current front controller time */
-		*theGMTTime = (time_t) getAotomTime(fp_time);
-	}
-	else
-	{
-		fprintf(stderr, "error reading time from fp\n");
-		*theGMTTime = 0;
-	}
-	return 0;
-}
-
-static int setTimer(Context_t *context, time_t *theGMTTime)
-{
-	struct aotom_ioctl_data vData;
-	time_t curTime;
-	time_t wakeupTime;
-	struct tm *ts;
-
-	time(&curTime);
-	ts = localtime(&curTime);
-	fprintf(stderr, "Current Time: %02d:%02d:%02d %02d-%02d-%04d\n",
-		ts->tm_hour, ts->tm_min, ts->tm_sec, ts->tm_mday, ts->tm_mon+1, ts->tm_year+1900);
-
-	if (theGMTTime == NULL)
-	{
-		wakeupTime = read_timers_utc(curTime);
-	}
-	else
-	{
-		wakeupTime = *theGMTTime;
-	}
-
-	if ((wakeupTime <= 0) || (wakeupTime == LONG_MAX))
-	{
-		/* nothing to do for e2 */
-		fprintf(stderr, "no e2 timer found clearing fp wakeup time ... good bye ...\n");
-		vData.u.standby.time[0] = '\0';
-		if (ioctl(context->fd, VFDSTANDBY, &vData) < 0)
-		{
-			perror("standby: ");
-			return -1;
-		}
-	}
-	else
-	{
-		unsigned long diff;
-		char fp_time[8];
-
-		fprintf(stderr, "Waiting for current time from fp ...\n");
-
-		/* front controller time */
-		if (ioctl(context->fd, VFDGETTIME, &fp_time) < 0)
-		{
-			perror("gettime: ");
-		return -1;
-		}
-		/* difference from now to wake up */
-		diff = (unsigned long int) wakeupTime - curTime;
-		/* if we get the fp time */
-		if (fp_time[0] != '\0')
-		{
-//			fprintf(stderr, "success reading time from fp\n");
-
-			/* current front controller time */
-			curTime = (time_t) getAotomTime(fp_time);
-		}
-		else
-		{
-			fprintf(stderr, "Error reading time, assuming localtime.\n");
-			/* noop current time already set */
-		}
-		wakeupTime = curTime + diff;
-		setAotomTime(wakeupTime, vData.u.standby.time);
-		if (ioctl(context->fd, VFDSTANDBY, &vData) < 0)
-		{
-			perror("standby: ");
-		return -1;
-		}
-	}
-	return 0;
-}
-
-static int getWTime(Context_t *context, time_t *theGMTTime)
-{
-	fprintf(stderr, "%s: not implemented\n", __func__);
-	return -1;
-}
-
-static int shutdown(Context_t *context, time_t *shutdownTimeGMT)
-{
-	time_t	curTime;
-
-	/* shutdown immediately */
-	if (*shutdownTimeGMT == -1)
-	{
-		return (setTimer(context, NULL));
-	}
-
-	while (1)
-	{
-		time(&curTime);
-		/*printf("curTime = %d, shutdown %d\n", curTime, *shutdownTimeGMT);*/
-		if (curTime >= *shutdownTimeGMT)
-		{
-			/* set most recent e2 timer and bye bye */
-			return (setTimer(context, NULL));
-		}
-		usleep(100000);
-	}
-	return -1;
-}
-
-static int reboot(Context_t *context, time_t *rebootTimeGMT)
-{
-	time_t curTime;
-	struct aotom_ioctl_data vData;
-
-	while (1)
-	{
-		time(&curTime);
-		if (curTime >= *rebootTimeGMT)
-		{
-			if (ioctl(context->fd, VFDREBOOT, &vData) < 0)
-			{
-				perror("reboot: ");
-				return -1;
-			}
-		}
-		usleep(100000);
-	}
-	return 0;
-}
-
-static int Sleep(Context_t *context, time_t *wakeUpGMT)
-{
-#if 0
-	time_t     curTime;
-	int        sleep = 1;
-	int        vFd;
-	fd_set     rfds;
-	struct     timeval tv;
-	int        retval;
-	struct tm  *ts;
-	char       output[cMAXCharsVIP2 + 1];
-	tVIP2Private *private = (tVIP2Private *)((Model_t *)context->m)->private;
-
-//	printf("%s\n", __func__);
-
-	vFd = open(cRC_DEVICE, O_RDWR);
-	if (vFd < 0)
-	{
-		fprintf(stderr, "cannot open %s\n", cRC_DEVICE);
-		perror("");
-		return -1;
-	}
-	printf("%s 1\n", __func__);
-	while (sleep)
-	{
-		time(&curTime);
-		ts = localtime(&curTime);
-
-		if (curTime >= *wakeUpGMT)
-		{
-			sleep = 0;
-		}
-		else
-		{
-			FD_ZERO(&rfds);
-			FD_SET(vFd, &rfds);
-			tv.tv_sec = 0;
-			tv.tv_usec = 100000;
-			retval = select(vFd + 1, &rfds, NULL, NULL, &tv);
-			if (retval > 0)
-			{
-				sleep = 0;
-			}
-		}
-		if (private->display)
-		{
-			strftime(output, cMAXCharsVIP2 + 1, private->timeFormat, ts);
-			setText(context, output);
-		}
-	}
-#endif
-	return 0;
-}
-
-static int setText(Context_t *context, char *theText)
-{
-	char vHelp[128];
-
-	strncpy(vHelp, theText, cMAXCharsVIP2);
-	vHelp[cMAXCharsVIP2] = '\0';
-	/* printf("%s, %d\n", vHelp, strlen(vHelp));*/
-	write(context->fd, vHelp, strlen(vHelp));
-	return 0;
-}
-
-static int setLed(Context_t *context, int which, int on)
-{
-	struct aotom_ioctl_data vData;
-
-	vData.u.led.led_nr = which;
-	vData.u.led.on = on;
-	if (ioctl(context->fd, VFDSETLED, &vData) < 0)
-	{
-		perror("setLed: ");
-		return -1;
-	}
-	return 0;
-}
-
-static int setIcon(Context_t *context, int which, int on)
-{
-	struct aotom_ioctl_data vData;
-
-	vData.u.icon.icon_nr = which;
-	vData.u.icon.on = on;
-	if (ioctl(context->fd, VFDICONDISPLAYONOFF, &vData) < 0)
-	{
-		perror("setIcon: ");
-		return -1;
-	}
-	return 0;
-}
-
-static int setBrightness(Context_t *context, int brightness)
-{
-	struct aotom_ioctl_data vData;
-
-	if (brightness < 0 || brightness > 7)
-	{
-		return -1;
-	}
-	vData.u.brightness.level = brightness;
-	printf("%d\n", context->fd);
-	if (ioctl(context->fd, VFDBRIGHTNESS, &vData) < 0)
-	{
-		perror("setbrightness: ");
-		return -1;
-	}
-	return 0;
-}
-
-static int setLight(Context_t *context, int on)
-{
-	if (on)
-	{
-		setBrightness(context, 7);
-	}
-	else
-	{
-		setBrightness(context, 0);
-	}
-	return 0;
-}
-
-static int Exit(Context_t *context)
-{
-	tVIP2Private *private = (tVIP2Private *)((Model_t *)context->m)->private;
-
-	if (context->fd > 0)
-	{
-		close(context->fd);
-	}
-
-	free(private);
-	exit(1);
-}
-
-static int Clear(Context_t *context)
-{
-	struct aotom_ioctl_data vData;
-	if (ioctl(context->fd, VFDDISPLAYCLR, &vData) < 0)
-	{
-		perror("clear: ");
-		return -1;
-	}
-	return 0;
-}
-
-Model_t VIP2_model =
-{
-	.Name             = "Edision VIP2 frontpanel control utility",
-	.Type             = Vip2,
-	.Init             = init,
-	.Clear            = Clear,
-	.Usage            = usage,
-	.SetTime          = setTime,
-	.GetTime          = getTime,
-	.SetTimer         = setTimer,
-	.GetWTime         = getWTime,
-	.SetWTime         = NULL,
-	.Shutdown         = shutdown,
-	.Reboot           = reboot,
-	.Sleep            = Sleep,
-	.SetText          = setText,
-	.SetLed           = setLed,
-	.SetIcon          = setIcon,
-	.SetBrightness    = setBrightness,
-	.GetWakeupReason  = NULL,
-	.SetLight         = setLight,
-	.SetLedBrightness = NULL,
-	.GetVersion       = NULL,
-	.SetRF            = NULL,
-	.SetFan           = NULL,
-	.GetWakeupTime    = NULL,
-	.SetDisplayTime   = NULL,
-	.SetTimeMode      = NULL,
-#if defined MODEL_SPECIFIC
-	.ModelSpecific    = NULL,
-#endif
-	.Exit             = Exit
-};
-
diff -Naur sh4-apps/tools/fp_control/Vip2.h taapat-apps/tools/fp_control/Vip2.h
--- sh4-apps/tools/fp_control/Vip2.h	2019-02-20 16:00:47.075955549 +0100
+++ taapat-apps/tools/fp_control/Vip2.h	1970-01-01 01:00:00.000000000 +0100
@@ -1,59 +0,0 @@
-#ifndef __vip2__
-#define __vip2__
-
-/* this setups the mode temporarily (for one ioctl)
- * to the desired mode. currently the "normal" mode
- * is the compatible vfd mode
- */
-struct set_mode_s
-{
-	int compat; /* 0 = compatibility mode to vfd driver; 1 = nuvoton mode */
-};
-
-struct set_brightness_s
-{
-	int level;
-};
-
-struct set_icon_s
-{
-	int icon_nr;
-	int on;
-};
-
-struct set_led_s
-{
-	int led_nr;
-	int on;
-};
-
-/* time must be given as follows:
- * time[0] & time[1] = mjd ???
- * time[2] = hour
- * time[3] = min
- * time[4] = sec
- */
-struct set_standby_s
-{
-	char time[5];
-};
-
-struct set_time_s
-{
-	char time[5];
-};
-
-struct aotom_ioctl_data
-{
-	union
-	{
-		struct set_icon_s icon;
-		struct set_led_s led;
-		struct set_brightness_s brightness;
-		struct set_mode_s mode;
-		struct set_standby_s standby;
-		struct set_time_s time;
-	} u;
-};
-
-#endif
