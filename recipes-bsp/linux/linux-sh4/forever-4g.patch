diff -Naur linux-sh4-2.6.32.71-stmicro/arch/sh/include/asm/irq-ilc.h linux-sh4-2.6.32.71-stmicro-PersianPrince/arch/sh/include/asm/irq-ilc.h
--- linux-sh4-2.6.32.71-stmicro/arch/sh/include/asm/irq-ilc.h	2019-12-10 20:01:29.000000000 +0330
+++ linux-sh4-2.6.32.71-stmicro-PersianPrince/arch/sh/include/asm/irq-ilc.h	2020-02-13 01:52:57.555368719 +0330
@@ -44,7 +44,7 @@
 #define ILC_IRQ(x)	(ILC_FIRST_IRQ + (x))
 #elif	defined(CONFIG_CPU_SUBTYPE_STX7111)
 #define ILC_FIRST_IRQ	176
-#define ILC_NR_IRQS	(64+36)
+#define ILC_NR_IRQS	(64+35)
 #define ILC_INT_IRQ(x)	(ILC_FIRST_IRQ + (x))
 #define ILC_EXT_IRQ(x)	(ILC_FIRST_IRQ + 64 + (x))
 #define ILC_IRQ(x)	ILC_INT_IRQ(x)
diff -Naur linux-sh4-2.6.32.71-stmicro/arch/sh/kernel/cpu/sh4/setup-stxh205.c linux-sh4-2.6.32.71-stmicro-PersianPrince/arch/sh/kernel/cpu/sh4/setup-stxh205.c
--- linux-sh4-2.6.32.71-stmicro/arch/sh/kernel/cpu/sh4/setup-stxh205.c	2019-12-10 20:01:29.000000000 +0330
+++ linux-sh4-2.6.32.71-stmicro-PersianPrince/arch/sh/kernel/cpu/sh4/setup-stxh205.c	2020-02-13 01:52:20.719821941 +0330
@@ -11,17 +11,10 @@
 #include <linux/init.h>
 #include <linux/platform_device.h>
 #include <linux/io.h>
-#include <linux/reboot.h>
-#include <linux/pm.h>
 #include <linux/stm/platform.h>
 #include <linux/stm/stxh205.h>
 #include <linux/stm/sysconf.h>
-#ifdef CONFIG_STM_LPM
-#include <linux/stm/lpm.h>
-#include <linux/stm/wakeup_devices.h>
-#endif
 #include <asm/irq-ilc.h>
-#include <asm/restart.h>
 
 /* SH4-only resources ----------------------------------------------------- */
 
@@ -65,60 +58,15 @@
 }
 core_initcall(stxh205_sh4_devices_setup);
 
-/* Warm reboot --------------------------------------------------------- */
-
-#ifdef CONFIG_STM_LPM
-static void stxh205_lpm_poweroff(void)
-{
-	struct stm_wakeup_devices wkd;
-
-	stm_check_wakeup_devices(&wkd);
-
-	stm_lpm_config_reboot(stm_lpm_reboot_with_ddr_off);
-
-	stm_lpm_power_off();
-
-	machine_halt();
-}
-
-void stxh205_prepare_restart(void)
-{
-	stm_lpm_config_reboot(stm_lpm_reboot_with_ddr_off);
-
-	stm_lpm_reset(STM_LPM_SOC_RESET);
-
-	machine_halt();
-}
-
-static int __init stxh205_machine_init(void)
-{
-	register_prepare_restart_handler(stxh205_prepare_restart);
-
-	pm_power_off = stxh205_lpm_poweroff;
-
-	return 0;
-}
-arch_initcall(stxh205_machine_init);
-#else
-void stxh205_prepare_restart(void)
+void machine_restart(char * __unused)
 {
 	struct sysconf_field *sc;
 
-	sc = sysconf_claim(SYSCONF(498), 0, 0, "reset");
-	sysconf_write(sc, 0);
-
-	sc = sysconf_claim(SYSCONF(475), 2, 2, "reset");
-	sysconf_write(sc, 0);
-}
-
-static int __init stxh205_reset_init(void)
-{
-	register_prepare_restart_handler(stxh205_prepare_restart);
-
-	return 0;
+         sc = sysconf_claim(SYSCONF(498), 0, 0, "st40_mask");
+         sysconf_write(sc, 0);
+         sc = sysconf_claim(SYSCONF(475), 2, 2, "st40_reset");
+         sysconf_write(sc, 0);
 }
-arch_initcall(stxh205_reset_init);
-#endif
 
 /* Interrupt initialisation ----------------------------------------------- */
 
diff -Naur linux-sh4-2.6.32.71-stmicro/drivers/net/phy/phy_device.c linux-sh4-2.6.32.71-stmicro-PersianPrince/drivers/net/phy/phy_device.c
--- linux-sh4-2.6.32.71-stmicro/drivers/net/phy/phy_device.c	2019-12-10 20:01:29.000000000 +0330
+++ linux-sh4-2.6.32.71-stmicro-PersianPrince/drivers/net/phy/phy_device.c	2020-02-13 01:57:56.823676557 +0330
@@ -1104,7 +1104,7 @@
 		return retval;
 	}
 
-	pr_debug("%s: Registered new driver\n", new_driver->name);
+	pr_info("%s: Registered new driver (0x%08x)\n", new_driver->name, new_driver->phy_id);
 
 	return 0;
 }
diff -Naur linux-sh4-2.6.32.71-stmicro/drivers/net/stmmac/stmmac_mdio.c linux-sh4-2.6.32.71-stmicro-PersianPrince/drivers/net/stmmac/stmmac_mdio.c
--- linux-sh4-2.6.32.71-stmicro/drivers/net/stmmac/stmmac_mdio.c	2019-12-10 20:01:29.000000000 +0330
+++ linux-sh4-2.6.32.71-stmicro-PersianPrince/drivers/net/stmmac/stmmac_mdio.c	2020-02-13 01:59:10.170769570 +0330
@@ -194,12 +194,26 @@
 			 * and no PHY number was provided to the MAC,
 			 * use the one probed here.
 			 */
-			if ((priv->plat->bus_id == mdio_bus_data->bus_id) &&
-			    (priv->plat->phy_addr == -1))
-				priv->plat->phy_addr = addr;
 
-			act = (priv->plat->bus_id == mdio_bus_data->bus_id) &&
-				(priv->plat->phy_addr == addr);
+			act = 0;
+
+			if ((priv->plat->bus_id == mdio_bus_data->bus_id) && (/*(priv->plat->phy_addr == -1) ||*/
+					(phydev->phy_id == 0x0181b880) || // Davicom DM9161E
+					(phydev->phy_id == 0x0181b8a0) || // Davicom DM9161A
+					(phydev->phy_id == 0x00181b80) || // Davicom DM9131
+					(phydev->phy_id == 0x1c040011) || // STe100p
+					(phydev->phy_id == 0x00061c50) || // STe101p
+					(phydev->phy_id == 0x00008201) || (phydev->phy_id == 0x0007c0f1) ||
+					(phydev->phy_id == 0x001cc912) || // RTL821x
+					(phydev->phy_id == 0x001cc816) || // RTL8201
+					(phydev->phy_id == 0x02430d90) || // IC+ IP1001
+					(phydev->phy_id == 0x02430c54) || // IC+ IP101A/G
+					(phydev->phy_id == 0x02430d80)))  // IC+ IP175C
+			{
+ 				priv->plat->phy_addr = addr;
+ 				act = 1;
+ 			}
+ 
 			switch (phydev->irq) {
 			case PHY_POLL:
 				irq_str = "POLL";
diff -Naur linux-sh4-2.6.32.71/drivers/stm/gpio.c linux-sh4-2.6.32.71-PersianPrince/drivers/stm/gpio.c
--- linux-sh4-2.6.32.71/drivers/stm/gpio.c	2020-05-06 15:58:20.301137000 +0430
+++ linux-sh4-2.6.32.71-PersianPrince/drivers/stm/gpio.c	2020-05-06 16:05:58.490486914 +0430
@@ -28,6 +28,10 @@
 #include <linux/stm/pad.h>
 #include <linux/stm/pio.h>
 #include <linux/stm/pm_sys.h>
+#ifdef CONFIG_PROC_FS
+#include <linux/proc_fs.h>
+#include <linux/kallsyms.h>
+#endif
 #include "reg_pio.h"
 
 #if !defined(CONFIG_STPIO)
@@ -36,6 +40,7 @@
 
 struct stpio_pin {
 #ifdef CONFIG_STPIO
+	const char *pin_name;
 	void (*func)(struct stpio_pin *pin, void *dev);
 	void* dev;
 	unsigned short port_no, pin_no;
@@ -54,6 +59,7 @@
 #ifdef CONFIG_HIBERNATION
 	unsigned char pm_saved_data;
 #endif
+	unsigned char direction;
 	struct stpio_pin stpio;
 };
 
@@ -396,6 +402,9 @@
 
 	gpio_pm_set_direction(&port->pins[offset], direction);
 	set__PIO_PCx(port->base, offset, direction);
+
+	if (!port->pins[offset].stpio.pin_name)
+		port->pins[offset].stpio.pin_name = "-----";
 }
 
 
@@ -514,6 +523,10 @@
 
 void stpio_free_pin(struct stpio_pin *pin)
 {
+	stpio_configure_pin(pin, STPIO_IN);
+	pin->pin_name = NULL;
+	pin->func = 0;
+	pin->dev = 0;
 	stm_pad_release_gpio(stm_gpio(pin->port_no, pin->pin_no));
 }
 EXPORT_SYMBOL(stpio_free_pin);
@@ -636,6 +649,102 @@
 }
 EXPORT_SYMBOL(stpio_set_irq_type);
 
+#ifdef CONFIG_PROC_FS
+static struct proc_dir_entry *proc_stpio;
+
+static inline const char *stpio_get_direction_name(unsigned int direction)
+{
+	switch (direction)
+	{
+		case STPIO_NONPIO:
+			return "IN  (pull-up)      ";
+		case STPIO_BIDIR:
+			return "BI  (open-drain)   ";
+		case STPIO_OUT:
+			return "OUT (push-pull)    ";
+		case STPIO_IN:
+			return "IN  (Hi-Z)         ";
+		case STPIO_ALT_OUT:
+			return "Alt-OUT (push-pull)";
+		case STPIO_ALT_BIDIR:
+			return "Alt-BI (open-drain)";
+		default:
+			return "forbidden          ";
+	}
+};
+
+static inline const char *stpio_get_handler_name(void *func)
+{
+	static char sym_name[KSYM_NAME_LEN];
+	char *modname;
+	unsigned long symbolsize, offset;
+	const char *symb;
+
+	if (func == NULL)
+	{
+		return "";
+	}
+	symb = kallsyms_lookup((unsigned long)func, &symbolsize, &offset,
+			&modname, sym_name);
+
+	return symb ? symb : "???";
+}
+
+static int stpio_read_proc(char *page, char **start, off_t off, int count,
+		int *eof, void *data_unused)
+{
+	int len;
+	int port_no, pin_no;
+	off_t begin = 0;
+	int num_ports = stm_gpio_num / STM_GPIO_PINS_PER_PORT;
+	struct stm_gpio_port *port;
+	struct stm_gpio_pin *pin;
+	char *name;
+
+	len = sprintf(page, "  port      name          direction\n");
+	for (port_no = 0; port_no < num_ports; port_no++)
+	{
+		for (pin_no = 0; pin_no < STM_GPIO_PINS_PER_PORT; pin_no++)
+		{
+			port = &stm_gpio_ports[port_no];
+			if (!port)
+			{
+				continue;
+			}
+			pin = &port->pins[pin_no];
+			if (!pin)
+			{
+				continue;
+			}
+			name = pin->stpio.pin_name ? pin->stpio.pin_name : "";
+			len += sprintf(page + len,
+					"PIO %d.%d [%-10s] [%s] [%s]\n",
+					port_no, pin_no, name,
+					stpio_get_direction_name(pin->direction),
+					stpio_get_handler_name(pin->stpio.func));
+ 			if (len + begin > off + count)
+			{
+				goto done;
+			}
+			if (len + begin < off)
+			{
+				begin += len;
+				len = 0;
+			}
+		}
+	}
+	*eof = 1;
+
+done:
+	if (off >= len + begin)
+	{
+		return 0;
+	}
+	*start = page + (off - begin);
+	return ((count < begin + len - off) ? count : begin + len - off);
+}
+#endif /* CONFIG_PROC_FS */
+
 #endif /* CONFIG_STPIO */
 
 
@@ -1042,7 +1151,13 @@
 static int __init stm_gpio_init(void)
 {
 	int ret;
-
+#ifdef CONFIG_PROC_FS
+	proc_stpio = create_proc_entry("stpio", 0, NULL);
+	if (proc_stpio)
+	{
+		proc_stpio->read_proc = stpio_read_proc;
+	}
+#endif
 	ret = platform_driver_register(&stm_gpio_driver);
 	if (ret)
 		return ret;
diff -Naur linux-sh4-2.6.32.71/arch/sh/mm/kmap.c linux-sh4-2.6.32.71-PersianPrince/arch/sh/mm/kmap.c
--- linux-sh4-2.6.32.71/arch/sh/mm/kmap.c	2020-08-12 04:14:39.211130380 +0430
+++ linux-sh4-2.6.32.71-PersianPrince/arch/sh/mm/kmap.c	2020-08-12 04:14:10.583878000 +0430
@@ -36,6 +36,7 @@
 
 	BUG_ON(test_bit(PG_dcache_dirty, &page->flags));
 
+	preempt_disable();
 	pagefault_disable();
 
 	idx = FIX_CMAP_END -
@@ -62,4 +63,5 @@
 	}
 
 	pagefault_enable();
+	preempt_enable();
 }
